!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function a(a,b){var c=typeof a[b];return c==u||!(c!=t||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=t||!a[b])}function c(a,b){return typeof a[b]!=v}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&A(a,z)&&C(a,y)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(b){typeof console!=v&&a(console,"log")&&console.log(b)}function h(a,b){F&&b?alert(a):g(a)}function i(a){H.initialized=!0,H.supported=!1,h("Rangy is not supported in this environment. Reason: "+a,H.config.alertOnFail)}function j(a){h("Rangy warning: "+a,H.config.alertOnWarn)}function k(a){return a.message||a.description||String(a)}function l(){if(F&&!H.initialized){var b,c=!1,d=!1;a(document,"createRange")&&(b=document.createRange(),A(b,x)&&C(b,w)&&(c=!0));var h=f(document);if(!h||"body"!=h.nodeName.toLowerCase())return void i("No body element found");if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return void i("Neither Range nor TextRange are available");H.initialized=!0,H.features={implementsDomRange:c,implementsTextRange:d};var j,l;for(var m in E)(j=E[m])instanceof p&&j.init(j,H);for(var n=0,o=K.length;o>n;++n)try{K[n](H)}catch(q){l="Rangy init listener threw an exception. Continuing. Detail: "+k(q),g(l)}}}function m(a,b,c){c&&(a+=" in module "+c.name),H.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function n(a,b,c,d){a[b]=function(){return m(b,c,d),a[c].apply(a,G.toArray(arguments))}}function o(a){a=a||window,l();for(var b=0,c=L.length;c>b;++b)L[b](a)}function p(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function q(a,b,c){var d=new p(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(H,b),b.supported=!0}catch(d){var e="Module '"+a+"' failed to load: "+k(d);g(e),d.stack&&g(d.stack)}}});return E[a]=d,d}function r(){}function s(){}var t="object",u="function",v="undefined",w=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],z=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=d(a),B=d(b),C=d(c),D=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c],c)},E={},F=typeof window!=v&&typeof document!=v,G={isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:A,areHostObjects:B,areHostProperties:C,isTextRange:e,getBody:f,forEach:D},H={version:"1.3.0",initialized:!1,isBrowser:F,supported:!0,util:G,features:{},modules:E,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==v?!0:rangyAutoInitialize}};H.fail=i,H.warn=j;var I;({}).hasOwnProperty?(G.extend=I=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&I(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},G.createOptions=function(a,b){var c={};return I(c,b),a&&I(c,a),c}):i("hasOwnProperty not supported"),F||i("Rangy can only run in a browser"),function(){var a;if(F){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(d){}}a||(a=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),G.toArray=a}();var J;F&&(a(document,"addEventListener")?J=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?J=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),G.addListener=J);var K=[];G.deprecationNotice=m,G.createAliasForDeprecatedMethod=n,H.init=l,H.addInitListener=function(a){H.initialized?a(H):K.push(a)};var L=[];H.addShimListener=function(a){L.push(a)},F&&(H.shim=H.createMissingNativeApi=o,n(H,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=E[b],!(a&&a instanceof p))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error(a)},warn:function(a){H.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){H.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},H.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=q(a,c,b);H.initialized&&H.supported&&d.init()},H.createCoreModule=function(a,b,c){q(a,b,c)},H.RangePrototype=r,H.rangePrototype=new r,H.selectionPrototype=new s,H.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==F||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(K(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=F)return a.ownerDocument;if(typeof a.document!=F)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=F)return c.defaultView;if(typeof c.parentWindow!=F)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=F)return a.contentDocument;if(typeof a.contentWindow!=F)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=F)return a.contentWindow;if(typeof a.contentDocument!=F)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&G.isHostMethod(a,"setTimeout")&&G.isHostObject(a,"document")}function t(a,b,c){var d;if(a?G.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){var b;try{return b=a.parentNode,!1}catch(c){return!0}}function x(a){if(!a)return"[No node]";if(L&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a,b,c){var d=H(a),e=a.createElement("div");e.contentEditable=""+!!c,b&&(e.innerHTML=b);var f=d.firstChild;return f?d.insertBefore(e,f):d.appendChild(e),e}function A(a){return a.parentNode.removeChild(a)}function B(a){this.root=a,this._next=a}function C(a){return new B(a)}function D(a,b){this.node=a,this.offset=b}function E(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var F="undefined",G=a.util,H=G.getBody;G.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),G.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var I=document.createElement("div");G.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),G.isHostProperty(I,"innerHTML")||b.fail("Element is missing innerHTML property");var J=document.createTextNode("test");G.areHostMethods(J,["splitText","deleteData","insertData","appendData","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!G.areHostProperties(J,["data"]))||b.fail("Incomplete Text Node implementation");var K=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},L=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br />",L=w(c),a.features.crashyTextNodes=L}();var M;typeof window.getComputedStyle!=F?M=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=F?M=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found"),B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},D.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},a.dom={arrayContains:K,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:H,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:M,createTestElement:z,removeNode:A,fragmentFromNodeChildren:y,createIterator:C,DomPosition:D},a.DOMException=E}),H.createCoreModule("DomRange",["DomUtil"],function(a,b){function c(a,b){return 3!=a.nodeType&&(P(a,b.startContainer)||P(a,b.endContainer))}function d(a){return a.document||Q(a.startContainer)}function e(a){return W(a.startContainer)}function f(a){return new L(a.parentNode,O(a))}function g(a){return new L(a.parentNode,O(a)+1)}function h(a,b,c){var d=11==a.nodeType?a.firstChild:a;return N(b)?c==b.length?J.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:S(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function i(a,b,c){if(z(a),z(b),d(b)!=d(a))throw new M("WRONG_DOCUMENT_ERR");var e=R(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=R(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?0>=e&&f>=0:0>e&&f>0}function j(a){for(var b,c,e,f=d(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(j(e)),e.detach()),10==c.nodeType)throw new M("HIERARCHY_REQUEST_ERR");f.appendChild(c)}return f}function k(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),k(g,b,c),g.detach(),c.stop)return}else for(d=J.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach()):a.remove()}function m(a){for(var b,c,e=d(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(m(c)),c.detach()):a.remove(),10==b.nodeType)throw new M("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function n(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return k(new p(a,!1),function(b){if((!e||d.test(b.nodeType))&&(!f||c(b))){var h=a.startContainer;if(b!=h||!N(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&N(i)&&0==a.endOffset||g.push(b)}}}),g}function o(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+J.inspectNode(a.startContainer)+":"+a.startOffset+", "+J.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function p(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&N(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||N(this.sc)?T(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||N(this.ec)?T(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,V(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(ea(a,b))throw new M("INVALID_NODE_TYPE_ERR")}function s(a,b){if(!V(b,a.nodeType))throw new M("INVALID_NODE_TYPE_ERR")}function t(a,b){if(0>b||b>(N(a)?a.length:a.childNodes.length))throw new M("INDEX_SIZE_ERR")}function u(a,b){if(ca(a,!0)!==ca(b,!0))throw new M("WRONG_DOCUMENT_ERR")}function v(a){if(da(a,!0))throw new M("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new M(b)}function x(a,b){return b<=(N(a)?a.length:a.childNodes.length)}function y(a){return!!a.startContainer&&!!a.endContainer&&!(X&&(J.isBrokenNode(a.startContainer)||J.isBrokenNode(a.endContainer)))&&W(a.startContainer)==W(a.endContainer)&&x(a.startContainer,a.startOffset)&&x(a.endContainer,a.endOffset)}function z(a){if(!y(a))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")")}function A(a,b){z(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;N(e)&&f>0&&f<e.length&&S(e,f,b),N(c)&&d>0&&d<c.length&&(c=S(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=O(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function B(a){z(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function C(a){a.START_TO_START=ka,a.START_TO_END=la,a.END_TO_END=ma,a.END_TO_START=na,a.NODE_BEFORE=oa,a.NODE_AFTER=pa,a.NODE_BEFORE_AND_AFTER=qa,a.NODE_INSIDE=ra}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){z(this);var c,d,e=this.startContainer,f=this.startOffset,h=this.commonAncestorContainer,i=new p(this,!0);e!==h&&(c=T(e,h,!0),d=g(c),e=d.node,f=d.offset),k(i,v),i.reset();var j=a(i);return i.detach(),b(this,e,f,e,f),j}}function F(b,d){function e(a,b){return function(c){s(c,Z),s(W(c),$);var d=(a?f:g)(c);(b?h:i)(this,d.node,d.offset)}}function h(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((W(b)!=W(e)||1==R(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function i(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((W(b)!=W(e)||-1==R(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,K.extend(b.prototype,{setStart:function(a,b){r(a,!0),t(a,b),h(this,a,b)},setEnd:function(a,b){r(a,!0),t(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],e=b,f=c;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}d(this,b,c,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){z(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(a,!0),d(this,a,0,a,U(a))},selectNode:function(a){r(a,!1),s(a,Z);var b=f(a),c=g(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:E(m,d),deleteContents:E(l,d),canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},splitBoundaries:function(){A(this)},splitBoundariesPreservingPositions:function(a){A(this,a)},normalizeBoundaries:function(){z(this);var a,b=this.startContainer,c=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),Y(b))},h=function(a){var d=a.previousSibling;if(d&&d.nodeType==a.nodeType){b=a;var g=a.length;if(c=d.length,a.insertData(0,d.data),Y(d),b==e)f+=c,e=b;else if(e==a.parentNode){var h=O(a);f==h?(e=a,f=g):f>h&&f--}}},i=!0;if(N(e))f==e.length?g(e):0==f&&(a=e.previousSibling,a&&a.nodeType==e.nodeType&&(f=a.length,b==e&&(i=!1),a.appendData(e.data),Y(e),e=a));else{if(f>0){var j=e.childNodes[f-1];j&&N(j)&&g(j)}i=!this.collapsed}if(i){if(N(b))0==c?h(b):c==b.length&&(a=b.nextSibling,a&&a.nodeType==b.nodeType&&(e==a&&(e=b,f+=b.length),b.appendData(a.data),Y(a)));else if(c<b.childNodes.length){var k=b.childNodes[c];k&&N(k)&&h(k)}}else b=e,c=f;d(this,b,c,e,f)},collapseToPoint:function(a,b){r(a,!0),t(a,b),this.setStartAndEnd(a,b)}}),D(b)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:J.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=J.getDocument(b),G(a)}function I(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,G(this)}var J=a.dom,K=a.util,L=J.DomPosition,M=a.DOMException,N=J.isCharacterDataNode,O=J.getNodeIndex,P=J.isOrIsAncestorOf,Q=J.getDocument,R=J.comparePoints,S=J.splitDataNode,T=J.getClosestAncestorIn,U=J.getNodeLength,V=J.arrayContains,W=J.getRootContainer,X=a.features.crashyTextNodes,Y=J.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,N(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!N(c)||c!==this.sc&&c!==this.ec?c.parentNode&&Y(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return c(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new I(d(this.range));var b=this._current,c=b,e=0,f=b,g=U(b);P(b,this.sc)&&(c=this.sc,e=this.so),P(b,this.ec)&&(f=this.ec,g=this.eo),H(a,c,e,f,g)}return new p(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Z=[1,3,4,5,7,8,10],$=[2,9,11],_=[5,6,10,12],aa=[1,3,4,5,7,8,10,11],ba=[1,3,4,5,7,8],ca=q([9,11]),da=q(_),ea=q([6,10,12]),fa=document.createElement("style"),ga=!1;try{fa.innerHTML="<b>x</b>",ga=3==fa.firstChild.nodeType}catch(ha){}a.features.htmlParsingConforms=ga;var ia=ga?function(a){var b=this.startContainer,c=Q(b);if(!b)throw new M("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:N(b)&&(d=J.parentElement(b)),d=null===d||"HTML"==d.nodeName&&J.isHtmlNamespace(Q(d).documentElement)&&J.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,J.fragmentFromNodeChildren(d)}:function(a){var b=d(this),c=b.createElement("body");return c.innerHTML=a,J.fragmentFromNodeChildren(c)},ja=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ka=0,la=1,ma=2,na=3,oa=0,pa=1,qa=2,ra=3;K.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){z(this),u(this.startContainer,b.startContainer);var c,d,e,f,g=a==na||a==ka?"start":"end",h=a==la||a==ka?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],R(c,d,e,f)},insertNode:function(a){if(z(this),s(a,aa),v(this.startContainer),P(a,this.startContainer))throw new M("HIERARCHY_REQUEST_ERR");var b=h(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){z(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&N(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;var c=new p(this,!0);return a=j(c),c.detach(),a},canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},surroundContents:function(a){if(s(a,ba),!this.canSurroundContents())throw new M("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);h(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){z(this);for(var a,b=new I(d(this)),c=ja.length;c--;)a=ja[c],b[a]=this[a];return b},toString:function(){z(this);var a=this.startContainer;if(a===this.endContainer&&N(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new p(this,!0);return k(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){z(this);var b=a.parentNode,c=O(a);if(!b)throw new M("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?qa:oa:e>0?pa:ra},comparePoint:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)<0?-1:R(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ia,toHtml:function(){return B(this)},intersectsNode:function(a,b){if(z(this),W(a)!=e(this))return!1;var c=a.parentNode,d=O(a);if(!c)return!0;var f=R(c,d,this.endContainer,this.endOffset),g=R(c,d+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)>=0&&R(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return i(this,a,!1)},intersectsOrTouchesRange:function(a){return i(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=R(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=R(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==R(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==R(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new M("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ra},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,U(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a)},getNodes:function(a,b){return z(this),n(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var c=d(this),e=a.createRange(c);b=b||J.getBody(c),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return I.rangesEqual(this,a)},isValid:function(){return y(this)},inspect:function(){return o(this)},detach:function(){}}),F(I,H),K.extend(I,{rangeProperties:ja,RangeIterator:p,copyComparisonConstants:D,createPrototypeRange:F,inspect:o,toHtml:B,getRangeDocument:d,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=I}),H.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=m.length;c--;)b=m[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var k,l,m=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g),k=c.prototype,k.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},k.cloneContents=function(){return this.nativeRange.cloneContents()},k.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},k.collapse=function(a){this.nativeRange.collapse(a),d(this)},k.cloneRange=function(){return new c(this.nativeRange.cloneRange())},k.refresh=function(){d(this)},k.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),k.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},k.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},l=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(p){k.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},k.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},l=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}k.setStartBefore=l("setStartBefore","setEndBefore"),k.setStartAfter=l("setStartAfter","setEndAfter"),k.setEndBefore=l("setEndBefore","setStartBefore"),k.setEndAfter=l("setEndAfter","setStartAfter"),k.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var q=document.createRange();q.selectNodeContents(n),q.setEnd(n,4),q.setStart(n,2),-1==o.compareBoundaryPoints(o.START_TO_END,q)&&1==o.compareBoundaryPoints(o.END_TO_START,q)?k.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:k.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var r=document.createElement("div");r.innerHTML="123";var s=r.firstChild,t=i(document);t.appendChild(r),o.setStart(s,1),o.setEnd(s,2),o.deleteContents(),"13"==s.data&&(k.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},k.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),t.removeChild(r),t=null,f.isHostMethod(o,"createContextualFragment")&&(k.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),k.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&e.removeNode(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return e.removeNode(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),
d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(a){return a("return this;")()}(Function);"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},f.createAliasForDeprecatedMethod(a,"createIframeRange","createRange"),f.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange"),a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),H.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=ba.length;e--;)if(c=ba[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(ba.splice(e,1),!0):d;return"deleteAll"==b&&(ba.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);if(Q)y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b};else{if(!O)return b.fail("Neither document.selection or window.getSelection() detected."),!1;y=e,a.isSelectionValid=function(){return!0}}a.getNativeSelection=y;var R=y();if(!R)return b.fail("Native selection was null (possibly issue 138?)"),!1;var S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=g(b),h=0;c>h;++h)e[h]=b.getRangeAt(h);var i=C.createTestElement(document,"",!1),j=i.appendChild(document.createTextNode("   ")),k=document.createRange();if(k.setStart(j,1),k.collapse(!0),b.removeAllRanges(),b.addRange(k),Y=1==b.rangeCount,b.removeAllRanges(),!d){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)X=!1;else{var m=k.cloneRange();k.setStart(j,0),m.setEnd(j,3),m.setStart(j,2),b.addRange(k),b.addRange(m),X=2==b.rangeCount}}for(C.removeNode(i),b.removeAllRanges(),h=0;c>h;++h)0==h&&f?Z?Z(b,e[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[h])):b.addRange(e[h])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var aa;E(R,"getRangeAt")?aa=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(aa=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var ba=[],ca=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),ba.push({win:a,selection:b})),b};a.getSelection=ca,D.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");var da=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){da.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var ea=function(a,b){Z(a.nativeSelection,b),a.refresh()};W?da.addRange=function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)ea(this,b);else{var e;X?e=this.rangeCount:(this.removeAllRanges(),e=0);var f=k(b).cloneRange();try{this.nativeSelection.addRange(f)}catch(g){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var i=aa(this.nativeSelection,this.rangeCount-1);i&&!N(i,b)&&(b=new G(i))}this._ranges[this.rangeCount-1]=b,h(this,b,ha(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:da.addRange=function(a,b){c(b)&&V?ea(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},da.setRanges=function(a){if(_&&P&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;da.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},da.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},da.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}da.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fa;if(Q)fa=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fa=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],ha(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fa=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=aa(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}da.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fa(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var ga=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};_&&P?da.removeRange=function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else ga(this,a)}:da.removeRange=function(a){ga(this,a)};var ha;!Q&&U&&J.implementsDomRange?(ha=g,da.isBackward=function(){return ha(this)}):ha=da.isBackward=function(){return!1},da.isBackwards=da.isBackward,da.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},da.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},da.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},da.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},da.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},da.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),C.removeNode(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},da.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},da.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},da.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},da.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c},da.setStart=w(!0),da.setEnd=w(!1),a.rangePrototype.select=function(a){ca(this.getDocument()).setSingleRange(this,a)},da.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},da.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},da.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},da.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},da.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},da.restoreRanges=function(a){this.removeAllRanges();for(var b,c=0;b=a.ranges[c];++c)this.addRange(b,a.backward&&0==c)},da.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(F.toHtml(b))}),a.join("")},J.implementsTextRange&&(da.getNativeTextRange=function(){var c;if(c=this.docSelection){var d=c.createRange();if(n(d))return d;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),da.getName=function(){return"WrappedSelection"},da.inspect=function(){return x(this)},da.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=da,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ca(a)}),a=null})});var M=!1,N=function(a){M||(M=!0,!H.initialized&&H.config.autoInitialize&&l())};return F&&("complete"==document.readyState?N():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),J(window,"load",N))),H},this),require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a,c){"undefined"!=typeof b&&b.exports?b.exports=c():"function"==typeof define&&define.amd?define(c):this[a]=c()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function d(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var e,f=c(/(ipod|iphone|ipad)/i).toLowerCase(),g=/like android/i.test(a),h=!g&&/android/i.test(a),i=/CrOS/.test(a),j=c(/edge\/(\d+(\.\d+)?)/i),k=c(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(a),m=!l&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?e={name:"Opera",opera:b,version:k||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?e={name:"Yandex Browser",yandexbrowser:b,version:k||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?(e={name:"Windows Phone",windowsphone:b},j?(e.msedge=b,e.version=j):(e.msie=b,e.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?e={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:i?e={name:"Chrome",chromeBook:b,chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?e={name:"Microsoft Edge",msedge:b,version:j}:/chrome|crios|crmo/i.test(a)?e={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:f?(e={name:"iphone"==f?"iPhone":"ipad"==f?"iPad":"iPod"},k&&(e.version=k)):/sailfish/i.test(a)?e={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?e={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(e={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(e.firefoxos=b)):/silk/i.test(a)?e={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:h?e={name:"Android",version:k}:/phantom/i.test(a)?e={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?e={name:"BlackBerry",blackberry:b,version:k||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(e={name:"WebOS",webos:b,version:k||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(e.touchpad=b)):e=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||k}:/safari/i.test(a)?{name:"Safari",safari:b,version:k}:{name:c(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!e.msedge&&/(apple)?webkit/i.test(a)?(e.name=e.name||"Webkit",e.webkit=b,!e.version&&k&&(e.version=k)):!e.opera&&/gecko\//i.test(a)&&(e.name=e.name||"Gecko",e.gecko=b,e.version=e.version||c(/gecko\/(\d+(\.\d+)?)/i)),e.msedge||!h&&!e.silk?f&&(e[f]=b,e.ios=b):e.android=b;var n="";e.windowsphone?n=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):f?(n=c(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):h?n=c(/android[ \/-](\d+(\.\d+)*)/i):e.webos?n=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):e.blackberry?n=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):e.bada?n=c(/bada\/(\d+(\.\d+)*)/i):e.tizen&&(n=c(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(e.osversion=n);var o=n.split(".")[0];return l||"ipad"==f||h&&(3==o||4==o&&!m)||e.silk?e.tablet=b:(m||"iphone"==f||"ipod"==f||h||e.blackberry||e.webos||e.bada)&&(e.mobile=b),e.msedge||e.msie&&e.version>=10||e.yandexbrowser&&e.version>=15||e.chrome&&e.version>=20||e.firefox&&e.version>=20||e.safari&&e.version>=6||e.opera&&e.version>=10||e.ios&&e.osversion&&e.osversion.split(".")[0]>=6||e.blackberry&&e.version>=10.1?e.a=b:e.msie&&e.version<10||e.chrome&&e.version<20||e.firefox&&e.version<20||e.safari&&e.version<6||e.opera&&e.version<10||e.ios&&e.osversion&&e.osversion.split(".")[0]<6?e.c=b:e.x=b,e}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c.test=function(a){for(var b=0;b<a.length;++b){var d=a[b];if("string"==typeof d&&d in c)return!0}return!1},c._detect=a,c})},{}],2:[function(a,b,c){b.exports=function(){var a=function(a){return function(b){var c=b[a];return c&&c.getAttribute("contenteditable")?c:null}};return{next:a("nextElementSibling"),previous:a("previousElementSibling")}}()},{}],3:[function(a,b,c){var d=a("jquery"),e=a("./config"),f=a("./util/string"),g=a("./node-type");b.exports=function(){var a,b,c,h,i,j=/^\s*$/,k="<!-- BLOCK -->",l=function(d){var e,f,g=d.pastedHtmlRules;for(a=g.allowedElements||{},b=g.requiredAttributes||{},c=g.transformElements||{},h={},e=0;e<g.blockLevelElements.length;e++)f=g.blockLevelElements[e],h[f]=!0;for(i={},e=0;e<g.splitIntoBlocks.length;e++)f=g.splitIntoBlocks[e],i[f]=!0};return l(e),{updateConfig:l,paste:function(a,b,c){var f=a.ownerDocument;a.setAttribute(e.pastingAttribute,!0),b.isSelection&&(b=b.deleteContent()),b.save();var g=this.injectPasteholder(f);g.focus();var h=this;setTimeout(function(){var f;f=h.parseContent(g),d(g).remove(),a.removeAttribute(e.pastingAttribute),b.restore(),c(f,b)},0)},injectPasteholder:function(a){var b=d(a.createElement("div")).attr("contenteditable",!0).css({position:"fixed",right:"5px",top:"50%",width:"1px",height:"1px",overflow:"hidden",outline:"none"})[0];return d(a.body).append(b),b},parseContent:function(a){for(var b=this.filterHtmlElements(a),c=b.split(k),d=0;d<c.length;d++){var e=c[d];e=this.cleanWhitespace(e),e=f.trim(e),c[d]=e}return c=c.filter(function(a){return!j.test(a)})},filterHtmlElements:function(a,b){b||(b=[]);for(var c,d="",e=0;e<a.childNodes.length;e++)if(c=a.childNodes[e],c.nodeType===g.elementNode){var h=this.filterHtmlElements(c,b);d+=this.conditionalNodeWrap(c,h)}else c.nodeType===g.textNode&&(d+=f.escapeHtml(c.nodeValue));return d},conditionalNodeWrap:function(a,b){var c=a.nodeName.toLowerCase();if(c=this.transformNodeName(c),this.shouldKeepNode(c,a)){var d=this.filterAttributes(c,a);return"br"===c?"<"+c+d+">":j.test(b)?b:"<"+c+d+">"+b+"</"+c+">"}return i[c]?k+b+k:h[c]?b+" ":b},filterAttributes:function(b,c){for(var d="",e=0,f=(c.attributes||[]).length;f>e;e++){var g=c.attributes[e].name,h=c.attributes[e].value;a[b][g]&&h&&(d+=" "+g+'="'+h+'"')}return d},transformNodeName:function(a){return c[a]?c[a]:a},hasRequiredAttributes:function(a,c){var d,e,f=b[a];if(f)for(var g=0;g<f.length;g++)if(d=f[g],e=c.getAttribute(d),!e)return!1;return!0},shouldKeepNode:function(b,c){return a[b]&&this.hasRequiredAttributes(b,c)},cleanWhitespace:function(a){var b=a.replace(/(.)(\u00A0)/g,function(a,b,c,d,e){return/[\u0020]/.test(b)?b+" ":b+" "});return b}}}()},{"./config":4,"./node-type":16,"./util/string":25,jquery:"jquery"}],4:[function(a,b,c){b.exports={log:!1,logErrors:!0,editableClass:"js-editable",editableDisabledClass:"js-editable-disabled",pastingAttribute:"data-editable-is-pasting",boldTag:"strong",italicTag:"em",pastedHtmlRules:{allowedElements:{a:{href:!0},strong:{},em:{},br:{}},requiredAttributes:{a:["href"]},transformElements:{b:"strong",i:"em"},splitIntoBlocks:["h1","h2","h3","h4","h5","h6","p","blockquote"],blockLevelElements:["h1","h2","h3","h4","h5","h6","div","p","pre","hr","blockquote","article","figure","header","footer","ul","ol","li","section","table","video"]}}},{}],5:[function(a,b,c){var d,e=a("rangy"),f=a("jquery"),g=a("./node-type"),h=a("./range-save-restore"),i=a("./parser"),j=a("./util/string");b.exports=d=function(){var a=function(a,b,c){return b=h.save(b),c.call(d),h.restore(a,b)},b=/\u200B/g,c=/\uFEFF/g,k=/[^\S ]/g;return{tidyHtml:function(a){this.normalizeTags(a)},normalizeTags:function(a){var b,c,d,e,f=document.createDocumentFragment();for(b=0;b<a.childNodes.length;b++)if(d=a.childNodes[b],d&&("BR"===d.nodeName||d.textContent)){if(d.nodeType===g.elementNode&&"BR"!==d.nodeName){for(e=d;null!==(e=e.nextSibling)&&i.isSameNode(e,d);){for(c=0;c<e.childNodes.length;c++)d.appendChild(e.childNodes[c].cloneNode(!0));e.parentNode.removeChild(e)}this.normalizeTags(d)}f.appendChild(d.cloneNode(!0))}for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(f)},normalizeWhitespace:function(a){return a.replace(k," ")},cleanInternals:function(a){a.innerHTML=this.extractContent(a,!0)},extractContent:function(a,d){var e;e=a.nodeType===g.documentFragmentNode?this.getInnerHtmlOfFragment(a):a.innerHTML,e=e.replace(c,""),e=e.replace(b,"<br>");var f=document.createElement("div");return f.innerHTML=e,this.unwrapInternalNodes(f,d),f.innerHTML},getInnerHtmlOfFragment:function(a){var b=document.createElement("div");return b.appendChild(a),b.innerHTML},createFragmentFromString:function(a){for(var b=document.createDocumentFragment(),c=f("<div>").html(a).contents(),d=0;d<c.length;d++){var e=c[d];b.appendChild(e)}return b},adoptElement:function(a,b){return a.ownerDocument!==b?b.adoptNode(a):a},cloneRangeContents:function(a){for(var b=a.cloneContents(),c=b.childNodes[0],d=document.createDocumentFragment();c.childNodes.length;)d.appendChild(c.childNodes[0]);return d},unwrapInternalNodes:function(a,b){for(;a;){var c=a.nextSibling;if(a.nodeType===g.elementNode){var d=a.getAttribute("data-editable");a.firstChild&&this.unwrapInternalNodes(a.firstChild,b),"remove"===d?f(a).remove():"unwrap"===d?this.unwrap(a):"ui-remove"!==d||b?"ui-unwrap"!==d||b||this.unwrap(a):f(a).remove()}a=c}},getTags:function(a,b,c){for(var d=this.getInnerTags(b,c),e=b.commonAncestorContainer;e!==a;)(!c||c(e))&&d.push(e),e=e.parentNode;return d},getTagsByName:function(a,b,c){return this.getTags(a,b,function(a){return a.nodeName===c.toUpperCase()})},getInnerTags:function(a,b){return a.getNodes([g.elementNode],b)},getTagNames:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push(a[c].nodeName);return b},isAffectedBy:function(a,b,c){for(var d,e=this.getTags(a,b),f=0;f<e.length;f++)if(d=e[f],d.nodeName===c.toUpperCase())return!0;return!1},isExactSelection:function(a,b,c){var d=e.createRange();if(d.selectNodeContents(b),a.intersectsRange(d)){var g=a.toString(),h=f(b).text();return c&&(g=j.trim(g),h=j.trim(h)),""!==g&&g===h}return!1},expandTo:function(a,b,c){return b.selectNodeContents(c),b},toggleTag:function(a,b,c){var d=this.getTagsByName(a,b,c.nodeName);return 1===d.length&&this.isExactSelection(b,d[0],"visible")?this.removeFormatting(a,b,c.nodeName):this.forceWrap(a,b,c)},isWrappable:function(a){return a.canSurroundContents()},forceWrap:function(b,c,d){return c=a(b,c,function(){this.nuke(b,c,d.nodeName)}),this.isWrappable(c)||(c=a(b,c,function(){this.nuke(b,c)})),this.wrap(c,d),c},wrap:function(a,b){if(b=j.isString(b)?f(b)[0]:b,this.isWrappable(a)){a.surroundContents(b)}else console.log("content.wrap(): can not surround range")},unwrap:function(a){var b=f(a),c=b.contents();c.length?c.unwrap():b.remove()},removeFormatting:function(b,c,d){return a(b,c,function(){this.nuke(b,c,d)})},nuke:function(a,b,c){for(var d=this.getTags(a,b),e=0;e<d.length;e++){var f=d[e];"BR"===f.nodeName||c&&f.nodeName!==c.toUpperCase()||this.unwrap(f)}},insertCharacter:function(a,b,c){var d=document.createTextNode(b),e=a.cloneRange();e.collapse(c),e.insertNode(d),c?a.setStartBefore(d):a.setEndAfter(d),a.normalizeBoundaries()},surround:function(a,b,c,d){return d||(d=c),this.insertCharacter(b,d,!1),this.insertCharacter(b,c,!0),b},deleteCharacter:function(b,c,d){return this.containsString(c,d)&&(c.splitBoundaries(),c=a(b,c,function(){for(var a=j.regexp(d),b=c.getNodes([g.textNode],function(b){return b.nodeValue.search(a)>=0}),e=0;e<b.length;e++){var f=b[e];f.nodeValue=f.nodeValue.replace(a,"")}}),c.normalizeBoundaries()),c},containsString:function(a,b){var c=a.toString();return c.indexOf(b)>=0},nukeTag:function(a,b,c){for(var d=this.getTags(a,b),e=0;e<d.length;e++){var f=d[e];f.nodeName===c&&this.unwrap(f)}}}}()},{"./node-type":16,"./parser":17,"./range-save-restore":19,"./util/string":25,jquery:"jquery",rangy:"rangy"}],6:[function(a,b,c){var d=a("rangy"),e=a("jquery"),f=a("./config"),g=a("./util/error"),h=a("./parser"),i=a("./content"),j=a("./clipboard"),k=a("./dispatcher"),l=a("./cursor"),m=a("./spellcheck"),n=a("./create-default-events"),o=a("bowser"),p=function(a){var b={window:window,defaultBehavior:!0,mouseMoveSelectionChanges:!1,browserSpellcheck:!0};this.config=e.extend(b,a),this.win=this.config.window,this.editableSelector="."+f.editableClass,d.initialized||d.init(),this.dispatcher=new k(this),this.config.defaultBehavior===!0&&this.dispatcher.on(n(this))};p.parser=h,p.content=i,p.browser=o,window.Editable=p,b.exports=p,p.globalConfig=function(a){e.extend(f,a),j.updateConfig(f)},p.prototype.add=function(a){return this.enable(e(a)),this},p.prototype.remove=function(a){var b=e(a);return this.disable(b),b.removeClass(f.editableDisabledClass),this},p.prototype.disable=function(a){var b=this.win.document.body;return a=a||e("."+f.editableClass,b),a.removeAttr("contenteditable").removeAttr("spellcheck").removeClass(f.editableClass).addClass(f.editableDisabledClass),this},p.prototype.enable=function(a,b){var c=this.win.document.body;return a=a||e("."+f.editableDisabledClass,c),a.attr("contenteditable",!0).attr("spellcheck",this.config.browserSpellcheck).removeClass(f.editableDisabledClass).addClass(f.editableClass),b&&a.each(function(a,b){i.tidyHtml(b)}),this},p.prototype.suspend=function(a){var b=this.win.document.body;return a=a||e("."+f.editableClass,b),a.removeAttr("contenteditable"),this},p.prototype["continue"]=function(a){var b=this.win.document.body;return a=a||e("."+f.editableClass,b),a.attr("contenteditable",!0),this},p.prototype.createCursor=function(a,b){var c,f=e(a).closest(this.editableSelector);if(b=b||"beginning",f.length){var h=d.createRange();"beginning"===b||"end"===b?(h.selectNodeContents(a),h.collapse("beginning"===b?!0:!1)):a!==f[0]?"before"===b?(h.setStartBefore(a),h.setEndBefore(a)):"after"===b&&(h.setStartAfter(a),h.setEndAfter(a)):g("EditableJS: cannot create cursor outside of an editable block."),c=new l(f[0],h)}return c},p.prototype.createCursorAtBeginning=function(a){return this.createCursor(a,"beginning")},p.prototype.createCursorAtEnd=function(a){return this.createCursor(a,"end")},p.prototype.createCursorBefore=function(a){return this.createCursor(a,"before")},p.prototype.createCursorAfter=function(a){return this.createCursor(a,"after")},p.prototype.getContent=function(a){return i.extractContent(a)},p.prototype.appendTo=function(a,b){a=i.adoptElement(a,this.win.document),"string"==typeof b&&(b=i.createFragmentFromString(b));var c=this.createCursor(a,"end");return c.insertAfter(b),c},p.prototype.prependTo=function(a,b){a=i.adoptElement(a,this.win.document),"string"==typeof b&&(b=i.createFragmentFromString(b));var c=this.createCursor(a,"beginning");return c.insertBefore(b),c},p.prototype.getSelection=function(a){var b=this.dispatcher.selectionWatcher.getFreshSelection();if(a&&b){var c=b.range;try{c.compareNode(a)!==c.NODE_BEFORE_AND_AFTER&&(b=void 0)}catch(d){b=void 0}}return b},p.prototype.setupSpellcheck=function(a){return this.spellcheck=new m(this,a),this},p.prototype.on=function(a,b){return this.dispatcher.on(a,b),this},p.prototype.off=function(a,b){var c=Array.prototype.slice.call(arguments);return this.dispatcher.off.apply(this.dispatcher,c),this},p.prototype.unload=function(){return this.dispatcher.unload(),this};for(var q=function(a){p.prototype[a]=function(b){return this.on(a,b)}},r=["focus","blur","flow","selection","cursor","newline","insert","split","merge","empty","change","switch","move","clipboard","paste"],s=0;s<r.length;++s){var t=r[s];q(t)}},{"./clipboard":3,"./config":4,"./content":5,"./create-default-events":8,"./cursor":9,"./dispatcher":10,"./parser":17,"./spellcheck":22,"./util/error":23,bowser:1,jquery:"jquery",rangy:"rangy"}],7:[function(a,b,c){var d=a("jquery"),e=a("./parser"),f=a("./content"),g=a("./util/log"),h=a("./block");b.exports=function(a){var b=a.win.document;a.dispatcher.selectionWatcher;return{focus:function(a){if(e.isVoid(a)){var c=b.createElement("br");c.setAttribute("data-editable","remove"),a.appendChild(c)}},blur:function(a){f.cleanInternals(a)},selection:function(a,b){g(b?"Default selection behavior":"Default selection empty behavior")},cursor:function(a,b){g(b?"Default cursor behavior":"Default cursor empty behavior")},newline:function(a,c){var d=c.isAtEnd(),e=b.createElement("br");if(c.insertBefore(e),d){g("at the end");var f=b.createTextNode("​");
c.insertAfter(f)}else g("not at the end");c.setVisibleSelection()},insert:function(a,b,c){var d=a.parentNode,e=a.cloneNode(!1);switch(e.id&&e.removeAttribute("id"),b){case"before":d.insertBefore(e,a),a.focus();break;case"after":d.insertBefore(e,a.nextSibling),e.focus()}},split:function(a,b,c,d){var e=a.cloneNode();e.appendChild(b);var g=a.parentNode;for(g.insertBefore(e,a);a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c),f.tidyHtml(e),f.tidyHtml(a),a.focus()},merge:function(b,c,d){var e,g;switch(c){case"before":e=h.previous(b),g=b;break;case"after":e=b,g=h.next(b)}e&&g&&(d=e.childNodes.length>0?a.appendTo(e,g.innerHTML):a.prependTo(e,g.innerHTML),g.parentNode.removeChild(g),d.save(),f.tidyHtml(e),d.restore(),d.setVisibleSelection())},empty:function(a){g("Default empty behavior")},"switch":function(a,b,c){var d,e;switch(b){case"before":e=h.previous(a),e&&(c.moveAtTextEnd(e),c.setVisibleSelection());break;case"after":d=h.next(a),d&&(c.moveAtBeginning(d),c.setVisibleSelection())}},move:function(a,b,c){g("Default move behavior")},paste:function(b,c,e){var g,h=c[0];if(e.insertBefore(h),c.length<=1)e.setVisibleSelection();else{for(var i=b.parentNode,j=b,k=1;k<c.length;k++){var l=b.cloneNode(!1);l.id&&l.removeAttribute("id"),g=f.createFragmentFromString(c[k]),d(l).append(g),i.insertBefore(l,j.nextSibling),j=l}e=a.createCursorAtEnd(j),e.setVisibleSelection()}},clipboard:function(a,b,c){g("Default clipboard behavior")}}}},{"./block":2,"./content":5,"./parser":17,"./util/log":24,jquery:"jquery"}],8:[function(a,b,c){var d=a("./create-default-behavior");b.exports=function(a){var b=d(a);return{focus:function(a){b.focus(a)},blur:function(a){b.blur(a)},flow:function(a,c){b.flow(a,c)},selection:function(a,c){b.selection(a,c)},cursor:function(a,c){b.cursor(a,c)},newline:function(a,c){b.newline(a,c)},split:function(a,c,d,e){b.split(a,c,d,e)},insert:function(a,c,d){b.insert(a,c,d)},merge:function(a,c,d){b.merge(a,c,d)},empty:function(a){b.empty(a)},"switch":function(a,c,d){b["switch"](a,c,d)},move:function(a,c,d){b.move(a,c,d)},clipboard:function(a,c,d){b.clipboard(a,c,d)},paste:function(a,c,d){b.paste(a,c,d)}}}},{"./create-default-behavior":7}],9:[function(a,b,c){var d,e=a("rangy"),f=a("jquery"),g=a("./content"),h=a("./parser"),i=a("./util/string"),j=a("./node-type"),k=a("./util/error"),l=a("./range-save-restore");b.exports=d=function(){var a=function(a,b){this.setHost(a),this.range=b,this.isCursor=!0};return a.prototype=function(){return{isAtEnd:function(){return h.isEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtTextEnd:function(){return h.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtBeginning:function(){return h.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)},insertBefore:function(a){if(i.isString(a)&&(a=g.createFragmentFromString(a)),!h.isDocumentFragmentWithoutChildren(a)){a=this.adoptElement(a);var b=a;if(a.nodeType===j.documentFragmentNode){var c=a.childNodes.length-1;b=a.childNodes[c]}this.range.insertNode(a),this.range.setStartAfter(b),this.range.setEndAfter(b)}},insertAfter:function(a){i.isString(a)&&(a=g.createFragmentFromString(a)),h.isDocumentFragmentWithoutChildren(a)||(a=this.adoptElement(a),this.range.insertNode(a))},setSelection:function(){this.setVisibleSelection()},setVisibleSelection:function(){this.win.document.activeElement!==this.host&&f(this.host).focus(),e.getSelection(this.win).setSingleRange(this.range)},before:function(){var a=null,b=this.range.cloneRange();return b.setStartBefore(this.host),a=g.cloneRangeContents(b)},beforeHtml:function(){return g.getInnerHtmlOfFragment(this.before())},after:function(){var a=null,b=this.range.cloneRange();return b.setEndAfter(this.host),a=g.cloneRangeContents(b)},afterHtml:function(){return g.getInnerHtmlOfFragment(this.after())},getCoordinates:function(a){a=a||"absolute";var b=this.range.nativeRange.getBoundingClientRect();if("fixed"===a)return b;var c=this.win,d=void 0!==c.pageXOffset?c.pageXOffset:(c.document.documentElement||c.document.body.parentNode||c.document.body).scrollLeft,e=void 0!==c.pageYOffset?c.pageYOffset:(c.document.documentElement||c.document.body.parentNode||c.document.body).scrollTop;return{top:b.top+e,bottom:b.bottom+e,left:b.left+d,right:b.right+d,height:b.height,width:b.width}},moveBefore:function(b){return this.updateHost(b),this.range.setStartBefore(b),this.range.setEndBefore(b),this.isSelection?new a(this.host,this.range):void 0},moveAfter:function(b){return this.updateHost(b),this.range.setStartAfter(b),this.range.setEndAfter(b),this.isSelection?new a(this.host,this.range):void 0},moveAtBeginning:function(b){return b||(b=this.host),this.updateHost(b),this.range.selectNodeContents(b),this.range.collapse(!0),this.isSelection?new a(this.host,this.range):void 0},moveAtEnd:function(b){return b||(b=this.host),this.updateHost(b),this.range.selectNodeContents(b),this.range.collapse(!1),this.isSelection?new a(this.host,this.range):void 0},moveAtTextEnd:function(a){return this.moveAtEnd(h.latestChild(a))},setHost:function(a){a.jquery&&(a=a[0]),this.host=a,this.win=void 0===a||null===a?window:a.ownerDocument.defaultView},updateHost:function(a){var b=h.getHost(a);b||k("Can not set cursor outside of an editable block"),this.setHost(b)},retainVisibleSelection:function(a){this.save(),a(),this.restore(),this.setVisibleSelection()},save:function(){this.savedRangeInfo=l.save(this.range),this.savedRangeInfo.host=this.host},restore:function(){this.savedRangeInfo?(this.host=this.savedRangeInfo.host,this.range=l.restore(this.host,this.savedRangeInfo),this.savedRangeInfo=void 0):k("Could not restore selection")},equals:function(a){return a&&a.host&&a.host.isEqualNode(this.host)&&a.range&&a.range.equals(this.range)?!0:!1},createElement:function(a){return this.win.document.createElement(a)},adoptElement:function(a){return g.adoptElement(a,this.win.document)},triggerChange:function(){f(this.host).trigger("formatEditable")}}}(),a}()},{"./content":5,"./node-type":16,"./parser":17,"./range-save-restore":19,"./util/error":23,"./util/string":25,jquery:"jquery",rangy:"rangy"}],10:[function(a,b,c){var d=a("jquery"),e=a("./feature-detection"),f=a("./clipboard"),g=a("./eventable"),h=a("./selection-watcher"),i=a("./config"),j=a("./keyboard"),k=function(a){var b=a.win;g(this,a),this.supportsInputEvent=!1,this.$document=d(b.document),this.config=a.config,this.editable=a,this.editableSelector=a.editableSelector,this.selectionWatcher=new h(this,b),this.keyboard=new j(this.selectionWatcher),this.setup()};b.exports=k;var l=!1;k.prototype.setup=function(){this.setupElementEvents(),this.setupKeyboardEvents(),e.selectionchange?this.setupSelectionChangeEvents():this.setupSelectionChangeFallback()},k.prototype.unload=function(){this.off(),this.$document.off(".editable")},k.prototype.setupElementEvents=function(){var a=this;this.$document.on("focus.editable",a.editableSelector,function(b){this.getAttribute(i.pastingAttribute)||a.notify("focus",this)}).on("blur.editable",a.editableSelector,function(b){this.getAttribute(i.pastingAttribute)||a.notify("blur",this)}).on("copy.editable",a.editableSelector,function(b){var c=a.selectionWatcher.getFreshSelection();c.isSelection&&a.notify("clipboard",this,"copy",c)}).on("cut.editable",a.editableSelector,function(b){var c=a.selectionWatcher.getFreshSelection();c.isSelection&&(a.notify("clipboard",this,"cut",c),a.triggerChangeEvent(this))}).on("paste.editable",a.editableSelector,function(b){var c=this,d=function(b,d){b.length?(a.notify("paste",c,b,d),a.notify("change",c)):d.setVisibleSelection()},e=a.selectionWatcher.getFreshSelection();f.paste(this,e,d)}).on("input.editable",a.editableSelector,function(b){l?a.notify("change",this):l=!0}).on("formatEditable.editable",a.editableSelector,function(b){a.notify("change",this)})},k.prototype.triggerChangeEvent=function(a){l||this.notify("change",a)},k.prototype.dispatchSwitchEvent=function(a,b,c){var d;if(!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)&&(d=this.selectionWatcher.getSelection(),d&&!d.isSelection)){var e=this;setTimeout(function(){var f=e.selectionWatcher.forceCursor();f.equals(d)&&(a.preventDefault(),a.stopPropagation(),e.notify("switch",b,c,f))},1)}},k.prototype.setupKeyboardEvents=function(){var a=this;this.$document.on("keydown.editable",this.editableSelector,function(b){var c=!l;a.keyboard.dispatchKeyEvent(b,this,c)}),this.keyboard.on("left",function(b){a.dispatchSwitchEvent(b,this,"before")}).on("up",function(b){a.dispatchSwitchEvent(b,this,"before")}).on("right",function(b){a.dispatchSwitchEvent(b,this,"after")}).on("down",function(b){a.dispatchSwitchEvent(b,this,"after")}).on("tab",function(a){}).on("shiftTab",function(a){}).on("esc",function(a){}).on("backspace",function(b){var c=a.selectionWatcher.getFreshRange();if(c.isCursor){var d=c.getCursor();d.isAtBeginning()?(b.preventDefault(),b.stopPropagation(),a.notify("merge",this,"before",d)):a.triggerChangeEvent(this)}else a.triggerChangeEvent(this)}).on("delete",function(b){var c=a.selectionWatcher.getFreshRange();if(c.isCursor){var d=c.getCursor();d.isAtTextEnd()?(b.preventDefault(),b.stopPropagation(),a.notify("merge",this,"after",d)):a.triggerChangeEvent(this)}else a.triggerChangeEvent(this)}).on("enter",function(b){b.preventDefault(),b.stopPropagation();var c=a.selectionWatcher.getFreshRange(),d=c.forceCursor();d.isAtTextEnd()?a.notify("insert",this,"after",d):d.isAtBeginning()?a.notify("insert",this,"before",d):a.notify("split",this,d.before(),d.after(),d)}).on("shiftEnter",function(b){b.preventDefault(),b.stopPropagation();var c=a.selectionWatcher.forceCursor();a.notify("newline",this,c)}).on("character",function(b){a.notify("change",this)})},k.prototype.setupSelectionChangeEvents=function(){var a=!1,b=!1,c=this.$document,e=this.selectionWatcher,f=this;c.on("selectionchange.editable",function(c){b?a=!0:e.selectionChanged()}),c.on("mousedown.editable",this.editableSelector,function(g){f.config.mouseMoveSelectionChanges===!1&&(b=!0,setTimeout(d.proxy(e,"selectionChanged"),0)),c.on("mouseup.editableSelection",function(d){c.off(".editableSelection"),b=!1,a&&(a=!1,e.selectionChanged())})})},k.prototype.setupSelectionChangeFallback=function(){var a=this.$document,b=this.selectionWatcher;a.on("mouseup.editableSelection",function(a){setTimeout(d.proxy(b,"selectionChanged"),0)}),a.on("keyup.editable",this.editableSelector,function(a){b.selectionChanged()})}},{"./clipboard":3,"./config":4,"./eventable":11,"./feature-detection":12,"./keyboard":14,"./selection-watcher":20,jquery:"jquery"}],11:[function(a,b,c){var d=function(a){var b={},c=function(a,c){void 0===b[a]&&(b[a]=[]),b[a].push(c)},d=function(a,c){var d=b[a];if(void 0!==d)for(var e=0,f=d.length;f>e;e++)if(d[e]===c){d.splice(e,1);break}};return{on:function(a,b){if(2===arguments.length)c(a,b);else if(1===arguments.length){var d=a;for(var e in d)c(e,d[e])}return this},off:function(a,c){2===arguments.length?d(a,c):1===arguments.length?b[a]=[]:b={}},notify:function(c,d){var e=Array.prototype.slice.call(arguments);a?(d=c,c=a,e=e.splice(1)):e=e.splice(2);var f=b[d];if(void 0!==f)for(var g=f.length-1;g>=0&&f[g].apply(c,e)!==!1;g--);}}};b.exports=function(a,b){var c=d(b);for(var e in c)a[e]=c[e]}},{}],12:[function(a,b,c){var d=a("bowser");b.exports=function(){var a="undefined"!=typeof document.documentElement.contentEditable,b=function(){return!(d.gecko||d.opera)}(),c=function(){return!!d.webkit}();return{contenteditable:a,selectionchange:b,contenteditableSpanBug:c}}()},{bowser:1}],13:[function(a,b,c){var d=a("rangy"),e=a("./node-iterator"),f=a("./node-type");b.exports=function(){return{extractText:function(a){var b="";return this.getText(a,function(a){b+=a}),b},getText:function(a,b){for(var c,d=new e(a);c=d.getNext();)c.nodeType===f.textNode&&""!==c.data?b(c.data):c.nodeType===f.elementNode&&"BR"===c.nodeName&&b(" ")},highlight:function(a,b,c){var d=this.find(a,b);this.highlightMatches(a,d,c)},find:function(a,b){for(var c,d=this.extractText(a),e=[],f=0;c=b.exec(d);)e.push(this.prepareMatch(c,f)),f+=1;return e},highlightMatches:function(a,b,c){if(b&&0!==b.length)for(var d,g,h,i,j,k,l,m=0,n=b[m],o=0,p=new e(a),q=[];d=p.getNext();)if(d.nodeType===f.textNode&&""!==d.data){g=d;var r=g.data,s=o+r.length;if(n.startIndex<s&&o<n.endIndex){j=k=!1,o<=n.startIndex&&(j=!0,l=n.startIndex),s>=n.endIndex&&(k=!0),i=j?n.startIndex-o:0,h=k?n.endIndex-o-i:r.length-i;var t={element:g,text:r.substring(i,i+h),offset:i,length:h,isLastPortion:k,wordId:l};if(q.push(t),k){var u=this.wrapWord(q,c);p.replaceCurrent(u),s=o+t.length+t.offset,q=[],m+=1,m<b.length&&(n=b[m])}}o=s}else if(d.nodeType===f.elementNode&&"BR"===d.nodeName){o+=1;continue}},getRange:function(a){var b=d.createRange();return b.selectNodeContents(a),b},wrapWord:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];c=this.wrapPortion(e,b)}return c},wrapPortion:function(a,b){var c=d.createRange();c.setStart(a.element,a.offset),c.setEnd(a.element,a.offset+a.length);var e=b.cloneNode(!0);if(e.setAttribute("data-word-id",a.wordId),c.surroundContents(e),e.nextSibling){var g=e.nextSibling;g.nodeType===f.textNode&&""===g.data&&g.parentNode.removeChild(g)}return e},prepareMatch:function(a,b){return a[2]?this.prepareMatchForSecondSubgroup(a,b):{startIndex:a.index,endIndex:a.index+a[0].length,matchIndex:b,search:a[0]}},prepareMatchForSecondSubgroup:function(a,b){var c=a.index;return c+=a[1].length,{startIndex:c,endIndex:c+a[2].length,matchIndex:b,search:a[0]}}}}()},{"./node-iterator":15,"./node-type":16,rangy:"rangy"}],14:[function(a,b,c){var d=a("./feature-detection"),e=a("./node-type"),f=a("./eventable"),g=function(a){f(this),this.selectionWatcher=a};b.exports=g,g.prototype.dispatchKeyEvent=function(a,b,c){switch(a.keyCode){case this.key.left:this.notify(b,"left",a);break;case this.key.right:this.notify(b,"right",a);break;case this.key.up:this.notify(b,"up",a);break;case this.key.down:this.notify(b,"down",a);break;case this.key.tab:a.shiftKey?this.notify(b,"shiftTab",a):this.notify(b,"tab",a);break;case this.key.esc:this.notify(b,"esc",a);break;case this.key.backspace:this.preventContenteditableBug(b,a),this.notify(b,"backspace",a);break;case this.key["delete"]:this.preventContenteditableBug(b,a),this.notify(b,"delete",a);break;case this.key.enter:a.shiftKey?this.notify(b,"shiftEnter",a):this.notify(b,"enter",a);break;case this.key.ctrl:case this.key.shift:case this.key.alt:break;case 224:case 17:case 91:case 93:break;default:this.preventContenteditableBug(b,a),c&&this.notify(b,"character",a)}},g.prototype.preventContenteditableBug=function(a,b){if(d.contenteditableSpanBug){if(b.ctrlKey||b.metaKey)return;var c=this.selectionWatcher.getFreshRange();if(c.isSelection){var f,g=c.range;0===g.startOffset&&(g.startContainer.nodeType===e.textNode?f=g.startContainer.parentNode:g.startContainer.nodeType===e.elementNode&&(f=g.startContainer)),f&&f!==a&&g.containsNode(f,!0)&&f.remove()}}},g.prototype.key={left:37,up:38,right:39,down:40,tab:9,esc:27,backspace:8,"delete":46,enter:13,shift:16,ctrl:17,alt:18},g.key=g.prototype.key},{"./eventable":11,"./feature-detection":12,"./node-type":16}],15:[function(a,b,c){var d,e=a("./node-type");b.exports=d=function(){var a=function(a){this.root=a,this.current=this.next=this.root};return a.prototype.getNextTextNode=function(){for(var a;a=this.getNext();)if(a.nodeType===e.textNode&&""!==a.data)return a},a.prototype.getNext=function(){var a,b;if(b=this.current=this.next,a=this.next=void 0,this.current)if(a=b.firstChild,a&&"remove"!==b.getAttribute("data-editable"))this.next=a;else for(;b!==this.root&&!(this.next=b.nextSibling);)b=b.parentNode;return this.current},a.prototype.replaceCurrent=function(a){this.current=a,this.next=void 0;for(var b=this.current;b!==this.root&&!(this.next=b.nextSibling);)b=b.parentNode},a}()},{"./node-type":16}],16:[function(a,b,c){b.exports={elementNode:1,attributeNode:2,textNode:3,cdataSectionNode:4,entityReferenceNode:5,entityNode:6,processingInstructionNode:7,commentNode:8,documentNode:9,documentTypeNode:10,documentFragmentNode:11,notationNode:12}},{}],17:[function(a,b,c){var d=a("jquery"),e=a("./util/string"),f=a("./node-type"),g=a("./config");b.exports=function(){return{getHost:function(a){var b="."+g.editableClass,c=d(a).closest(b);return c.length?c[0]:void 0},getNodeIndex:function(a){for(var b=0;null!==(a=a.previousSibling);)b+=1;return b},isVoid:function(a){var b,c,d,e=a.childNodes;for(c=0,d=e.length;d>c;c++){if(b=e[c],b.nodeType===f.textNode&&!this.isVoidTextNode(b))return!1;if(b.nodeType===f.elementNode)return!1}return!0},isVoidTextNode:function(a){return a.nodeType===f.textNode&&!a.nodeValue},isWhitespaceOnly:function(a){return a.nodeType===f.textNode&&0===this.lastOffsetWithContent(a)},isLinebreak:function(a){return a.nodeType===f.elementNode&&"BR"===a.tagName},lastOffsetWithContent:function(a){if(a.nodeType===f.textNode)return e.trimRight(a.nodeValue).length;var b,c=a.childNodes;for(b=c.length-1;b>=0;b--)if(a=c[b],!this.isWhitespaceOnly(a)&&!this.isLinebreak(a))return b+1;return 0},isBeginningOfHost:function(a,b,c){if(b===a)return this.isStartOffset(b,c);if(this.isStartOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b);return this.isBeginningOfHost(a,d,e)}return!1},isEndOfHost:function(a,b,c){if(b===a)return this.isEndOffset(b,c);if(this.isEndOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b)+1;return this.isEndOfHost(a,d,e)}return!1},isStartOffset:function(a,b){return a.nodeType===f.textNode?0===b:0===a.childNodes.length?!0:a.childNodes[b]===a.firstChild},isEndOffset:function(a,b){return a.nodeType===f.textNode?b===a.length:0===a.childNodes.length?!0:b>0?a.childNodes[b-1]===a.lastChild:!1},isTextEndOfHost:function(a,b,c){if(b===a)return this.isTextEndOffset(b,c);if(this.isTextEndOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b)+1;return this.isTextEndOfHost(a,d,e)}return!1},isTextEndOffset:function(a,b){if(a.nodeType===f.textNode){var c=e.trimRight(a.nodeValue);return b>=c.length}if(0===a.childNodes.length)return!0;var d=this.lastOffsetWithContent(a);return b>=d},isSameNode:function(a,b){var c,d,e;if(a.nodeType!==b.nodeType)return!1;if(a.nodeName!==b.nodeName)return!1;for(c=0,d=a.attributes.length;d>c;c++)if(e=a.attributes[c],b.getAttribute(e.name)!==e.value)return!1;return!0},latestChild:function(a){return a.lastChild?this.latestChild(a.lastChild):a},isDocumentFragmentWithoutChildren:function(a){return a&&a.nodeType===f.documentFragmentNode&&0===a.childNodes.length?!0:!1},isInlineElement:function(a,b){var c=b.currentStyle||a.getComputedStyle(b,""),d=c.display;switch(d){case"inline":case"inline-block":return!0;default:return!1}}}}()},{"./config":4,"./node-type":16,"./util/string":25,jquery:"jquery"}],18:[function(a,b,c){var d,e=a("./cursor"),f=a("./selection");b.exports=d=function(a,b){this.host=a&&a.jquery?a[0]:a,this.range=b,this.isAnythingSelected=void 0!==b,this.isCursor=this.isAnythingSelected&&b.collapsed,this.isSelection=this.isAnythingSelected&&!this.isCursor},d.prototype.getCursor=function(){return this.isCursor?new e(this.host,this.range):void 0},d.prototype.getSelection=function(){return this.isSelection?new f(this.host,this.range):void 0},d.prototype.forceCursor=function(){if(this.isSelection){var a=this.getSelection();return a.deleteContent()}return this.getCursor()},d.prototype.isDifferentFrom=function(a){a=a||new d;var b=this.range,c=a.range;return b&&c?!b.equals(c):b||c?!0:!1}},{"./cursor":9,"./selection":21}],19:[function(a,b,c){var d=a("rangy"),e=a("./util/error"),f=a("./node-type");b.exports=function(){var a=0,b="\ufeff",c=function(a,b){return a.querySelector("#"+b)};return{insertRangeBoundaryMarker:function(c,d){var f,g="editable-range-boundary-"+(a+=1),h=c.commonAncestorContainer;(null===h.ownerDocument||void 0===h.ownerDocument)&&e("Cannot save range: range is emtpy");var i=h.ownerDocument.defaultView.document,j=c.cloneRange();return j.collapse(d),f=i.createElement("span"),f.id=g,f.setAttribute("data-editable","remove"),f.style.lineHeight="0",f.style.display="none",f.appendChild(i.createTextNode(b)),j.insertNode(f),f},setRangeBoundary:function(a,b,d,e){var f=c(a,d);f?(b[e?"setStartBefore":"setEndBefore"](f),f.parentNode.removeChild(f)):console.log("Marker element has been removed. Cannot restore selection.")},save:function(a){var b,c,d;return a.collapsed?(d=this.insertRangeBoundaryMarker(a,!1),b={markerId:d.id,collapsed:!0}):(d=this.insertRangeBoundaryMarker(a,!1),c=this.insertRangeBoundaryMarker(a,!0),b={startMarkerId:c.id,endMarkerId:d.id,collapsed:!1}),a.collapsed?a.collapseBefore(d):(a.setEndBefore(d),a.setStartAfter(c)),b},restore:function(a,b){if(!b.restored){var e=d.createRange();if(b.collapsed){var g=c(a,b.markerId);if(g){g.style.display="inline";var h=g.previousSibling;h&&h.nodeType===f.textNode?(g.parentNode.removeChild(g),e.collapseToPoint(h,h.length)):(e.collapseBefore(g),g.parentNode.removeChild(g))}else console.log("Marker element has been removed. Cannot restore selection.")}else this.setRangeBoundary(a,e,b.startMarkerId,!0),this.setRangeBoundary(a,e,b.endMarkerId,!1);return e.normalizeBoundaries(),e}}}}()},{"./node-type":16,"./util/error":23,rangy:"rangy"}],20:[function(a,b,c){var d,e=a("rangy"),f=a("./parser"),g=a("./range-container"),h=a("./cursor"),i=a("./selection");b.exports=d=function(a,b){this.dispatcher=a,this.win=b||window,this.rangySelection=void 0,this.currentSelection=void 0,this.currentRange=void 0},d.prototype.getRangeContainer=function(){if(this.rangySelection=e.getSelection(this.win),this.rangySelection.rangeCount){var a=this.rangySelection.getRangeAt(0),b=f.getHost(a.commonAncestorContainer);if(b)return new g(b,a)}return new g},d.prototype.getFreshRange=function(){return this.getRangeContainer()},d.prototype.getFreshSelection=function(){var a=this.getRangeContainer();return a.isCursor?a.getCursor(this.win):a.getSelection(this.win)},d.prototype.getSelection=function(){return this.currentSelection},d.prototype.forceCursor=function(){var a=this.getRangeContainer();return a.forceCursor()},d.prototype.selectionChanged=function(){var a=this.getRangeContainer();if(a.isDifferentFrom(this.currentRange)){var b=this.currentSelection;this.currentRange=a,b&&(b.isCursor&&!this.currentRange.isCursor?this.dispatcher.notify("cursor",b.host):b.isSelection&&!this.currentRange.isSelection&&this.dispatcher.notify("selection",b.host)),this.currentRange.isCursor?(this.currentSelection=new h(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("cursor",this.currentSelection.host,this.currentSelection)):this.currentRange.isSelection?(this.currentSelection=new i(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("selection",this.currentSelection.host,this.currentSelection)):this.currentSelection=void 0}}},{"./cursor":9,"./parser":17,"./range-container":18,"./selection":21,rangy:"rangy"}],21:[function(a,b,c){var d=a("jquery"),e=a("./cursor"),f=a("./content"),g=a("./parser"),h=a("./config");b.exports=function(){var a=function(a,b){this.setHost(a),this.range=b,this.isSelection=!0},b=function(){};return b.prototype=e.prototype,a.prototype=d.extend(new b,{text:function(){return this.range.toString()},html:function(){return this.range.toHtml()},isAllSelected:function(){return g.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)&&g.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},getRects:function(){var a=this.range.nativeRange.getClientRects();return a},link:function(a,b){var c=d(this.createElement("a"));a&&c.attr("href",a);for(var e in b)c.attr(e,b[e]);this.forceWrap(c[0])},unlink:function(){this.removeFormatting("a")},toggleLink:function(a,b){var c=this.getTagsByName("a");if(c.length>=1){var d=c[0];this.isExactSelection(d,"visible")?this.unlink():this.expandTo(d)}else this.link(a,b)},toggle:function(a){a=this.adoptElement(a),this.range=f.toggleTag(this.host,this.range,a),this.setSelection()},makeBold:function(){var a=this.createElement(h.boldTag);this.forceWrap(a)},toggleBold:function(){var a=this.createElement(h.boldTag);this.toggle(a)},giveEmphasis:function(){var a=this.createElement(h.italicTag);this.forceWrap(a)},toggleEmphasis:function(){var a=this.createElement(h.italicTag);this.toggle(a)},surround:function(a,b){this.range=f.surround(this.host,this.range,a,b),this.setSelection()},removeSurround:function(a,b){this.range=f.deleteCharacter(this.host,this.range,a),this.range=f.deleteCharacter(this.host,this.range,b),this.setSelection()},toggleSurround:function(a,b){this.containsString(a)&&this.containsString(b)?this.removeSurround(a,b):this.surround(a,b)},removeFormatting:function(a){this.range=f.removeFormatting(this.host,this.range,a),this.setSelection()},deleteContent:function(){return this.range.deleteContents(),new e(this.host,this.range)},expandTo:function(a){this.range=f.expandTo(this.host,this.range,a),this.setSelection()},collapseAtBeginning:function(a){return this.range.collapse(!0),this.setSelection(),new e(this.host,this.range)},collapseAtEnd:function(a){return this.range.collapse(!1),this.setSelection(),new e(this.host,this.range)},forceWrap:function(a){a=this.adoptElement(a),this.range=f.forceWrap(this.host,this.range,a),this.setSelection()},getTags:function(a){return f.getTags(this.host,this.range,a)},getTagsByName:function(a){return f.getTagsByName(this.host,this.range,a)},isExactSelection:function(a,b){return f.isExactSelection(this.range,a,b)},containsString:function(a){return f.containsString(this.range,a)},deleteCharacter:function(a){this.range=f.deleteCharacter(this.host,this.range,a),this.setSelection()}}),a}()},{"./config":4,"./content":5,"./cursor":9,"./parser":17,jquery:"jquery"}],22:[function(a,b,c){var d=a("jquery"),e=a("./content"),f=a("./highlight-text"),g=a("./node-type");b.exports=function(){var a="\\u0041-\\u005A\\u0061-\\u007A\\u0030-\\u0039\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u00FF\\u0100-\\u017F\\u0180-\\u024F",b=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},c=function(a,b){var c={checkOnFocus:!1,checkOnChange:!0,throttle:1e3,removeOnCorrection:!0,markerNode:d('<span class="spellcheck"></span>'),spellcheckService:void 0};this.editable=a,this.win=a.win,this.config=d.extend(c,b),this.prepareMarkerNode(),this.setup()};return c.prototype.setup=function(a){this.config.checkOnFocus&&(this.editable.on("focus",d.proxy(this,"onFocus")),this.editable.on("blur",d.proxy(this,"onBlur"))),(this.config.checkOnChange||this.config.removeOnCorrection)&&this.editable.on("change",d.proxy(this,"onChange"))},c.prototype.onFocus=function(a){this.focusedEditable!==a&&(this.focusedEditable=a,this.editableHasChanged(a))},c.prototype.onBlur=function(a){this.focusedEditable===a&&(this.focusedEditable=void 0)},c.prototype.onChange=function(a){this.config.checkOnChange&&this.editableHasChanged(a,this.config.throttle),this.config.removeOnCorrection&&this.removeHighlightsAtCursor(a)},c.prototype.prepareMarkerNode=function(){var a=this.config.markerNode;a.jquery&&(a=a[0]),a=e.adoptElement(a,this.win.document),this.config.markerNode=a,a.setAttribute("data-editable","ui-unwrap"),a.setAttribute("data-spellcheck","spellcheck")},c.prototype.createMarkerNode=function(){return this.config.markerNode.cloneNode()},c.prototype.removeHighlights=function(a){d(a).find("[data-spellcheck=spellcheck]").each(function(a,b){e.unwrap(b)})},c.prototype.removeHighlightsAtCursor=function(a){var b,c=this.editable.getSelection(a);if(c&&c.isCursor){var f=c.range.startContainer;f.nodeType===g.textNode&&(f=f.parentNode);do{if(f===a)return;if(f.hasAttribute("data-word-id")){b=f.getAttribute("data-word-id");break}}while(f=f.parentNode);b&&c.retainVisibleSelection(function(){d(a).find("[data-word-id="+b+"]").each(function(a,b){e.unwrap(b)})})}},c.prototype.createRegex=function(c){var e=d.map(c,function(a){return b(a)}),f="";return f+="([^"+a+"]|^)",f+="("+e.join("|")+")",f+="(?=[^"+a+"]|$)",new RegExp(f,"g")},c.prototype.highlight=function(a,b){if(this.removeHighlights(a),b&&b.length>0){var c=this.createRegex(b),d=this.createMarkerNode();f.highlight(a,c,d)}},c.prototype.editableHasChanged=function(a,b){this.timeoutId&&this.currentEditableHost===a&&clearTimeout(this.timeoutId);var c=this;this.timeoutId=setTimeout(function(){c.checkSpelling(a),c.currentEditableHost=void 0,c.timeoutId=void 0},b||0),this.currentEditableHost=a},c.prototype.checkSpelling=function(a){var b=this,c=f.extractText(a);c=e.normalizeWhitespace(c),this.config.spellcheckService(c,function(c){var d=b.editable.getSelection(a);d?d.retainVisibleSelection(function(){b.highlight(a,c)}):b.highlight(a,c)})},c}()},{"./content":5,"./highlight-text":13,"./node-type":16,jquery:"jquery"}],23:[function(a,b,c){var d=a("../config");b.exports=function(){if(d.logErrors!==!1){var a;return a=Array.prototype.slice.call(arguments),1===a.length&&(a=a[0]),window.console&&"function"==typeof window.console.error?console.error(a):window.console?console.log(a):void 0}}},{"../config":4}],24:[function(a,b,c){var d=a("../config");b.exports=function(){if(d.log!==!1){var a,b;return a=Array.prototype.slice.call(arguments),a.length&&"trace"===a[a.length-1]&&(a.pop(),((b=window.console)?b.trace:void 0)&&console.trace()),1===a.length&&(a=a[0]),window.console?console.log(a):void 0}}},{"../config":4}],25:[function(a,b,c){b.exports=function(){var a=Object.prototype.toString,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return{trimRight:function(a){return a.replace(/\s+$/,"")},trimLeft:function(a){return a.replace(/^\s+/,"")},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},isString:function(b){return"[object String]"===a.call(b)},regexp:function(a,b){b||(b="g");var c=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return new RegExp(c,b)},escapeHtml:function(a,c){return a.replace(c?/[&<>'"]/g:/[&<>]/g,function(a){return b[a]})},browserEscapeHtml:function(a){var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),b.innerHTML}}}()},{}],jquery:[function(a,b,c){b.exports=$},{}],rangy:[function(a,b,c){b.exports=rangy},{}]},{},[6]);