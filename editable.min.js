window.rangy=function(){function e(e,t){var n=typeof e[t];return n==h||!(n!=d||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=d||!e[t])}function n(e,t){return typeof e[t]!=l}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&v(e,m)&&y(e,p)}function i(e){window.alert("Rangy not supported in your browser. Reason: "+e),R.initialized=!0,R.supported=!1}function s(e){var t="Rangy warning: "+e;R.config.alertOnWarn?window.alert(t):typeof window.console!=l&&typeof window.console.log!=l&&window.console.log(t)}function a(){if(!R.initialized){var n,r=!1,s=!1;e(document,"createRange")&&(n=document.createRange(),v(n,g)&&y(n,f)&&(r=!0),n.detach());var a=t(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&e(a,"createTextRange")&&(n=a.createTextRange(),o(n)&&(s=!0)),r||s||i("Neither Range nor TextRange are implemented"),R.initialized=!0,R.features={implementsDomRange:r,implementsTextRange:s};for(var c=S.concat(N),u=0,d=c.length;d>u;++u)try{c[u](R)}catch(h){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}}function c(e){e=e||window,a();for(var t=0,n=E.length;n>t;++t)E[t](e)}function u(e){this.name=e,this.initialized=!1,this.supported=!1}var d="object",h="function",l="undefined",f=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],g=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],m=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=r(e),C=r(t),y=r(n),R={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:C,areHostProperties:y,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};R.fail=i,R.warn=s,{}.hasOwnProperty?R.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:i("hasOwnProperty not supported");var N=[],S=[];R.init=a,R.addInitListener=function(e){R.initialized?e(R):N.push(e)};var E=[];R.addCreateMissingNativeApiListener=function(e){E.push(e)},R.createMissingNativeApi=c,u.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},u.prototype.warn=function(e){R.warn("Module "+this.name+": "+e)},u.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)},R.createModule=function(e,t){var n=new u(e);R.modules[e]=n,S.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},R.requireModules=function(e){for(var t,n,r=0,o=e.length;o>r;++r){if(n=e[r],t=R.modules[n],!(t&&t instanceof u))throw Error("Module '"+n+"' not found");if(!t.supported)throw Error("Module '"+n+"' not supported")}};var b=!1,w=function(){b||(b=!0,R.initialized||a())};return typeof window==l?(i("No window found"),void 0):typeof document==l?(i("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",w,!1),e(window,"addEventListener")?window.addEventListener("load",w,!1):e(window,"attachEvent")?window.attachEvent("onload",w):i("Window does not have required addEventListener or attachEvent method"),R)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==w||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)t++;return t}function i(e){var t;return u(e)?e.length:(t=e.childNodes)?t.length:0}function s(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(D(r,n))return n;return null}function a(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t,n){for(var r,o=n?e:e.parentNode;o;){if(r=o.parentNode,r===t)return o;o=r}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),d(n,e),n}function l(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=w)return e.ownerDocument;if(typeof e.document!=w)return e.document;if(e.parentNode)return l(e.parentNode);throw Error("getDocument: no document found for node")}function f(e){var t=l(e);if(typeof t.defaultView!=w)return t.defaultView;if(typeof t.parentWindow!=w)return t.parentWindow;throw Error("Cannot get a window object for node")}function g(e){if(typeof e.contentDocument!=w)return e.contentDocument;if(typeof e.contentWindow!=w)return e.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")}function p(e){if(typeof e.contentWindow!=w)return e.contentWindow;if(typeof e.contentDocument!=w)return e.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")}function m(e){return T.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,t,n,r){var i,a,u,d,h;if(e==n)return t===r?0:r>t?-1:1;if(i=c(n,e,!0))return o(i)>=t?-1:1;if(i=c(e,n,!0))return r>o(i)?-1:1;if(a=s(e,n),u=e===a?a:c(e,a,!0),d=n===a?a:c(n,a,!0),u===d)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(h=a.firstChild;h;){if(h===u)return-1;if(h===d)return 1;h=h.nextSibling}throw Error("Should not be here!")}function y(e){for(var t,n=l(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function R(e){if(!e)return"[No node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function N(e){this.root=e,this._next=e}function S(e){return new N(e)}function E(e,t){this.node=e,this.offset=t}function b(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var w="undefined",T=e.util;T.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),T.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var O=document.createElement("div");T.areHostMethods(O,["insertBefore","appendChild","cloneNode"]||!T.areHostObjects(O,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),T.isHostProperty(O,"innerHTML")||t.fail("Element is missing innerHTML property");var _=document.createTextNode("test");T.areHostMethods(_,["splitText","deleteData","insertData","appendData","cloneNode"]||!T.areHostObjects(O,["previousSibling","nextSibling","childNodes","parentNode"])||!T.areHostProperties(_,["data"]))||t.fail("Incomplete Text Node implementation");var D=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};N.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},E.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+R(this.node)+":"+this.offset+")]"}},b.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},b.prototype.toString=function(){return this.message},e.dom={arrayContains:D,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:c,isCharacterDataNode:u,insertAfter:d,splitDataNode:h,getDocument:l,getWindow:f,getIframeWindow:p,getIframeDocument:g,getBody:m,getRootContainer:v,comparePoints:C,inspectNode:R,fragmentFromNodeChildren:y,createIterator:S,DomPosition:E},e.DOMException=b}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(P.isAncestorOf(e,t.startContainer,!0)||P.isAncestorOf(e,t.endContainer,!0))}function n(e){return P.getDocument(e.startContainer)}function r(e,t,n){var r=e._listeners[t];if(r)for(var o=0,i=r.length;i>o;++o)r[o].call(e,{target:e,args:n})}function o(e){return new W(e.parentNode,P.getNodeIndex(e))}function i(e){return new W(e.parentNode,P.getNodeIndex(e)+1)}function s(e,t,n){var r=11==e.nodeType?e.firstChild:e;return P.isCharacterDataNode(t)?n==t.length?P.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:P.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function a(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(a(o)),o.detach(!0)),10==r.nodeType)throw new F("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function c(e,t,n){var r,o;n=n||{stop:!1};for(var i,s;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return n.stop=!0,void 0;if(s=e.getSubtreeIterator(),c(s,t,n),s.detach(!0),n.stop)return}else for(r=P.createIterator(i);o=r.next();)if(t(o)===!1)return n.stop=!0,void 0}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach(!0)):e.remove()}function d(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach(!0)):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function h(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=RegExp("^("+t.join("|")+")$"));var s=[];return c(new f(e,!1),function(e){o&&!r.test(e.nodeType)||i&&!n(e)||s.push(e)}),s}function l(e){var t=e.getName===void 0?"Range":e.getName();return"["+t+"("+P.inspectNode(e.startContainer)+":"+e.startOffset+", "+P.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&P.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||P.isCharacterDataNode(this.sc)?P.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||P.isCharacterDataNode(this.ec)?P.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function p(e,t,n){this.nodes=h(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,P.arrayContains(e,r))return o;o=o.parentNode}return null}}function v(e,t){if(K(e,t))throw new g("INVALID_NODE_TYPE_ERR")}function C(e){if(!e.startContainer)throw new F("INVALID_STATE_ERR")}function y(e,t){if(!P.arrayContains(t,e.nodeType))throw new g("INVALID_NODE_TYPE_ERR")}function R(e,t){if(0>t||t>(P.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function N(e,t){if(Y(e,!0)!==Y(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function S(e){if($(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new F(t)}function b(e){return!P.arrayContains(V,e.nodeType)&&!Y(e,!0)}function w(e,t){return(P.isCharacterDataNode(e)?e.length:e.childNodes.length)>=t}function T(e){return!!e.startContainer&&!!e.endContainer&&!b(e.startContainer)&&!b(e.endContainer)&&w(e.startContainer,e.startOffset)&&w(e.endContainer,e.endOffset)}function O(e){if(C(e),!T(e))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function _(){}function D(e){e.START_TO_START=et,e.START_TO_END=tt,e.END_TO_END=nt,e.END_TO_START=rt,e.NODE_BEFORE=ot,e.NODE_AFTER=it,e.NODE_BEFORE_AND_AFTER=st,e.NODE_INSIDE=at}function A(e){D(e),D(e.prototype)}function x(e,t){return function(){O(this);var n,r,o=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,u=new f(this,!0);o!==a&&(n=P.getClosestAncestorIn(o,a,!0),r=i(n),o=r.node,s=r.offset),c(u,S),u.reset();var d=e(u);return u.detach(),t(this,o,s,o,s),d}}function B(n,r,s){function a(e,t){return function(n){C(this),y(n,L),y(q(n),V);var r=(e?o:i)(n);(t?c:h)(this,r.node,r.offset)}}function c(e,t,n){var o=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((q(t)!=q(o)||1==P.comparePoints(t,n,o,i))&&(o=t,i=n),r(e,t,n,o,i))}function h(e,t,n){var o=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((q(t)!=q(o)||-1==P.comparePoints(t,n,o,i))&&(o=t,i=n),r(e,o,i,t,n))}function l(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&r(e,t,n,t,n)}n.prototype=new _,e.util.extend(n.prototype,{setStart:function(e,t){C(this),v(e,!0),R(e,t),c(this,e,t)},setEnd:function(e,t){C(this),v(e,!0),R(e,t),h(this,e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){O(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){C(this),v(e,!0),r(this,e,0,e,P.getNodeLength(e))},selectNode:function(e){C(this),v(e,!1),y(e,L);var t=o(e),n=i(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:x(d,r),deleteContents:x(u,r),canSurroundContents:function(){O(this),S(this.startContainer),S(this.endContainer);var e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){s(this)},splitBoundaries:function(){O(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,o=this.endOffset,i=e===n;P.isCharacterDataNode(n)&&o>0&&n.length>o&&P.splitDataNode(n,o),P.isCharacterDataNode(e)&&t>0&&e.length>t&&(e=P.splitDataNode(e,t),i?(o-=t,n=e):n==e.parentNode&&o>=P.getNodeIndex(e)&&o++,t=0),r(this,e,t,n,o)},normalizeBoundaries:function(){O(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,o=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,o=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(r){var i=r.previousSibling;if(i&&i.nodeType==r.nodeType){e=r;var s=r.length;if(t=i.length,r.insertData(0,i.data),i.parentNode.removeChild(i),e==n)o+=t,n=e;else if(n==r.parentNode){var a=P.getNodeIndex(r);o==a?(n=r,o=s):o>a&&o--}}},a=!0;if(P.isCharacterDataNode(n))n.length==o&&i(n);else{if(o>0){var c=n.childNodes[o-1];c&&P.isCharacterDataNode(c)&&i(c)}a=!this.collapsed}if(a){if(P.isCharacterDataNode(e))0==t&&s(e);else if(e.childNodes.length>t){var u=e.childNodes[t];u&&P.isCharacterDataNode(u)&&s(u)}}else e=n,t=o;r(this,e,t,n,o)},collapseToPoint:function(e,t){C(this),v(e,!0),R(e,t),l(this,e,t)}}),A(n)}function I(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:P.getCommonAncestor(e.startContainer,e.endContainer)}function k(e,t,n,o,i){var s=e.startContainer!==t||e.startOffset!==n,a=e.endContainer!==o||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=i,I(e),r(e,"boundarychange",{startMoved:s,endMoved:a})}function H(e){C(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,r(e,"detach",null),e._listeners=null}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},I(this)}e.requireModules(["DomUtil"]);var P=e.dom,W=P.DomPosition,F=e.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,P.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!P.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new M(n(this.range));var t=this._current,r=t,o=0,i=t,s=P.getNodeLength(t);P.isAncestorOf(t,this.sc,!0)&&(r=this.sc,o=this.so),P.isAncestorOf(t,this.ec,!0)&&(i=this.ec,s=this.eo),k(e,r,o,i,s)}return new f(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},g.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},g.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var L=[1,3,4,5,7,8,10],V=[2,9,11],z=[5,6,10,12],U=[1,3,4,5,7,8,10,11],j=[1,3,4,5,7,8],q=P.getRootContainer,Y=m([9,11]),$=m(z),K=m([6,10,12]),Q=document.createElement("style"),X=!1;try{Q.innerHTML="<b>x</b>",X=3==Q.firstChild.nodeType}catch(G){}e.features.htmlParsingConforms=X;var Z=X?function(e){var t=this.startContainer,n=P.getDocument(t);if(!t)throw new F("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:P.isCharacterDataNode(t)&&(r=P.parentElement(t)),r=null===r||"HTML"==r.nodeName&&P.isHtmlNamespace(P.getDocument(r).documentElement)&&P.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,P.fragmentFromNodeChildren(r)}:function(e){C(this);var t=n(this),r=t.createElement("body");return r.innerHTML=e,P.fragmentFromNodeChildren(r)},J=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],et=0,tt=1,nt=2,rt=3,ot=0,it=1,st=2,at=3;_.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){O(this),N(this.startContainer,t.startContainer);var n,r,o,i,s=e==rt||e==et?"start":"end",a=e==tt||e==et?"start":"end";return n=this[s+"Container"],r=this[s+"Offset"],o=t[a+"Container"],i=t[a+"Offset"],P.comparePoints(n,r,o,i)},insertNode:function(e){if(O(this),y(e,U),S(this.startContainer),P.isAncestorOf(e,this.startContainer,!0))throw new F("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){O(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&P.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new f(this,!0);return e=a(r),r.detach(),e},canSurroundContents:function(){O(this),S(this.startContainer),S(this.endContainer);var e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(y(e,j),!this.canSurroundContents())throw new g("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){O(this);for(var e,t=new M(n(this)),r=J.length;r--;)e=J[r],t[e]=this[e];return t},toString:function(){O(this);var e=this.startContainer;if(e===this.endContainer&&P.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new f(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){O(this);var t=e.parentNode,n=P.getNodeIndex(e);if(!t)throw new F("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?st:ot:o>0?it:at},comparePoint:function(e,t){return O(this),E(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),0>P.comparePoints(e,t,this.startContainer,this.startOffset)?-1:P.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){O(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(O(this),E(e,"NOT_FOUND_ERR"),P.getDocument(e)!==n(this))return!1;var r=e.parentNode,o=P.getNodeIndex(e);E(r,"NOT_FOUND_ERR");var i=P.comparePoints(r,o,this.endContainer,this.endOffset),s=P.comparePoints(r,o+1,this.startContainer,this.startOffset);return t?0>=i&&s>=0:0>i&&s>0},isPointInRange:function(e,t){return O(this),E(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),P.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&0>=P.comparePoints(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e,t){if(O(this),n(e)!=n(this))throw new F("WRONG_DOCUMENT_ERR");var r=P.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),o=P.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=r&&o>=0:0>r&&o>0},intersection:function(e){if(this.intersectsRange(e)){var t=P.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=P.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==P.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==P.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new g("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==at},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&0>=this.comparePoint(e,P.getNodeLength(e))},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return O(this),new p(this,e,t)},getNodes:function(e,t){return O(this),h(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){C(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){C(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return T(this)},inspect:function(){return l(this)}},B(M,k,H),e.rangePrototype=_.prototype,M.rangeProperties=J,M.RangeIterator=f,M.copyComparisonConstants=A,M.createPrototypeRange=B,M.inspect=l,M.getRangeDocument=n,M.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=M,e.RangeException=g}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var o=n.parentElement(),i=r==o?r:s.getCommonAncestor(r,o);return i==t?i:s.getCommonAncestor(t,i)}function n(e){return 0==e.compareEndPoints("StartToEnd",e)}function r(e,t,n,r){var o=e.duplicate();o.collapse(n);var i=o.parentElement();if(s.isAncestorOf(t,i,!0)||(i=t),!i.canHaveHTML)return new a(i.parentNode,s.getNodeIndex(i));var c,u,d,h,l,f=s.getDocument(i).createElement("span"),g=n?"StartToStart":"StartToEnd";do i.insertBefore(f,f.previousSibling),o.moveToElementText(f);while((c=o.compareEndPoints(g,e))>0&&f.previousSibling);if(l=f.nextSibling,-1==c&&l&&s.isCharacterDataNode(l)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var p;if(/[\r\n]/.test(l.data)){var m=o.duplicate(),v=m.text.replace(/\r\n/g,"\r").length;for(p=m.moveStart("character",v);-1==(c=m.compareEndPoints("StartToEnd",m));)p++,m.moveStart("character",1)}else p=o.text.length;h=new a(l,p)}else u=(r||!n)&&f.previousSibling,d=(r||n)&&f.nextSibling,h=d&&s.isCharacterDataNode(d)?new a(d,0):u&&s.isCharacterDataNode(u)?new a(u,u.length):new a(i,s.getNodeIndex(f));return f.parentNode.removeChild(f),h}function o(e,t){var n,r,o,i,a=e.offset,c=s.getDocument(e.node),u=c.body.createTextRange(),d=s.isCharacterDataNode(e.node);return d?(n=e.node,r=n.parentNode):(i=e.node.childNodes,n=i.length>a?i[a]:null,r=e.node),o=c.createElement("span"),o.innerHTML="&#feff;",n?r.insertBefore(o,n):r.appendChild(o),u.moveToElementText(o),u.collapse(!t),r.removeChild(o),d&&u[t?"moveStart":"moveEnd"]("character",a),u}e.requireModules(["DomUtil","DomRange"]);var i,s=e.dom,a=s.DomPosition,c=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){i=function(e){this.textRange=e,this.refresh()},i.prototype=new c(document),i.prototype.refresh=function(){var e,o,i=t(this.textRange);n(this.textRange)?o=e=r(this.textRange,i,!0,!0):(e=r(this.textRange,i,!0,!1),o=r(this.textRange,i,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(o.node,o.offset)},c.copyComparisonConstants(i);var u=function(){return this}();u.Range===void 0&&(u.Range=i),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else(function(){function t(e){for(var t,n=d.length;n--;)t=d[n],e[t]=e.nativeRange[t]}function n(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==r||e.endOffset!=o;(i||s)&&(e.setEnd(r,o),e.setStart(t,n))}function r(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=d.length;n--;)t=d[n],e[t]=null}var o,a,u,d=c.rangeProperties;i=function(e){if(!e)throw Error("Range must be specified");this.nativeRange=e,t(this)},c.createPrototypeRange(i,n,r),o=i.prototype,o.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},o.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},o.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},o.collapse=function(e){this.nativeRange.collapse(e),t(this)},o.cloneRange=function(){return new i(this.nativeRange.cloneRange())},o.refresh=function(){t(this)},o.toString=function(){return""+this.nativeRange};var h=document.createTextNode("test");s.getBody(document).appendChild(h);var l=document.createRange();l.setStart(h,0),l.setEnd(h,0);try{l.setStart(h,1),a=!0,o.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},o.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},u=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(f){a=!1,o.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(r){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},o.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(r){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},u=function(e,n){return function(r){try{this.nativeRange[e](r)}catch(o){this.nativeRange[n](r),this.nativeRange[e](r)}t(this)}}}o.setStartBefore=u("setStartBefore","setEndBefore"),o.setStartAfter=u("setStartAfter","setEndAfter"),o.setEndBefore=u("setEndBefore","setStartBefore"),o.setEndAfter=u("setEndAfter","setStartAfter"),l.selectNodeContents(h),o.selectNodeContents=l.startContainer==h&&l.endContainer==h&&0==l.startOffset&&l.endOffset==h.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,c.getEndOffset(e))},l.selectNodeContents(h),l.setEnd(h,3);var g=document.createRange();g.selectNodeContents(h),g.setEnd(h,4),g.setStart(h,2),o.compareBoundaryPoints=-1==l.compareBoundaryPoints(l.START_TO_END,g)&1==l.compareBoundaryPoints(l.END_TO_START,g)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(l,"createContextualFragment")&&(o.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(h),l.detach(),g.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(i.rangeToTextRange=function(e){if(e.collapsed){var t=o(new a(e.startContainer,e.startOffset),!0);return t}var n=o(new a(e.startContainer,e.startOffset),!0),r=o(new a(e.endContainer,e.endOffset),!1),i=s.getDocument(e.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",n),i.setEndPoint("EndToEnd",r),i}),i.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=i,e.createRange=function(t){return t=t||document,new i(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new c(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;n.createRange===void 0&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function r(e){return(e||window).document.selection}function o(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function i(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var n;return t instanceof b?(n=t._selectionNativeRange,n||(n=e.createNativeRange(S.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof w?n=t.nativeRange:e.features.implementsDomRange&&t instanceof S.getWindow(t.startContainer).Range&&(n=t),n}function c(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!S.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var t=e.getNodes();if(!c(t))throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function d(e){return!!e&&e.text!==void 0}function h(e,t){var n=new w(t);e._ranges=[n],o(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function l(t){if(t._ranges.length=0,"None"==t.docSelection.type)s(t);else{var n=t.docSelection.createRange();if(d(n))h(t,n);else{t.rangeCount=n.length;for(var r,i=S.getDocument(n.item(0)),a=0;t.rangeCount>a;++a)r=e.createRange(i),r.selectNode(n.item(a)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,o(t,t._ranges[t.rangeCount-1],!1)
}}}function f(e,t){for(var n=e.docSelection.createRange(),r=u(t),o=S.getDocument(n.item(0)),i=S.getBody(o).createControlRange(),s=0,a=n.length;a>s;++s)i.add(n.item(s));try{i.add(r)}catch(c){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),l(e)}function g(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function p(e,t){for(var n,r=S.getDocument(t[0].startContainer),o=S.getBody(r).createControlRange(),i=0;rangeCount>i;++i){n=u(t[i]);try{o.add(n)}catch(s){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),l(e)}function m(e,t){if(e.anchorNode&&S.getDocument(e.anchorNode)!==S.getDocument(t))throw new T("WRONG_DOCUMENT_ERR")}function v(e){var t=[],n=new O(e.anchorNode,e.anchorOffset),r=new O(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(e.rangeCount!==void 0)for(var i=0,s=e.rangeCount;s>i;++i)t[i]=b.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var C,y,R="boolean",N="_rangySelection",S=e.dom,E=e.util,b=e.DomRange,w=e.WrappedRange,T=e.DOMException,O=S.DomPosition,_="Control",D=e.util.isHostMethod(window,"getSelection"),A=e.util.isHostObject(document,"selection"),x=A&&(!D||e.config.preferTextRange);x?(C=r,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||S.getDocument(n.createRange().parentElement())==t}):D?(C=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=C;var B=C(),I=e.createNativeRange(document),k=S.getBody(document),H=E.areHostObjects(B,["anchorNode","focusNode"]&&E.areHostProperties(B,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=H;var M=E.isHostMethod(B,"extend");e.features.selectionHasExtend=M;var P="number"==typeof B.rangeCount;e.features.selectionHasRangeCount=P;var W=!1,F=!0;E.areHostMethods(B,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof B.rangeCount&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",k.appendChild(e);var t=S.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=S.getIframeWindow(e).getSelection(),r=t.documentElement,o=r.lastChild,i=o.firstChild,s=t.createRange();s.setStart(i,1),s.collapse(!0),n.addRange(s),F=1==n.rangeCount,n.removeAllRanges();var a=s.cloneRange();s.setStart(i,0),a.setEnd(i,2),n.addRange(s),n.addRange(a),W=2==n.rangeCount,s.detach(),a.detach(),k.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=W,e.features.collapsedNonEditableSelectionsSupported=F;var L,V=!1;k&&E.isHostMethod(k,"createControlRange")&&(L=k.createControlRange(),E.areHostProperties(L,["item","add"])&&(V=!0)),e.features.implementsControlRange=V,y=H?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var z;E.isHostMethod(B,"getRangeAt")?z=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:H&&(z=function(t){var n=S.getDocument(t.anchorNode),r=e.createRange(n);return r.setStart(t.anchorNode,t.anchorOffset),r.setEnd(t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&(r.setStart(t.focusNode,t.focusOffset),r.setEnd(t.anchorNode,t.anchorOffset)),r}),e.getSelection=function(e){e=e||window;var t=e[N],n=C(e),o=A?r(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh(e)):(t=new g(n,o,e),e[N]=t),t},e.getIframeSelection=function(t){return e.getSelection(S.getIframeWindow(t))};var U=g.prototype;if(!x&&H&&E.areHostMethods(B,["removeAllRanges","addRange"])){U.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var j=function(t,n){var r=b.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(a(o)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};U.addRange=P?function(t,n){if(V&&A&&this.docSelection.type==_)f(this,t);else if(n&&M)j(this,t);else{var r;if(W?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=z(this.nativeSelection,this.rangeCount-1);i&&!b.rangesEqual(i,t)&&(t=new w(i))}this._ranges[this.rangeCount-1]=t,o(this,t,$(this.nativeSelection)),this.isCollapsed=y(this)}else this.refresh()}}:function(e,t){t&&M?j(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},U.setRanges=function(e){if(V&&e.length>1)p(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(E.isHostMethod(B,"empty")&&E.isHostMethod(I,"select")&&V&&x))return t.fail("No means of selecting a Range or TextRange was found"),!1;U.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=S.getDocument(this.anchorNode);else if(this.docSelection.type==_){var t=this.docSelection.createRange();t.length&&(e=S.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}s(this)},U.addRange=function(e){this.docSelection.type==_?f(this,e):(w.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,o(this,e,!1))},U.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?p(this,e):t&&this.addRange(e[0])}}U.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new T("INDEX_SIZE_ERR");return this._ranges[e]};var q;if(x)q=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=S.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==_?l(t):d(n)?h(t,n):s(t)};else if(E.isHostMethod(B,"getRangeAt")&&"number"==typeof B.rangeCount)q=function(t){if(V&&A&&t.docSelection.type==_)l(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));o(t,t._ranges[t.rangeCount-1],$(t.nativeSelection)),t.isCollapsed=y(t)}else s(t)};else{if(!H||typeof B.isCollapsed!=R||typeof I.collapsed!=R||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;q=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=z(n,0),e._ranges=[t],e.rangeCount=1,i(e),e.isCollapsed=y(e)):s(e)}}U.refresh=function(e){var t=e?this._ranges.slice(0):null;if(q(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!b.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var Y=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var o=0,i=n.length;i>o;++o)r||t!==n[o]?e.addRange(n[o]):r=!0;e.rangeCount||s(e)};U.removeRange=V?function(e){if(this.docSelection.type==_){for(var t,n=this.docSelection.createRange(),r=u(e),o=S.getDocument(n.item(0)),i=S.getBody(o).createControlRange(),s=!1,a=0,c=n.length;c>a;++a)t=n.item(a),t!==r||s?i.add(n.item(a)):s=!0;i.select(),l(this)}else Y(this,e)}:function(e){Y(this,e)};var $;!x&&H&&e.features.implementsDomRange?($=function(e){var t=!1;return e.anchorNode&&(t=1==S.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},U.isBackwards=function(){return $(this)}):$=U.isBackwards=function(){return!1},U.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},U.collapse=function(t,n){m(this,t);var r=e.createRange(S.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},U.collapseToStart=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},U.collapseToEnd=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},U.selectAllChildren=function(t){m(this,t);var n=e.createRange(S.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},U.deleteFromDocument=function(){if(V&&A&&this.docSelection.type==_){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}},U.getAllRanges=function(){return this._ranges.slice(0)},U.setSingleRange=function(e){this.setRanges([e])},U.containsNode=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},U.toHtml=function(){var e="";if(this.rangeCount){for(var t=b.getRangeDocument(this._ranges[0]).createElement("div"),n=0,r=this._ranges.length;r>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},U.getName=function(){return"WrappedSelection"},U.inspect=function(){return v(this)},U.detach=function(){this.win[N]=null,this.win=this.anchorNode=this.focusNode=null},g.inspect=v,e.Selection=g,e.selectionPrototype=U,e.addCreateMissingNativeApiListener(function(t){t.getSelection===void 0&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),rangy.createModule("SaveRestore",function(e,t){function n(e,t){return(t||document).getElementById(e)}function r(e,t){var n,r="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=d.getDocument(e.startContainer),i=e.cloneRange();return i.collapse(t),n=o.createElement("span"),n.id=r,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(h)),i.insertNode(n),i.detach(),n}function o(e,r,o,i){var s=n(o,e);s?(r[i?"setStartBefore":"setEndBefore"](s),s.parentNode.removeChild(s)):t.warn("Marker element has been removed. Cannot restore selection.")}function i(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function s(o){o=o||window;var s=o.document;if(!e.isSelectionValid(o))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),void 0;var a,c,u,d=e.getSelection(o),h=d.getAllRanges(),l=[];h.sort(i);for(var f=0,g=h.length;g>f;++f)u=h[f],u.collapsed?(c=r(u,!1),l.push({markerId:c.id,collapsed:!0})):(c=r(u,!1),a=r(u,!0),l[f]={startMarkerId:a.id,endMarkerId:c.id,collapsed:!1,backwards:1==h.length&&d.isBackwards()});for(f=g-1;f>=0;--f)u=h[f],u.collapsed?u.collapseBefore(n(l[f].markerId,s)):(u.setEndBefore(n(l[f].endMarkerId,s)),u.setStartAfter(n(l[f].startMarkerId,s)));return d.setRanges(h),{win:o,doc:s,rangeInfos:l,restored:!1}}function a(r,i){if(!r.restored){for(var s,a,c=r.rangeInfos,u=e.getSelection(r.win),d=[],h=c.length,l=h-1;l>=0;--l){if(s=c[l],a=e.createRange(r.doc),s.collapsed){var f=n(s.markerId,r.doc);if(f){f.style.display="inline";var g=f.previousSibling;g&&3==g.nodeType?(f.parentNode.removeChild(f),a.collapseToPoint(g,g.length)):(a.collapseBefore(f),f.parentNode.removeChild(f))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(r.doc,a,s.startMarkerId,!0),o(r.doc,a,s.endMarkerId,!1);1==h&&a.normalizeBoundaries(),d[l]=a}1==h&&i&&e.features.selectionHasExtend&&c[0].backwards?(u.removeAllRanges(),u.addRange(d[0],!0)):u.setRanges(d),r.restored=!0}}function c(e,t){var r=n(t,e);r&&r.parentNode.removeChild(r)}function u(e){for(var t,n=e.rangeInfos,r=0,o=n.length;o>r;++r)t=n[r],t.collapsed?c(e.doc,t.markerId):(c(e.doc,t.startMarkerId),c(e.doc,t.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var d=e.dom,h="ï»¿";e.saveSelection=s,e.restoreSelection=a,e.removeMarkerElement=c,e.removeMarkers=u}),!function(e,t){"function"==typeof define?define(t):"undefined"!=typeof module&&module.exports?module.exports.browser=t():this[e]=t()}("bowser",function(){function e(){return o?{msie:r,version:n.match(/msie (\d+(\.\d+)?);/i)[1]}:i?{webkit:r,chrome:r,version:n.match(/chrome\/(\d+(\.\d+)?)/i)[1]}:s?{webkit:r,phantom:r,version:n.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]}:d?{webkit:r,touchpad:r,version:n.match(/touchpad\/(\d+(\.\d+)?)/i)[1]}:c||u?(t={webkit:r,mobile:r,ios:r,iphone:c,ipad:u},m.test(n)&&(t.version=n.match(m)[1]),t):h?{webkit:r,android:r,mobile:r,version:n.match(m)[1]}:a?{webkit:r,safari:r,version:n.match(m)[1]}:l?{opera:r,version:n.match(m)[1]}:g?(t={gecko:r,mozilla:r,version:n.match(/firefox\/(\d+(\.\d+)?)/i)[1]},f&&(t.firefox=r),t):p?{seamonkey:r,version:n.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}:void 0}var t,n=navigator.userAgent,r=!0,o=/msie/i.test(n),i=/chrome/i.test(n),s=/phantom/i.test(n),a=/safari/i.test(n)&&!i&&!s,c=/iphone/i.test(n),u=/ipad/i.test(n),d=/touchpad/i.test(n),h=/android/i.test(n),l=/opera/i.test(n),f=/firefox/i.test(n),g=/gecko\//i.test(n),p=/seamonkey\//i.test(n),m=/version\/(\d+(\.\d+)?)/i,v=e();return v.msie&&v.version>=7||v.chrome&&v.version>=10||v.firefox&&v.version>=4||v.safari&&v.version>=5||v.opera&&v.version>=10?v.a=r:v.msie&&7>v.version||v.chrome&&10>v.version||v.firefox&&4>v.version||v.safari&&5>v.version||v.opera&&10>v.version?v.c=r:v.x=r,v}),function(e,t,n,r){"use strict";var o,i,s={},a=function(){return n||function(){throw Error("jQuery-like library not yet implemented")}}();o=function(){if(d.log!==!1){var t,n;return t=Array.prototype.slice.call(arguments),t.length&&"trace"===t[t.length-1]&&(t.pop(),((n=e.console)?n.trace:void 0)&&console.trace()),1===t.length&&(t=t[0]),e.console?console.log(t):r}},i=function(){if(d.logErrors!==!1){var t;return t=Array.prototype.slice.call(arguments),1===t.length&&(t=t[0]),e.console&&"function"==typeof e.console.error?console.error(t):e.console?console.log(t):r}};var c=function(){return{trimRight:function(e){return e.replace(/\s+$/,"")},trimLeft:function(e){return e.replace(/^\s+/,"")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},isString:function(e){return"[object String]"===toString.call(e)},regexp:function(e,t){t||(t="g");var n=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return RegExp(n,t)}}}();s=function(t){this.config=a.extend(!0,{},d,t),this.win=this.config.window||e,this.editableSelector="."+this.config.editableClass,rangy.initialized||rangy.init(),this.dispatcher=new p(this),this.config.defaultBehavior===!0&&this.dispatcher.on(g(this))},e.Editable=s,s.prototype.add=function(e,t){return a.extend(!0,{},d,t),this.enable(a(e)),this},s.prototype.remove=function(e){var t=a(e);return this.disable(t),t.removeClass(d.editableDisabledClass),this},s.prototype.disable=function(e){var t=this.win.document.body;return e=e||a("."+d.editableClass,t),e.removeAttr("contenteditable").removeClass(d.editableClass).addClass(d.editableDisabledClass),this},s.prototype.enable=function(e,t){var n=this.win.document.body;return e=e||a("."+d.editableDisabledClass,n),e.attr("contenteditable",!0).removeClass(d.editableDisabledClass).addClass(d.editableClass),t&&e.each(function(e,t){h.normalizeTags(t),h.normalizeSpaces(t)}),this},s.prototype.suspend=function(e){var t=this.win.document.body;return e=e||a("."+d.editableClass,t),e.removeAttr("contenteditable"),this},s.prototype.continue=function(e){var t=this.win.document.body;return e=e||a("."+d.editableClass,t),e.attr("contenteditable",!0),this},s.prototype.createCursor=function(e,t){var n,r=a(e).closest(this.editableSelector);if(t=t||"beginning",r.length){var o=rangy.createRange();"beginning"===t||"end"===t?(o.selectNodeContents(e),o.collapse("beginning"===t?!0:!1)):e!==r[0]?"before"===t?(o.setStartBefore(e),o.setEndBefore(e)):"after"===t&&(o.setStartAfter(e),o.setEndAfter(e)):i("EditableJS: cannot create cursor outside of an editable block."),n=new l(r[0],o)}return n},s.prototype.createCursorAtBeginning=function(e){return this.createCursor(e,"beginning")},s.prototype.createCursorAtEnd=function(e){return this.createCursor(e,"end")},s.prototype.createCursorBefore=function(e){return this.createCursor(e,"before")},s.prototype.createCursorAfter=function(e){return this.createCursor(e,"after")},s.prototype.getContent=function(e){return h.extractContent(e)},s.prototype.on=function(e,t){return this.dispatcher.on(e,t),this},s.prototype.off=function(){var e=Array.prototype.slice.call(arguments);return this.dispatcher.off.apply(this.dispatcher,e),this},s.prototype.unload=function(){return this.dispatcher.unload(),this},s.prototype.focus=function(e){return this.on("focus",e)},s.prototype.blur=function(e){return this.on("blur",e)},s.prototype.flow=function(e){return this.on("flow",e)},s.prototype.selection=function(e){return this.on("selection",e)},s.prototype.cursor=function(e){return this.on("cursor",e)},s.prototype.newline=function(e){return this.on("newline",e)},s.prototype.insert=function(e){return this.on("insert",e)},s.prototype.split=function(e){return this.on("split",e)},s.prototype.merge=function(e){return this.on("merge",e)},s.prototype.empty=function(e){return this.on("empty",e)},s.prototype.change=function(e){return this.on("change",e)},s.prototype["switch"]=function(e){return this.on("switch",e)},s.prototype.move=function(e){return this.on("move",e)},s.prototype.clipboard=function(e){return this.on("clipboard",e)};var u=function(){return{next:function(e){var t=e.nextElementSibling;return t&&t.getAttribute("contenteditable")?t:null},previous:function(e){var t=e.previousElementSibling;return t&&t.getAttribute("contenteditable")?t:null}}}(),d={log:!1,logErrors:!0,editableClass:"js-editable",editableDisabledClass:"js-editable-disabled",pastingAttribute:"data-editable-is-pasting",mouseMoveSelectionChanges:!1,boldTag:"<strong>",italicTag:"<em>",defaultBehavior:!0},h=function(){var e=function(e,t,n){return t=E.save(t),n.call(h),E.restore(e,t)},n=/\u200B/g,r=/\uFEFF/g;return{normalizeTags:function(e){var n,r,o,i,s=t.createDocumentFragment();for(n=0;e.childNodes.length>n;n++)if(o=e.childNodes[n],o&&("BR"===o.nodeName||o.textContent)){if(1===o.nodeType&&"BR"!==o.nodeName){for(i=o;null!==(i=i.nextSibling)&&N.isSameNode(i,o);){for(r=0;i.childNodes.length>r;r++)o.appendChild(i.childNodes[r].cloneNode(!0));i.parentNode.removeChild(i)}this.normalizeTags(o)}s.appendChild(o.cloneNode(!0))}for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(s)},cleanInternals:function(e){e.innerHTML=this.extractContent(e)},extractContent:function(e){var o=e.innerHTML;o=o.replace(r,""),o=o.replace(n,"<br>");var i=t.createElement("div");return i.innerHTML=o,this.unwrapInternalNodes(i),i.innerHTML},unwrapInternalNodes:function(e){for(;e;){var t=e.nextSibling;if(1===e.nodeType){var n=e.getAttribute("data-editable");e.firstChild&&this.unwrapInternalNodes(e.firstChild),"remove"===n&&this.unwrap(e)}e=t}},normalizeSpaces:function(e){var t="Â ";e&&(3===e.nodeType?e.nodeValue=e.nodeValue.replace(/^(\s)/,t).replace(/(\s)$/,t):(this.normalizeSpaces(e.firstChild),this.normalizeSpaces(e.lastChild)))},getTags:function(e,t,n){for(var r=this.getInnerTags(t,n),o=t.commonAncestorContainer;o!==e;)(!n||n(o))&&r.push(o),o=o.parentNode;return r},getTagsByName:function(e,t,n){return this.getTags(e,t,function(e){return e.nodeName===n.toUpperCase()})},getInnerTags:function(e,t){return e.getNodes([1],t)},getTagNames:function(e){var t=[];if(!e)return t;for(var n=0;e.length>n;n++)t.push(e[n].nodeName);return t},isAffectedBy:function(e,t,n){for(var r,o=this.getTags(e,t),i=0;o.length>i;i++)if(r=o[i],r.nodeName===n.toUpperCase())return!0;return!1},isExactSelection:function(e,t,n){var r=rangy.createRange();if(r.selectNodeContents(t),e.intersectsRange(r)){var o=""+e,i=a(t).text();return n&&(o=c.trim(o),i=c.trim(i)),""!==o&&o===i}return!1},expandTo:function(e,t,n){return t.selectNodeContents(n),t},toggleTag:function(e,t,n){var r=this.getTagsByName(e,t,n.nodeName);return 1===r.length&&this.isExactSelection(t,r[0],"visible")?this.removeFormatting(e,t,n.nodeName):this.forceWrap(e,t,n)},isWrappable:function(e){return e.canSurroundContents()},forceWrap:function(t,n,r){return n=e(t,n,function(){this.nuke(t,n,r.nodeName)}),this.isWrappable(n)||(n=e(t,n,function(){this.nuke(t,n)})),this.wrap(n,r),n},wrap:function(e,t){t=c.isString(t)?a(t)[0]:t,this.isWrappable(e)?e.surroundContents(t):console.log("content.wrap(): can not surround range")},unwrap:function(e){var t=a(e),n=t.contents();n.length?n.unwrap():t.remove()},removeFormatting:function(t,n,r){return e(t,n,function(){this.nuke(t,n,r)})},nuke:function(e,t,n){for(var r=this.getTags(e,t),o=0;r.length>o;o++){var i=r[o];"BR"===i.nodeName||n&&i.nodeName!==n.toUpperCase()||this.unwrap(i)}},insertCharacter:function(e,n,r){var o=t.createTextNode(n),i=e.cloneRange();i.collapse(r),i.insertNode(o),i.detach(),r?e.setStartBefore(o):e.setEndAfter(o),e.normalizeBoundaries()},surround:function(e,t,n,r){return r||(r=n),this.insertCharacter(t,r,!1),this.insertCharacter(t,n,!0),t},deleteCharacter:function(t,n,r){return this.containsString(n,r)&&(n.splitBoundaries(),n=e(t,n,function(){for(var e=c.regexp(r),t=n.getNodes([3],function(t){return t.nodeValue.search(e)>=0}),o=0;t.length>o;o++){var i=t[o];i.nodeValue=i.nodeValue.replace(e,"")}}),n.normalizeBoundaries()),n},containsString:function(e,t){var n=""+e;return n.indexOf(t)>=0},nukeTag:function(e,t,n){for(var r=this.getTags(e,t),o=0;r.length>o;o++){var i=r[o];i.nodeName===n&&this.unwrap(i)}}}}(),l=function(){var t=function(e,t){this.setHost(e),this.range=t,this.isCursor=!0};return t.prototype=function(){return{isAtEnd:function(){return N.isEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtTextEnd:function(){return N.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtBeginning:function(){return N.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)},insertBefore:function(e){if(!N.isDocumentFragmentWithoutChildren(e)){var t=e;if(11===e.nodeType){var n=e.childNodes.length-1;t=e.childNodes[n]}this.range.insertNode(e),this.range.setStartAfter(t),this.range.setEndAfter(t)}},insertAfter:function(e){N.isDocumentFragmentWithoutChildren(e)||this.range.insertNode(e)},setSelection:function(){this.setVisibleSelection()},setVisibleSelection:function(){a(this.host).focus(),rangy.getSelection(this.win).setSingleRange(this.range)},before:function(){var e=null,t=this.range.cloneRange();return t.setStartBefore(this.host),e=t.cloneContents(),t.detach(),e},after:function(){var e=null,t=this.range.cloneRange();return t.setEndAfter(this.host),e=t.cloneContents(),t.detach(),e},getCoordinates:function(e){e=e||"absolute";var t=this.range.nativeRange.getBoundingClientRect();if("fixed"===e)return t;var n=this.win,o=n.pageXOffset!==r?n.pageXOffset:(n.document.documentElement||n.document.body.parentNode||n.document.body).scrollLeft,i=n.pageYOffset!==r?n.pageYOffset:(n.document.documentElement||n.document.body.parentNode||n.document.body).scrollTop;return{top:t.top+i,bottom:t.bottom+i,left:t.left+o,right:t.right+o,height:t.height,width:t.width}},detach:function(){this.range.detach()},moveBefore:function(e){return this.updateHost(e),this.range.setStartBefore(e),this.range.setEndBefore(e),this.isSelection?new t(this.host,this.range):r},moveAfter:function(e){return this.updateHost(e),this.range.setStartAfter(e),this.range.setEndAfter(e),this.isSelection?new t(this.host,this.range):r},moveAtBeginning:function(e){return e||(e=this.host),this.updateHost(e),this.range.selectNodeContents(e),this.range.collapse(!0),this.isSelection?new t(this.host,this.range):r},moveAtEnd:function(e){return e||(e=this.host),this.updateHost(e),this.range.selectNodeContents(e),this.range.collapse(!1),this.isSelection?new t(this.host,this.range):r},moveAtTextEnd:function(e){return this.moveAtEnd(N.latestChild(e))},setHost:function(t){t.jquery&&(t=t[0]),this.host=t,this.win=t===r||null===t?e:t.ownerDocument.defaultView},updateHost:function(e){var t=N.getHost(e);t||i("Can not set cursor outside of an editable block"),this.setHost(t)},save:function(){this.savedRangeInfo=E.save(this.range),this.savedRangeInfo.host=this.host},restore:function(){this.savedRangeInfo?(this.host=this.savedRangeInfo.host,this.range=E.restore(this.host,this.savedRangeInfo),this.savedRangeInfo=r):i("Could not restore selection")},equals:function(e){return e?e.host?e.host.isEqualNode(this.host)?e.range?e.range.equals(this.range)?!0:!1:!1:!1:!1:!1},triggerChange:function(){a(this.host).trigger("formatEditable")}}}(),t}(),f=function(e){var t=e.win.document,n=e.config,r=e.dispatcher.selectionWatcher;return{focus:function(e){if(N.isVoid(e)){var n=t.createElement("br");n.setAttribute("data-editable","remove"),e.appendChild(n)}},blur:function(e){h.cleanInternals(e)},selection:function(e,t){t?o("Default selection behavior"):o("Default selection empty behavior")},cursor:function(e,t){t?o("Default cursor behavior"):o("Default cursor empty behavior")},newline:function(e,n){var r=n.isAtEnd(),i=t.createElement("br");if(n.insertBefore(i),r){o("at the end");var s=t.createTextNode("â");n.insertAfter(s)}else o("not at the end");n.setVisibleSelection()},insert:function(e,t){var n=e.parentNode,r=e.cloneNode(!1);switch(r.id&&r.removeAttribute("id"),t){case"before":n.insertBefore(r,e),e.focus();break;case"after":n.insertBefore(r,e.nextSibling),r.focus()}},split:function(e,t,n){var r=e.parentNode,o=n.firstChild;r.insertBefore(t,e),r.replaceChild(n,e),h.normalizeTags(o),h.normalizeSpaces(o),o.focus()},merge:function(e,n,r){var o,i,s,a,c,d;switch(n){case"before":o=u.previous(e),i=e;break;case"after":o=e,i=u.next(e)}if(o&&i){for(o.childNodes.length>0?r.moveAtTextEnd(o):r.moveAtBeginning(o),r.setVisibleSelection(),s=t.createDocumentFragment(),a=i.childNodes,c=0;a.length>c;c++)s.appendChild(a[c].cloneNode(!0));d=o.appendChild(s),i.parentNode.removeChild(i),r.save(),h.normalizeTags(o),h.normalizeSpaces(o),r.restore(),r.setVisibleSelection()}},empty:function(){o("Default empty behavior")},"switch":function(e,t,n){var r,o;switch(t){case"before":o=u.previous(e),o&&(n.moveAtTextEnd(o),n.setVisibleSelection());break;case"after":r=u.next(e),r&&(n.moveAtBeginning(r),n.setVisibleSelection())}},move:function(){o("Default move behavior")},clipboard:function(e,o,i){var s,a;"paste"===o&&(e.setAttribute(n.pastingAttribute,!0),i.isSelection&&(i=i.deleteContent()),s=t.createElement("textarea"),s.setAttribute("style","position: absolute; left: -9999px"),i.insertAfter(s),a=rangy.saveSelection(),s.focus(),setTimeout(function(){var o,i,c;o=s.value,e.removeChild(s),rangy.restoreSelection(a),c=r.forceCursor(),i=t.createTextNode(o),h.normalizeSpaces(i),c.insertAfter(i),c.moveAfter(i),c.setVisibleSelection(),e.removeAttribute(n.pastingAttribute)},0))}}},g=function(e){var t=f(e);return{focus:function(e){t.focus(e)},blur:function(e){t.blur(e)},flow:function(e,n){t.flow(e,n)},selection:function(e,n){t.selection(e,n)},cursor:function(e,n){t.cursor(e,n)},newline:function(e,n){t.newline(e,n)},split:function(e,n,r,o){t.split(e,n,r,o)},insert:function(e,n,r){t.insert(e,n,r)},merge:function(e,n,r){t.merge(e,n,r)},empty:function(e){t.empty(e)},"switch":function(e,n,r){t.switch(e,n,r)},move:function(e,n,r){t.move(e,n,r)},clipboard:function(e,n,r){t.clipboard(e,n,r)}}},p=function(e){var t=e.win;C(this,e),this.supportsInputEvent=!1,this.$document=a(t.document),this.config=e.config,this.editable=e,this.editableSelector=e.editableSelector,this.keyboard=new R,this.selectionWatcher=new b(this,t),this.setup()},m=!1;p.prototype.setup=function(){this.setupElementEvents(),this.setupKeyboardEvents(),y.selectionchange?this.setupSelectionChangeEvents():this.setupSelectionChangeFallback()},p.prototype.unload=function(){this.off(),this.$document.off(".editable")},p.prototype.setupElementEvents=function(){var e=this;this.$document.on("focus.editable",e.editableSelector,function(){this.getAttribute(e.config.pastingAttribute)||e.notify("focus",this)}).on("blur.editable",e.editableSelector,function(){this.getAttribute(e.config.pastingAttribute)||e.notify("blur",this)}).on("copy.editable",e.editableSelector,function(){o("Copy"),e.notify("clipboard",this,"copy",e.selectionWatcher.getFreshSelection())}).on("cut.editable",e.editableSelector,function(){o("Cut"),e.notify("clipboard",this,"cut",e.selectionWatcher.getFreshSelection()),e.triggerChangeEvent(this)}).on("paste.editable",e.editableSelector,function(){o("Paste"),e.notify("clipboard",this,"paste",e.selectionWatcher.getFreshSelection()),e.triggerChangeEvent(this)}).on("input.editable",e.editableSelector,function(){o("Input"),m?e.notify("change",this):m=!0}).on("formatEditable.editable",e.editableSelector,function(){e.notify("change",this)})},p.prototype.triggerChangeEvent=function(e){m||this.notify("change",e)},p.prototype.dispatchSwitchEvent=function(e,t,n){var r;if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&(r=this.selectionWatcher.getSelection(),r&&!r.isSelection)){var o=this;setTimeout(function(){var i=o.selectionWatcher.forceCursor();i.equals(r)&&(e.preventDefault(),e.stopPropagation(),o.notify("switch",t,n,i))},1)}},p.prototype.setupKeyboardEvents=function(){var e=this;this.$document.on("keydown.editable",this.editableSelector,function(t){var n=!m;e.keyboard.dispatchKeyEvent(t,this,n)}),this.keyboard.on("left",function(t){e.dispatchSwitchEvent(t,this,"before")}).on("up",function(t){e.dispatchSwitchEvent(t,this,"before")}).on("right",function(t){e.dispatchSwitchEvent(t,this,"after")}).on("down",function(t){e.dispatchSwitchEvent(t,this,"after")}).on("tab",function(){}).on("shiftTab",function(){}).on("esc",function(){}).on("backspace",function(t){var n=e.selectionWatcher.getFreshRange();if(n.isCursor){var r=n.getCursor();r.isAtBeginning()?(t.preventDefault(),t.stopPropagation(),e.notify("merge",this,"before",r)):e.triggerChangeEvent(this)}else e.triggerChangeEvent(this)}).on("delete",function(t){var n=e.selectionWatcher.getFreshRange();if(n.isCursor){var r=n.getCursor();r.isAtTextEnd()?(t.preventDefault(),t.stopPropagation(),e.notify("merge",this,"after",r)):e.triggerChangeEvent(this)}else e.triggerChangeEvent(this)}).on("enter",function(t){t.preventDefault(),t.stopPropagation();var n=e.selectionWatcher.getFreshRange(),r=n.forceCursor();r.isAtTextEnd()?e.notify("insert",this,"after",r):r.isAtBeginning()?e.notify("insert",this,"before",r):e.notify("split",this,r.before(),r.after(),r)}).on("shiftEnter",function(t){t.preventDefault(),t.stopPropagation();var n=e.selectionWatcher.forceCursor();e.notify("newline",this,n)}).on("character",function(){e.notify("change",this)})},p.prototype.setupSelectionChangeEvents=function(){var e=!1,t=!1,n=this.$document,r=this.selectionWatcher,o=this;n.on("selectionchange.editable",function(){t?e=!0:r.selectionChanged()}),n.on("mousedown.editable",this.editableSelector,function(){o.config.mouseMoveSelectionChanges===!1&&(t=!0,setTimeout(a.proxy(r,"selectionChanged"),0)),n.on("mouseup.editableSelection",function(){n.off(".editableSelection"),t=!1,e&&(e=!1,r.selectionChanged())})})},p.prototype.setupSelectionChangeFallback=function(){var e=this.$document,t=this.selectionWatcher;e.on("mouseup.editableSelection",function(){setTimeout(a.proxy(t,"selectionChanged"),0)}),e.on("keyup.editable",this.editableSelector,function(){t.selectionChanged()})};var v=function(e){var t={},n=function(e,n){t[e]===r&&(t[e]=[]),t[e].push(n)},o=function(e,n){var o=t[e];if(o!==r)for(var i=0,s=o.length;s>i;i++)if(o[i]===n){o.splice(i,1);break}};return{on:function(e,t){if(2===arguments.length)n(e,t);else if(1===arguments.length){var r=e;for(var o in r)n(o,r[o])}return this},off:function(e,n){2===arguments.length?o(e,n):1===arguments.length?t[e]=[]:t={}},notify:function(n,o){var i;e?(o=n,n=e,i=Array.prototype.slice.call(arguments).splice(1)):i=Array.prototype.slice.call(arguments).splice(2);var s=t[o];if(s!==r)for(var a=s.length-1;a>=0&&s[a].apply(n,i)!==!1;a--);}}},C=function(e,t){var n=v(t);for(var r in n)e[r]=n[r]},y=function(){var e=t.documentElement.contentEditable!==r,n=function(){return!(bowser.gecko||bowser.opera)
}();return{contenteditable:e,selectionchange:n}}(),R=function(){C(this)};R.prototype.dispatchKeyEvent=function(e,t,n){switch(e.keyCode){case this.key.left:this.notify(t,"left",e);break;case this.key.right:this.notify(t,"right",e);break;case this.key.up:this.notify(t,"up",e);break;case this.key.down:this.notify(t,"down",e);break;case this.key.tab:e.shiftKey?this.notify(t,"shiftTab",e):this.notify(t,"tab",e);break;case this.key.esc:this.notify(t,"esc",e);break;case this.key.backspace:this.notify(t,"backspace",e);break;case this.key["delete"]:this.notify(t,"delete",e);break;case this.key.enter:e.shiftKey?this.notify(t,"shiftEnter",e):this.notify(t,"enter",e);break;case this.key.ctrl:case this.key.shift:case this.key.alt:break;case 224:case 17:case 91:case 93:break;default:n&&this.notify(t,"character",e)}},R.prototype.key={left:37,up:38,right:39,down:40,tab:9,esc:27,backspace:8,"delete":46,enter:13,shift:16,ctrl:17,alt:18},R.key=R.prototype.key;var N=function(){return{getHost:function(e){var t="."+d.editableClass,n=a(e).closest(t);return n.length?n[0]:r},getNodeIndex:function(e){for(var t=0;null!==(e=e.previousSibling);)t+=1;return t},isVoid:function(e){var t,n,r,o=e.childNodes;for(n=0,r=o.length;r>n;n++){if(t=o[n],3===t.nodeType&&!this.isVoidTextNode(t))return!1;if(1===t.nodeType)return!1}return!0},isVoidTextNode:function(e){return 3===e.nodeType&&!e.nodeValue},isWhitespaceOnly:function(e){return 3===e.nodeType&&0===this.lastOffsetWithContent(e)},isLinebreak:function(e){return 1===e.nodeType&&"BR"===e.tagName},lastOffsetWithContent:function(e){if(3===e.nodeType)return c.trimRight(e.nodeValue).length;var t,n=e.childNodes;for(t=n.length-1;t>=0;t--)if(e=n[t],!this.isWhitespaceOnly(e)&&!this.isLinebreak(e))return t+1;return 0},isBeginningOfHost:function(e,t,n){if(t===e)return this.isStartOffset(t,n);if(this.isStartOffset(t,n)){var r=t.parentNode,o=this.getNodeIndex(t);return this.isBeginningOfHost(e,r,o)}return!1},isEndOfHost:function(e,t,n){if(t===e)return this.isEndOffset(t,n);if(this.isEndOffset(t,n)){var r=t.parentNode,o=this.getNodeIndex(t)+1;return this.isEndOfHost(e,r,o)}return!1},isStartOffset:function(e,t){return 3===e.nodeType?0===t:0===e.childNodes.length?!0:e.childNodes[t]===e.firstChild},isEndOffset:function(e,t){return 3===e.nodeType?t===e.length:0===e.childNodes.length?!0:t>0?e.childNodes[t-1]===e.lastChild:!1},isTextEndOfHost:function(e,t,n){if(t===e)return this.isTextEndOffset(t,n);if(this.isTextEndOffset(t,n)){var r=t.parentNode,o=this.getNodeIndex(t)+1;return this.isTextEndOfHost(e,r,o)}return!1},isTextEndOffset:function(e,t){if(3===e.nodeType){var n=c.trimRight(e.nodeValue);return t>=n.length}if(0===e.childNodes.length)return!0;var r=this.lastOffsetWithContent(e);return t>=r},isSameNode:function(e,t){var n,r,o;if(e.nodeType!==t.nodeType)return!1;if(e.nodeName!==t.nodeName)return!1;for(n=0,r=e.attributes.length;r>n;n++)if(o=e.attributes[n],t.getAttribute(o.name)!==o.value)return!1;return!0},latestChild:function(e){return e.lastChild?this.latestChild(e.lastChild):e},isDocumentFragmentWithoutChildren:function(e){return e&&11===e.nodeType&&0===e.childNodes.length?!0:!1},isInlineElement:function(e,t){var n=t.currentStyle||e.getComputedStyle(t,""),r=n.display;switch(r){case"inline":case"inline-block":return!0;default:return!1}}}}(),S=function(e,t){this.host=e&&e.jquery?e[0]:e,this.range=t,this.isAnythingSelected=t!==r,this.isCursor=this.isAnythingSelected&&t.collapsed,this.isSelection=this.isAnythingSelected&&!this.isCursor};S.prototype.getCursor=function(){return this.isCursor?new l(this.host,this.range):r},S.prototype.getSelection=function(){return this.isSelection?new w(this.host,this.range):r},S.prototype.forceCursor=function(){if(this.isSelection){var e=this.getSelection();return e.deleteContent()}return this.getCursor()},S.prototype.isDifferentFrom=function(e){e=e||new S;var t=this.range,n=e.range;return t&&n?!t.equals(n):t||n?!0:!1};var E=function(){var e=0,t="ï»¿",n=function(e,t){return e.querySelector("#"+t)};return{insertRangeBoundaryMarker:function(n,o){var s,a="editable-range-boundary-"+(e+=1),c=n.commonAncestorContainer;(null===c.ownerDocument||c.ownerDocument===r)&&i("Cannot save range: range is emtpy");var u=c.ownerDocument.defaultView.document,d=n.cloneRange();return d.collapse(o),s=u.createElement("span"),s.id=a,s.setAttribute("data-editable","remove"),s.style.lineHeight="0",s.style.display="none",s.appendChild(u.createTextNode(t)),d.insertNode(s),d.detach(),s},setRangeBoundary:function(e,t,r,o){var i=n(e,r);i?(t[o?"setStartBefore":"setEndBefore"](i),i.parentNode.removeChild(i)):console.log("Marker element has been removed. Cannot restore selection.")},save:function(e){var t,n,r;return e.collapsed?(r=this.insertRangeBoundaryMarker(e,!1),t={markerId:r.id,collapsed:!0}):(r=this.insertRangeBoundaryMarker(e,!1),n=this.insertRangeBoundaryMarker(e,!0),t={startMarkerId:n.id,endMarkerId:r.id,collapsed:!1}),e.collapsed?e.collapseBefore(r):(e.setEndBefore(r),e.setStartAfter(n)),t},restore:function(e,t){if(!t.restored){var r=rangy.createRange();if(t.collapsed){var o=n(e,t.markerId);if(o){o.style.display="inline";var i=o.previousSibling;i&&3===i.nodeType?(o.parentNode.removeChild(o),r.collapseToPoint(i,i.length)):(r.collapseBefore(o),o.parentNode.removeChild(o))}else console.log("Marker element has been removed. Cannot restore selection.")}else this.setRangeBoundary(e,r,t.startMarkerId,!0),this.setRangeBoundary(e,r,t.endMarkerId,!1);return r.normalizeBoundaries(),r}}}}(),b=function(t,n){this.dispatcher=t,this.win=n||e,this.rangySelection=r,this.currentSelection=r,this.currentRange=r};b.prototype.getRangeContainer=function(){if(this.rangySelection=rangy.getSelection(this.win),this.rangySelection.rangeCount){var e=this.rangySelection.getRangeAt(0),t=N.getHost(e.commonAncestorContainer);if(t)return new S(t,e)}return new S},b.prototype.getFreshRange=function(){return this.getRangeContainer()},b.prototype.getFreshSelection=function(){var e=this.getRangeContainer();return e.isCursor?e.getCursor(this.win):e.getSelection(this.win)},b.prototype.getSelection=function(){return this.currentSelection},b.prototype.forceCursor=function(){var e=this.getRangeContainer();return e.forceCursor()},b.prototype.selectionChanged=function(){var e=this.getRangeContainer();if(e.isDifferentFrom(this.currentRange)){var t=this.currentSelection;this.currentRange=e,t&&(t.isCursor&&!this.currentRange.isCursor?this.dispatcher.notify("cursor",t.host):t.isSelection&&!this.currentRange.isSelection&&this.dispatcher.notify("selection",t.host)),this.currentRange.isCursor?(this.currentSelection=new l(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("cursor",this.currentSelection.host,this.currentSelection)):this.currentRange.isSelection?(this.currentSelection=new w(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("selection",this.currentSelection.host,this.currentSelection)):this.currentSelection=r}};var w=function(){var e=function(e,t){this.setHost(e),this.range=t,this.isSelection=!0},t=function(){};return t.prototype=l.prototype,e.prototype=a.extend(new t,{text:function(){return""+this.range},html:function(){return this.range.toHtml()},isAllSelected:function(){return N.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)&&N.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},getRects:function(){var e=this.range.nativeRange.getClientRects();return e},link:function(e,t){var n=a("<a>");e&&n.attr("href",e);for(var r in t)n.attr(r,t[r]);this.forceWrap(n[0])},unlink:function(){this.removeFormatting("a")},toggleLink:function(e,t){var n=this.getTagsByName("a");if(n.length>=1){var r=n[0];this.isExactSelection(r,"visible")?this.unlink():this.expandTo(r)}else this.link(e,t)},toggle:function(e){this.range=h.toggleTag(this.host,this.range,e),this.setSelection()},makeBold:function(){var e=a(d.boldTag);this.forceWrap(e[0])},toggleBold:function(){var e=a(d.boldTag);this.toggle(e[0])},giveEmphasis:function(){var e=a(d.italicTag);this.forceWrap(e[0])},toggleEmphasis:function(){var e=a(d.italicTag);this.toggle(e[0])},surround:function(e,t){this.range=h.surround(this.host,this.range,e,t),this.setSelection()},removeSurround:function(e,t){this.range=h.deleteCharacter(this.host,this.range,e),this.range=h.deleteCharacter(this.host,this.range,t),this.setSelection()},toggleSurround:function(e,t){this.containsString(e)&&this.containsString(t)?this.removeSurround(e,t):this.surround(e,t)},removeFormatting:function(e){this.range=h.removeFormatting(this.host,this.range,e),this.setSelection()},deleteContent:function(){return this.range.deleteContents(),new l(this.host,this.range)},expandTo:function(e){this.range=h.expandTo(this.host,this.range,e),this.setSelection()},collapseAtBeginning:function(){return this.range.collapse(!0),this.setSelection(),new l(this.host,this.range)},collapseAtEnd:function(){return this.range.collapse(!1),this.setSelection(),new l(this.host,this.range)},forceWrap:function(e){this.range=h.forceWrap(this.host,this.range,e),this.setSelection()},getTags:function(e){return h.getTags(this.host,this.range,e)},getTagsByName:function(e){return h.getTagsByName(this.host,this.range,e)},isExactSelection:function(e,t){return h.isExactSelection(this.range,e,t)},containsString:function(e){return h.containsString(this.range,e)},deleteCharacter:function(e){this.range=h.deleteCharacter(this.host,this.range,e),this.setSelection()}}),e}();e.Editable=s}(window,document,window.jQuery);