window.rangy=function(){function a(a,b){var c=typeof a[b];return c==l||!(c!=k||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=k||!a[b])}function c(a,b){return typeof a[b]!=m}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&r(a,q)&&t(a,p)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a),u.initialized=!0,u.supported=!1}function g(a){var b="Rangy warning: "+a;u.config.alertOnWarn?window.alert(b):typeof window.console!=m&&typeof window.console.log!=m&&window.console.log(b)}function h(){if(!u.initialized){var c,d=!1,g=!1;a(document,"createRange")&&(c=document.createRange(),r(c,o)&&t(c,n)&&(d=!0),c.detach());var h=b(document,"body")?document.body:document.getElementsByTagName("body")[0];h&&a(h,"createTextRange")&&(c=h.createTextRange(),e(c)&&(g=!0)),d||g||f("Neither Range nor TextRange are implemented"),u.initialized=!0,u.features={implementsDomRange:d,implementsTextRange:g};for(var i=w.concat(v),j=0,k=i.length;k>j;++j)try{i[j](u)}catch(l){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",l)}}}function i(a){a=a||window,h();for(var b=0,c=x.length;c>b;++b)x[b](a)}function j(a){this.name=a,this.initialized=!1,this.supported=!1}var k="object",l="function",m="undefined",n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],q=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],r=d(a),s=d(b),t=d(c),u={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:r,areHostObjects:s,areHostProperties:t,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};u.fail=f,u.warn=g,{}.hasOwnProperty?u.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var v=[],w=[];u.init=h,u.addInitListener=function(a){u.initialized?a(u):v.push(a)};var x=[];u.addCreateMissingNativeApiListener=function(a){x.push(a)},u.createMissingNativeApi=i,j.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},j.prototype.warn=function(a){u.warn("Module "+this.name+": "+a)},j.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},u.createModule=function(a,b){var c=new j(a);u.modules[a]=c,w.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},u.requireModules=function(a){for(var b,c,d=0,e=a.length;e>d;++d){if(c=a[d],b=u.modules[c],!(b&&b instanceof j))throw new Error("Module '"+c+"' not found");if(!b.supported)throw new Error("Module '"+c+"' not supported")}};var y=!1,z=function(){y||(y=!0,u.initialized||h())};return typeof window==m?void f("No window found"):typeof document==m?void f("No document found"):(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),a(window,"addEventListener")?window.addEventListener("load",z,!1):a(window,"attachEvent")?window.attachEvent("onload",z):f("Window does not have required addEventListener or attachEvent method"),u)}(),rangy.createModule("DomUtil",function(a,b){function c(a){var b;return typeof a.namespaceURI==z||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)b++;return b}function f(a){var b;return j(a)?a.length:(b=a.childNodes)?b.length:0}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(D(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function j(a){var b=a.nodeType;return 3==b||4==b||8==b}function k(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function l(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),k(c,a),c}function m(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=z)return a.ownerDocument;if(typeof a.document!=z)return a.document;if(a.parentNode)return m(a.parentNode);throw new Error("getDocument: no document found for node")}function n(a){var b=m(a);if(typeof b.defaultView!=z)return b.defaultView;if(typeof b.parentWindow!=z)return b.parentWindow;throw new Error("Cannot get a window object for node")}function o(a){if(typeof a.contentDocument!=z)return a.contentDocument;if(typeof a.contentWindow!=z)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function p(a){if(typeof a.contentWindow!=z)return a.contentWindow;if(typeof a.contentDocument!=z)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function q(a){return A.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function r(a){for(var b;b=a.parentNode;)a=b;return a}function s(a,b,c,d){var f,h,j,k,l;if(a==c)return b===d?0:d>b?-1:1;if(f=i(c,a,!0))return b<=e(f)?-1:1;if(f=i(a,c,!0))return e(f)<d?-1:1;if(h=g(a,c),j=a===h?h:i(a,h,!0),k=c===h?h:i(c,h,!0),j===k)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(l=h.firstChild;l;){if(l===j)return-1;if(l===k)return 1;l=l.nextSibling}throw new Error("Should not be here!")}function t(a){for(var b,c=m(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function u(a){if(!a)return"[No node]";if(j(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function v(a){this.root=a,this._next=a}function w(a){return new v(a)}function x(a,b){this.node=a,this.offset=b}function y(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var z="undefined",A=a.util;A.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),A.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var B=document.createElement("div");A.areHostMethods(B,["insertBefore","appendChild","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),A.isHostProperty(B,"innerHTML")||b.fail("Element is missing innerHTML property");var C=document.createTextNode("test");A.areHostMethods(C,["splitText","deleteData","insertData","appendData","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"])||!A.areHostProperties(C,["data"]))||b.fail("Incomplete Text Node implementation");var D=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+u(this.node)+":"+this.offset+")]"}},y.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},y.prototype.toString=function(){return this.message},a.dom={arrayContains:D,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,getClosestAncestorIn:i,isCharacterDataNode:j,insertAfter:k,splitDataNode:l,getDocument:m,getWindow:n,getIframeWindow:p,getIframeDocument:o,getBody:q,getRootContainer:r,comparePoints:s,inspectNode:u,fragmentFromNodeChildren:t,createIterator:w,DomPosition:x},a.DOMException=y}),rangy.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(L.isAncestorOf(a,b.startContainer,!0)||L.isAncestorOf(a,b.endContainer,!0))}function c(a){return L.getDocument(a.startContainer)}function d(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;f>e;++e)d[e].call(a,{target:a,args:c})}function e(a){return new M(a.parentNode,L.getNodeIndex(a))}function f(a){return new M(a.parentNode,L.getNodeIndex(a)+1)}function g(a,b,c){var d=11==a.nodeType?a.firstChild:a;return L.isCharacterDataNode(b)?c==b.length?L.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:L.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function h(a){for(var b,d,e,f=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(e=a.getSubtreeIterator(),d.appendChild(h(e)),e.detach(!0)),10==d.nodeType)throw new N("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),i(g,b,c),g.detach(!0),c.stop)return}else for(d=L.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach(!0)):a.remove(),10==b.nodeType)throw new N("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(a){e&&!d.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function m(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+L.inspectNode(a.startContainer)+":"+a.startOffset+", "+L.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&L.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||L.isCharacterDataNode(this.sc)?L.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||L.isCharacterDataNode(this.ec)?L.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a,b,c){this.nodes=l(a,b,c),this._next=this.nodes[0],this._position=0}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,L.arrayContains(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(W(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function s(a){if(!a.startContainer)throw new N("INVALID_STATE_ERR")}function t(a,b){if(!L.arrayContains(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function u(a,b){if(0>b||b>(L.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new N("INDEX_SIZE_ERR")}function v(a,b){if(U(a,!0)!==U(b,!0))throw new N("WRONG_DOCUMENT_ERR")}function w(a){if(V(a,!0))throw new N("NO_MODIFICATION_ALLOWED_ERR")}function x(a,b){if(!a)throw new N(b)}function y(a){return!L.arrayContains(P,a.nodeType)&&!U(a,!0)}function z(a,b){return b<=(L.isCharacterDataNode(a)?a.length:a.childNodes.length)}function A(a){return!!a.startContainer&&!!a.endContainer&&!y(a.startContainer)&&!y(a.endContainer)&&z(a.startContainer,a.startOffset)&&z(a.endContainer,a.endOffset)}function B(a){if(s(a),!A(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function C(){}function D(a){a.START_TO_START=ab,a.START_TO_END=bb,a.END_TO_END=cb,a.END_TO_START=db,a.NODE_BEFORE=eb,a.NODE_AFTER=fb,a.NODE_BEFORE_AND_AFTER=gb,a.NODE_INSIDE=hb}function E(a){D(a),D(a.prototype)}function F(a,b){return function(){B(this);var c,d,e=this.startContainer,g=this.startOffset,h=this.commonAncestorContainer,j=new n(this,!0);e!==h&&(c=L.getClosestAncestorIn(e,h,!0),d=f(c),e=d.node,g=d.offset),i(j,w),j.reset();var k=a(j);return j.detach(),b(this,e,g,e,g),k}}function G(c,d,g){function h(a,b){return function(c){s(this),t(c,O),t(T(c),P);var d=(a?e:f)(c);(b?i:l)(this,d.node,d.offset)}}function i(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((T(b)!=T(e)||1==L.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function l(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((T(b)!=T(e)||-1==L.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}function m(a,b,c){(b!==a.startContainer||c!==a.startOffset||b!==a.endContainer||c!==a.endOffset)&&d(a,b,c,b,c)}c.prototype=new C,a.util.extend(c.prototype,{setStart:function(a,b){s(this),r(a,!0),u(a,b),i(this,a,b)},setEnd:function(a,b){s(this),r(a,!0),u(a,b),l(this,a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){B(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){s(this),r(a,!0),d(this,a,0,a,L.getNodeLength(a))},selectNode:function(a){s(this),r(a,!1),t(a,O);var b=e(a),c=f(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:F(k,d),deleteContents:F(j,d),canSurroundContents:function(){B(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},detach:function(){g(this)},splitBoundaries:function(){B(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;L.isCharacterDataNode(c)&&e>0&&e<c.length&&L.splitDataNode(c,e),L.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=L.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=L.getNodeIndex(a)&&e++,b=0),d(this,a,b,c,e)},normalizeBoundaries:function(){B(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;if(b=f.length,d.insertData(0,f.data),f.parentNode.removeChild(f),a==c)e+=b,c=a;else if(c==d.parentNode){var h=L.getNodeIndex(d);e==h?(c=d,e=g):e>h&&e--}}},h=!0;if(L.isCharacterDataNode(c))c.length==e&&f(c);else{if(e>0){var i=c.childNodes[e-1];i&&L.isCharacterDataNode(i)&&f(i)}h=!this.collapsed}if(h){if(L.isCharacterDataNode(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&L.isCharacterDataNode(j)&&g(j)}}else a=c,b=e;d(this,a,b,c,e)},collapseToPoint:function(a,b){s(this),r(a,!0),u(a,b),m(this,a,b)}}),E(c)}function H(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:L.getCommonAncestor(a.startContainer,a.endContainer)}function I(a,b,c,e,f){var g=a.startContainer!==b||a.startOffset!==c,h=a.endContainer!==e||a.endOffset!==f;a.startContainer=b,a.startOffset=c,a.endContainer=e,a.endOffset=f,H(a),d(a,"boundarychange",{startMoved:g,endMoved:h})}function J(a){s(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,d(a,"detach",null),a._listeners=null}function K(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},H(this)}a.requireModules(["DomUtil"]);var L=a.dom,M=L.DomPosition,N=a.DOMException;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,L.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!L.isCharacterDataNode(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return b(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new K(c(this.range));var b=this._current,d=b,e=0,f=b,g=L.getNodeLength(b);L.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),L.isAncestorOf(b,this.ec,!0)&&(f=this.ec,g=this.eo),I(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var O=[1,3,4,5,7,8,10],P=[2,9,11],Q=[5,6,10,12],R=[1,3,4,5,7,8,10,11],S=[1,3,4,5,7,8],T=L.getRootContainer,U=q([9,11]),V=q(Q),W=q([6,10,12]),X=document.createElement("style"),Y=!1;try{X.innerHTML="<b>x</b>",Y=3==X.firstChild.nodeType}catch(Z){}a.features.htmlParsingConforms=Y;var $=Y?function(a){var b=this.startContainer,c=L.getDocument(b);if(!b)throw new N("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:L.isCharacterDataNode(b)&&(d=L.parentElement(b)),d=null===d||"HTML"==d.nodeName&&L.isHtmlNamespace(L.getDocument(d).documentElement)&&L.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,L.fragmentFromNodeChildren(d)}:function(a){s(this);var b=c(this),d=b.createElement("body");return d.innerHTML=a,L.fragmentFromNodeChildren(d)},_=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ab=0,bb=1,cb=2,db=3,eb=0,fb=1,gb=2,hb=3;C.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){B(this),v(this.startContainer,b.startContainer);var c,d,e,f,g=a==db||a==ab?"start":"end",h=a==bb||a==ab?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],L.comparePoints(c,d,e,f)},insertNode:function(a){if(B(this),t(a,R),w(this.startContainer),L.isAncestorOf(a,this.startContainer,!0))throw new N("HIERARCHY_REQUEST_ERR");var b=g(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){B(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;var d=new n(this,!0);return a=h(d),d.detach(),a},canSurroundContents:function(){B(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(t(a,S),!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){B(this);for(var a,b=new K(c(this)),d=_.length;d--;)a=_[d],b[a]=this[a];return b},toString:function(){B(this);var a=this.startContainer;if(a===this.endContainer&&L.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){B(this);var b=a.parentNode,c=L.getNodeIndex(a);if(!b)throw new N("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?gb:eb:e>0?fb:hb},comparePoint:function(a,b){return B(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),L.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:L.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:$,toHtml:function(){B(this);var a=c(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(B(this),x(a,"NOT_FOUND_ERR"),L.getDocument(a)!==c(this))return!1;var d=a.parentNode,e=L.getNodeIndex(a);x(d,"NOT_FOUND_ERR");var f=L.comparePoints(d,e,this.endContainer,this.endOffset),g=L.comparePoints(d,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return B(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),L.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&L.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(B(this),c(a)!=c(this))throw new N("WRONG_DOCUMENT_ERR");var d=L.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=L.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=d&&e>=0:0>d&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=L.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=L.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return-1==L.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==L.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==hb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,L.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return B(this),new p(this,a,b)},getNodes:function(a,b){return B(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){s(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){s(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return K.rangesEqual(this,a)},isValid:function(){return A(this)},inspect:function(){return m(this)}},G(K,I,J),a.rangePrototype=C.prototype,K.rangeProperties=_,K.RangeIterator=n,K.copyComparisonConstants=E,K.createPrototypeRange=G,K.inspect=m,K.getRangeDocument=c,K.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=K,a.RangeException=o}),rangy.createModule("WrappedRange",function(a){function b(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var e=c.parentElement(),f=d==e?d:g.getCommonAncestor(d,e);return f==b?f:g.getCommonAncestor(b,f)}function c(a){return 0==a.compareEndPoints("StartToEnd",a)}function d(a,b,c,d){var e=a.duplicate();e.collapse(c);var f=e.parentElement();if(g.isAncestorOf(b,f,!0)||(f=b),!f.canHaveHTML)return new h(f.parentNode,g.getNodeIndex(f));var i,j,k,l,m,n=g.getDocument(f).createElement("span"),o=c?"StartToStart":"StartToEnd";do f.insertBefore(n,n.previousSibling),e.moveToElementText(n);while((i=e.compareEndPoints(o,a))>0&&n.previousSibling);if(m=n.nextSibling,-1==i&&m&&g.isCharacterDataNode(m)){e.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(m.data)){var q=e.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;for(p=q.moveStart("character",r);-1==(i=q.compareEndPoints("StartToEnd",q));)p++,q.moveStart("character",1)}else p=e.text.length;l=new h(m,p)}else j=(d||!c)&&n.previousSibling,k=(d||c)&&n.nextSibling,l=k&&g.isCharacterDataNode(k)?new h(k,0):j&&g.isCharacterDataNode(j)?new h(j,j.length):new h(f,g.getNodeIndex(n));return n.parentNode.removeChild(n),l}function e(a,b){var c,d,e,f,h=a.offset,i=g.getDocument(a.node),j=i.body.createTextRange(),k=g.isCharacterDataNode(a.node);return k?(c=a.node,d=c.parentNode):(f=a.node.childNodes,c=h<f.length?f[h]:null,d=a.node),e=i.createElement("span"),e.innerHTML="&#feff;",c?d.insertBefore(e,c):d.appendChild(e),j.moveToElementText(e),j.collapse(!b),d.removeChild(e),k&&j[b?"moveStart":"moveEnd"]("character",h),j}a.requireModules(["DomUtil","DomRange"]);var f,g=a.dom,h=g.DomPosition,i=a.DomRange;if(!a.features.implementsDomRange||a.features.implementsTextRange&&a.config.preferTextRange){if(a.features.implementsTextRange){f=function(a){this.textRange=a,this.refresh()},f.prototype=new i(document),f.prototype.refresh=function(){var a,e,f=b(this.textRange);c(this.textRange)?e=a=d(this.textRange,f,!0,!0):(a=d(this.textRange,f,!0,!1),e=d(this.textRange,f,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(e.node,e.offset)},i.copyComparisonConstants(f);var j=function(){return this}();"undefined"==typeof j.Range&&(j.Range=f),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function b(a){for(var b,c=k.length;c--;)b=k[c],a[b]=a.nativeRange[b]}function c(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;(f||g)&&(a.setEnd(d,e),a.setStart(b,c))}function d(a){a.nativeRange.detach(),a.detached=!0;for(var b,c=k.length;c--;)b=k[c],a[b]=null}var e,h,j,k=i.rangeProperties;f=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,b(this)},i.createPrototypeRange(f,c,d),e=f.prototype,e.selectNode=function(a){this.nativeRange.selectNode(a),b(this)},e.deleteContents=function(){this.nativeRange.deleteContents(),b(this)},e.extractContents=function(){var a=this.nativeRange.extractContents();return b(this),a},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(a){this.nativeRange.surroundContents(a),b(this)},e.collapse=function(a){this.nativeRange.collapse(a),b(this)},e.cloneRange=function(){return new f(this.nativeRange.cloneRange())},e.refresh=function(){b(this)},e.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");g.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),h=!0,e.setStart=function(a,c){this.nativeRange.setStart(a,c),b(this)},e.setEnd=function(a,c){this.nativeRange.setEnd(a,c),b(this)},j=function(a){return function(c){this.nativeRange[a](c),b(this)}}}catch(n){h=!1,e.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(d){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},e.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(d){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},j=function(a,c){return function(d){try{this.nativeRange[a](d)}catch(e){this.nativeRange[c](d),this.nativeRange[a](d)}b(this)}}}e.setStartBefore=j("setStartBefore","setEndBefore"),e.setStartAfter=j("setStartAfter","setEndAfter"),e.setEndBefore=j("setEndBefore","setStartBefore"),e.setEndAfter=j("setEndAfter","setStartAfter"),m.selectNodeContents(l),e.selectNodeContents=m.startContainer==l&&m.endContainer==l&&0==m.startOffset&&m.endOffset==l.length?function(a){this.nativeRange.selectNodeContents(a),b(this)}:function(a){this.setStart(a,0),this.setEnd(a,i.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var o=document.createRange();o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),e.compareBoundaryPoints=-1==m.compareBoundaryPoints(m.START_TO_END,o)&1==m.compareBoundaryPoints(m.END_TO_START,o)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(e.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),g.getBody(document).removeChild(l),m.detach(),o.detach()}(),a.createNativeRange=function(a){return a=a||document,a.createRange()};a.features.implementsTextRange&&(f.rangeToTextRange=function(a){if(a.collapsed){var b=e(new h(a.startContainer,a.startOffset),!0);return b}var c=e(new h(a.startContainer,a.startOffset),!0),d=e(new h(a.endContainer,a.endOffset),!1),f=g.getDocument(a.startContainer).body.createTextRange();return f.setEndPoint("StartToStart",c),f.setEndPoint("EndToEnd",d),f}),f.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=f,a.createRange=function(b){return b=b||document,new f(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new i(a)},a.createIframeRange=function(b){return a.createRange(g.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(g.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function f(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function g(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function h(b){var c;return b instanceof y?(c=b._selectionNativeRange,c||(c=a.createNativeRange(w.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof z?c=b.nativeRange:a.features.implementsDomRange&&b instanceof w.getWindow(b.startContainer).Range&&(c=b),c}function i(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!w.isAncestorOf(a[0],a[b]))return!1;return!0}function j(a){var b=a.getNodes();if(!i(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function k(a){return!!a&&"undefined"!=typeof a.text}function l(a,b){var c=new z(b);a._ranges=[c],e(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function m(b){if(b._ranges.length=0,"None"==b.docSelection.type)g(b);else{var c=b.docSelection.createRange();if(k(c))l(b,c);else{b.rangeCount=c.length;for(var d,f=w.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(f),d.selectNode(c.item(h)),b._ranges.push(d);
b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,e(b,b._ranges[b.rangeCount-1],!1)}}}function n(a,b){for(var c=a.docSelection.createRange(),d=j(b),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=0,h=c.length;h>g;++g)f.add(c.item(g));try{f.add(d)}catch(i){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}f.select(),m(a)}function o(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function p(a,b){for(var c,d=w.getDocument(b[0].startContainer),e=w.getBody(d).createControlRange(),f=0;rangeCount>f;++f){c=j(b[f]);try{e.add(c)}catch(g){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),m(a)}function q(a,b){if(a.anchorNode&&w.getDocument(a.anchorNode)!==w.getDocument(b))throw new A("WRONG_DOCUMENT_ERR")}function r(a){var b=[],c=new B(a.anchorNode,a.anchorOffset),d=new B(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=y.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var s,t,u="boolean",v="_rangySelection",w=a.dom,x=a.util,y=a.DomRange,z=a.WrappedRange,A=a.DOMException,B=w.DomPosition,C="Control",D=a.util.isHostMethod(window,"getSelection"),E=a.util.isHostObject(document,"selection"),F=E&&(!D||a.config.preferTextRange);F?(s=d,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return"None"!=c.type||w.getDocument(c.createRange().parentElement())==b}):D?(s=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=s;var G=s(),H=a.createNativeRange(document),I=w.getBody(document),J=x.areHostObjects(G,["anchorNode","focusNode"]&&x.areHostProperties(G,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=J;var K=x.isHostMethod(G,"extend");a.features.selectionHasExtend=K;var L="number"==typeof G.rangeCount;a.features.selectionHasRangeCount=L;var M=!1,N=!0;x.areHostMethods(G,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof G.rangeCount&&a.features.implementsDomRange&&!function(){var a=document.createElement("iframe");a.frameBorder=0,a.style.position="absolute",a.style.left="-10000px",I.appendChild(a);var b=w.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=w.getIframeWindow(a).getSelection(),d=b.documentElement,e=d.lastChild,f=e.firstChild,g=b.createRange();g.setStart(f,1),g.collapse(!0),c.addRange(g),N=1==c.rangeCount,c.removeAllRanges();var h=g.cloneRange();g.setStart(f,0),h.setEnd(f,2),c.addRange(g),c.addRange(h),M=2==c.rangeCount,g.detach(),h.detach(),I.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=M,a.features.collapsedNonEditableSelectionsSupported=N;var O,P=!1;I&&x.isHostMethod(I,"createControlRange")&&(O=I.createControlRange(),x.areHostProperties(O,["item","add"])&&(P=!0)),a.features.implementsControlRange=P,t=J?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var Q;x.isHostMethod(G,"getRangeAt")?Q=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:J&&(Q=function(b){var c=w.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[v],c=s(a),e=E?d(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new o(c,e,a),a[v]=b),b},a.getIframeSelection=function(b){return a.getSelection(w.getIframeWindow(b))};var R=o.prototype;if(!F&&J&&x.areHostMethods(G,["removeAllRanges","addRange"])){R.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),g(this)};var S=function(b,c){var d=y.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(h(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};R.addRange=L?function(b,c){if(P&&E&&this.docSelection.type==C)n(this,b);else if(c&&K)S(this,b);else{var d;if(M?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(h(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var f=Q(this.nativeSelection,this.rangeCount-1);f&&!y.rangesEqual(f,b)&&(b=new z(f))}this._ranges[this.rangeCount-1]=b,e(this,b,V(this.nativeSelection)),this.isCollapsed=t(this)}else this.refresh()}}:function(a,b){b&&K?S(this,a):(this.nativeSelection.addRange(h(a)),this.refresh())},R.setRanges=function(a){if(P&&a.length>1)p(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(x.isHostMethod(G,"empty")&&x.isHostMethod(H,"select")&&P&&F))return b.fail("No means of selecting a Range or TextRange was found"),!1;R.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=w.getDocument(this.anchorNode);else if(this.docSelection.type==C){var b=this.docSelection.createRange();b.length&&(a=w.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}g(this)},R.addRange=function(a){this.docSelection.type==C?n(this,a):(z.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},R.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?p(this,a):b&&this.addRange(a[0])}}R.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new A("INDEX_SIZE_ERR");return this._ranges[a]};var T;if(F)T=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=w.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==C?m(b):k(c)?l(b,c):g(b)};else if(x.isHostMethod(G,"getRangeAt")&&"number"==typeof G.rangeCount)T=function(b){if(P&&E&&b.docSelection.type==C)m(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],V(b.nativeSelection)),b.isCollapsed=t(b)}else g(b)};else{if(!J||typeof G.isCollapsed!=u||typeof H.collapsed!=u||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;T=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=Q(c,0),a._ranges=[b],a.rangeCount=1,f(a),a.isCollapsed=t(a)):g(a)}}R.refresh=function(a){var b=a?this._ranges.slice(0):null;if(T(this),a){var c=b.length;if(c!=this._ranges.length)return!1;for(;c--;)if(!y.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var U=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;f>e;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||g(a)};R.removeRange=P?function(a){if(this.docSelection.type==C){for(var b,c=this.docSelection.createRange(),d=j(a),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),m(this)}else U(this,a)}:function(a){U(this,a)};var V;!F&&J&&a.features.implementsDomRange?(V=function(a){var b=!1;return a.anchorNode&&(b=1==w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},R.isBackwards=function(){return V(this)}):V=R.isBackwards=function(){return!1},R.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},R.collapse=function(b,c){q(this,b);var d=a.createRange(w.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},R.collapseToStart=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},R.collapseToEnd=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},R.selectAllChildren=function(b){q(this,b);var c=a.createRange(w.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},R.deleteFromDocument=function(){if(P&&E&&this.docSelection.type==C){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}},R.getAllRanges=function(){return this._ranges.slice(0)},R.setSingleRange=function(a){this.setRanges([a])},R.containsNode=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},R.toHtml=function(){var a="";if(this.rangeCount){for(var b=y.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;d>c;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},R.getName=function(){return"WrappedSelection"},R.inspect=function(){return r(this)},R.detach=function(){this.win[v]=null,this.win=this.anchorNode=this.focusNode=null},o.inspect=r,a.Selection=o,a.selectionPrototype=R,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})}),!function(a,b){"function"==typeof define?define(b):"undefined"!=typeof module&&module.exports?module.exports.browser=b():this[a]=b()}("bowser",function(){function a(){return e?{msie:d,version:c.match(/msie (\d+(\.\d+)?);/i)[1]}:f?{webkit:d,chrome:d,version:c.match(/chrome\/(\d+(\.\d+)?)/i)[1]}:g?{webkit:d,phantom:d,version:c.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]}:k?{webkit:d,touchpad:d,version:c.match(/touchpad\/(\d+(\.\d+)?)/i)[1]}:i||j?(b={webkit:d,mobile:d,ios:d,iphone:i,ipad:j},q.test(c)&&(b.version=c.match(q)[1]),b):l?{webkit:d,android:d,mobile:d,version:c.match(q)[1]}:h?{webkit:d,safari:d,version:c.match(q)[1]}:m?{opera:d,version:c.match(q)[1]}:o?(b={gecko:d,mozilla:d,version:c.match(/firefox\/(\d+(\.\d+)?)/i)[1]},n&&(b.firefox=d),b):p?{seamonkey:d,version:c.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}:void 0}var b,c=navigator.userAgent,d=!0,e=/msie/i.test(c),f=/chrome/i.test(c),g=/phantom/i.test(c),h=/safari/i.test(c)&&!f&&!g,i=/iphone/i.test(c),j=/ipad/i.test(c),k=/touchpad/i.test(c),l=/android/i.test(c),m=/opera/i.test(c),n=/firefox/i.test(c),o=/gecko\//i.test(c),p=/seamonkey\//i.test(c),q=/version\/(\d+(\.\d+)?)/i,r=a();return r.msie&&r.version>=7||r.chrome&&r.version>=10||r.firefox&&r.version>=4||r.safari&&r.version>=5||r.opera&&r.version>=10?r.a=d:r.msie&&r.version<7||r.chrome&&r.version<10||r.firefox&&r.version<4||r.safari&&r.version<5||r.opera&&r.version<10?r.c=d:r.x=d,r}),function(a,b,c,d){"use strict";var e,f,g={},h=function(){return c||function(){throw new Error("jQuery-like library not yet implemented")}}();e=function(){if(j.log!==!1){var b,c;return b=Array.prototype.slice.call(arguments),b.length&&"trace"===b[b.length-1]&&(b.pop(),((c=a.console)?c.trace:void 0)&&console.trace()),1===b.length&&(b=b[0]),a.console?console.log(b):void 0}},f=function(){if(j.logErrors!==!1){var b;return b=Array.prototype.slice.call(arguments),1===b.length&&(b=b[0]),a.console&&"function"==typeof a.console.error?console.error(b):a.console?console.log(b):void 0}};var i=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return{trimRight:function(a){return a.replace(/\s+$/,"")},trimLeft:function(a){return a.replace(/^\s+/,"")},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},isString:function(a){return"[object String]"===toString.call(a)},regexp:function(a,b){b||(b="g");var c=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return new RegExp(c,b)},escapeHtml:function(b,c){return b.replace(c?/[&<>'"]/g:/[&<>]/g,function(b){return a[b]})},browserEscapeHtml:function(a){var c=b.createElement("div");return c.appendChild(b.createTextNode(a)),c.innerHTML}}}(),j={log:!1,logErrors:!0,editableClass:"js-editable",editableDisabledClass:"js-editable-disabled",pastingAttribute:"data-editable-is-pasting",boldTag:"<strong>",italicTag:"<em>",pastedHtmlRules:{allowedElements:{a:{href:!0},strong:{},em:{},br:{}},requiredAttributes:{a:["href"]},transformElements:{b:"strong",i:"em"},splitIntoBlocks:["h1","h2","h3","h4","h5","h6","p","blockquote"],blockLevelElements:["h1","h2","h3","h4","h5","h6","div","p","pre","hr","blockquote","article","figure","header","footer","ul","ol","li","section","table","video"]}};g=function(b){var c={window:a,defaultBehavior:!0,mouseMoveSelectionChanges:!1,browserSpellcheck:!0};this.config=h.extend(c,b),this.win=this.config.window,this.editableSelector="."+j.editableClass,rangy.initialized||rangy.init(),this.dispatcher=new u(this),this.config.defaultBehavior===!0&&this.dispatcher.on(t(this))},g.globalConfig=function(a){h.extend(j,a),p.updateConfig(j)},g.prototype.add=function(a){return this.enable(h(a)),this},g.prototype.remove=function(a){var b=h(a);return this.disable(b),b.removeClass(j.editableDisabledClass),this},g.prototype.disable=function(a){var b=this.win.document.body;return a=a||h("."+j.editableClass,b),a.removeAttr("contenteditable").removeAttr("spellcheck").removeClass(j.editableClass).addClass(j.editableDisabledClass),this},g.prototype.enable=function(a,b){var c=this.win.document.body;return a=a||h("."+j.editableDisabledClass,c),a.attr("contenteditable",!0).attr("spellcheck",this.config.browserSpellcheck).removeClass(j.editableDisabledClass).addClass(j.editableClass),b&&a.each(function(a,b){q.tidyHtml(b)}),this},g.prototype.suspend=function(a){var b=this.win.document.body;return a=a||h("."+j.editableClass,b),a.removeAttr("contenteditable"),this},g.prototype.continue=function(a){var b=this.win.document.body;return a=a||h("."+j.editableClass,b),a.attr("contenteditable",!0),this},g.prototype.createCursor=function(a,b){var c,d=h(a).closest(this.editableSelector);if(b=b||"beginning",d.length){var e=rangy.createRange();"beginning"===b||"end"===b?(e.selectNodeContents(a),e.collapse("beginning"===b?!0:!1)):a!==d[0]?"before"===b?(e.setStartBefore(a),e.setEndBefore(a)):"after"===b&&(e.setStartAfter(a),e.setEndAfter(a)):f("EditableJS: cannot create cursor outside of an editable block."),c=new r(d[0],e)}return c},g.prototype.createCursorAtBeginning=function(a){return this.createCursor(a,"beginning")},g.prototype.createCursorAtEnd=function(a){return this.createCursor(a,"end")},g.prototype.createCursorBefore=function(a){return this.createCursor(a,"before")},g.prototype.createCursorAfter=function(a){return this.createCursor(a,"after")},g.prototype.getContent=function(a){return q.extractContent(a)},g.prototype.appendTo=function(a,b){"string"==typeof b&&(b=q.createFragmentFromString(b));var c=this.createCursor(a,"end");return c.insertAfter(b),c},g.prototype.prependTo=function(a,b){"string"==typeof b&&(b=q.createFragmentFromString(b));var c=this.createCursor(a,"beginning");return c.insertBefore(b),c},g.prototype.getSelection=function(a){var b=this.dispatcher.selectionWatcher.getFreshSelection();if(a&&b){var c=b.range;try{c.compareNode(a)!==c.NODE_BEFORE_AND_AFTER&&(b=d)}catch(e){b=d}}return b},g.prototype.setupSpellcheck=function(a){return this.spellcheck=new I(this,a),this},g.prototype.on=function(a,b){return this.dispatcher.on(a,b),this},g.prototype.off=function(){var a=Array.prototype.slice.call(arguments);return this.dispatcher.off.apply(this.dispatcher,a),this},g.prototype.unload=function(){return this.dispatcher.unload(),this};for(var k=function(a){g.prototype[a]=function(b){return this.on(a,b)}},l=["focus","blur","flow","selection","cursor","newline","insert","split","merge","empty","change","switch","move","clipboard"],m=0;m<l.length;++m){var n=l[m];k(n)}var o=function(){var a=function(a){return function(b){var c=b[a];return c&&c.getAttribute("contenteditable")?c:null}};return{next:a("nextElementSibling"),previous:a("previousElementSibling")}}(),p=function(){var a,b,c,d,e,f=/^\s*$/,g="<!-- BLOCK -->",k=function(f){var g,h,i=f.pastedHtmlRules;for(a=i.allowedElements||{},b=i.requiredAttributes||{},c=i.transformElements||{},d={},g=0;g<i.blockLevelElements.length;g++)h=i.blockLevelElements[g],d[h]=!0;for(e={},g=0;g<i.splitIntoBlocks.length;g++)h=i.splitIntoBlocks[g],e[h]=!0};return k(j),{updateConfig:k,paste:function(a,b,c,d){a.setAttribute(j.pastingAttribute,!0),c.isSelection&&(c=c.deleteContent()),c.save();var e=this.getContenteditableContainer(d);e.focus();var f=this;setTimeout(function(){var b,d;b=f.filterContent(e),d=q.createFragmentFromString(b),h(e).remove(),c.restore(),c.insertBefore(d),c.setVisibleSelection(),a.removeAttribute(j.pastingAttribute)},0)},getContenteditableContainer:function(a){var b=h("<div>").attr("contenteditable",!0).css({position:"fixed",left:"5px",top:"5px",width:"1px",height:"1px",overflow:"hidden"})[0];return h(a.body).append(b),b},filterContent:function(a){var b=this.filterHtmlElements(a),c=b.split(g);return c=c.filter(function(a){return!f.test(a)}),b=c.join("<br><br>"),b=this.cleanWhitespace(b),b&&(b=i.trim(b)),b},filterHtmlElements:function(a,b){b||(b=[]);for(var c,d="",e=0;e<a.childNodes.length;e++)if(c=a.childNodes[e],c.nodeType===C.elementNode){var f=this.filterHtmlElements(c,b);d+=this.conditionalNodeWrap(c,f)}else c.nodeType===C.textNode&&(d+=i.escapeHtml(c.nodeValue));return d},conditionalNodeWrap:function(a,b){var c=a.nodeName.toLowerCase();if(c=this.transformNodeName(c),this.shouldKeepNode(c,a)){var h=this.filterAttributes(c,a);return"br"===c?"<"+c+h+">":f.test(b)?b:"<"+c+h+">"+b+"</"+c+">"}return e[c]?g+b+g:d[c]?b+" ":b},filterAttributes:function(b,c){for(var d="",e=0,f=(c.attributes||[]).length;f>e;e++){var g=c.attributes[e].name,h=c.attributes[e].value;a[b][g]&&h&&(d+=" "+g+'="'+h+'"')}return d},transformNodeName:function(a){return c[a]?c[a]:a},hasRequiredAttributes:function(a,c){var d,e,f=b[a];if(f)for(var g=0;g<f.length;g++)if(d=f[g],e=c.getAttribute(d),!e)return!1;return!0},shouldKeepNode:function(b,c){return a[b]&&this.hasRequiredAttributes(b,c)},cleanWhitespace:function(a){var b=a.replace(/(.)(\u00A0)/g,function(a,b){return/[\u0020]/.test(b)?b+"":b+" "});return b}}}(),q=function(){var a=function(a,b,c){return b=F.save(b),c.call(q),F.restore(a,b)},c=/\u200B/g,d=/\uFEFF/g;return{tidyHtml:function(a){this.normalizeTags(a)},normalizeTags:function(a){var c,d,e,f,g=b.createDocumentFragment();for(c=0;c<a.childNodes.length;c++)if(e=a.childNodes[c],e&&("BR"===e.nodeName||e.textContent)){if(e.nodeType===C.elementNode&&"BR"!==e.nodeName){for(f=e;null!==(f=f.nextSibling)&&D.isSameNode(f,e);){for(d=0;d<f.childNodes.length;d++)e.appendChild(f.childNodes[d].cloneNode(!0));f.parentNode.removeChild(f)}this.normalizeTags(e)}g.appendChild(e.cloneNode(!0))}for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(g)},cleanInternals:function(a){a.innerHTML=this.extractContent(a,!0)},extractContent:function(a,e){var f;f=a.nodeType===C.documentFragmentNode?this.getInnerHtmlOfFragment(a):a.innerHTML,f=f.replace(d,""),f=f.replace(c,"<br>");var g=b.createElement("div");return g.innerHTML=f,this.unwrapInternalNodes(g,e),g.innerHTML},getInnerHtmlOfFragment:function(a){var c=b.createElement("div");return c.appendChild(a),c.innerHTML},createFragmentFromString:function(a){for(var c=b.createDocumentFragment(),d=h("<div>").html(a).contents(),e=0;e<d.length;e++){var f=d[e];c.appendChild(f)}return c},cloneRangeContents:function(a){for(var c=a.cloneContents(),d=c.childNodes[0],e=b.createDocumentFragment();d.childNodes.length;)e.appendChild(d.childNodes[0]);return e},unwrapInternalNodes:function(a,b){for(;a;){var c=a.nextSibling;if(a.nodeType===C.elementNode){var d=a.getAttribute("data-editable");a.firstChild&&this.unwrapInternalNodes(a.firstChild,b),"remove"===d?h(a).remove():"unwrap"===d?this.unwrap(a):"ui-remove"!==d||b?"ui-unwrap"!==d||b||this.unwrap(a):h(a).remove()}a=c}},getTags:function(a,b,c){for(var d=this.getInnerTags(b,c),e=b.commonAncestorContainer;e!==a;)(!c||c(e))&&d.push(e),e=e.parentNode;return d},getTagsByName:function(a,b,c){return this.getTags(a,b,function(a){return a.nodeName===c.toUpperCase()})},getInnerTags:function(a,b){return a.getNodes([C.elementNode],b)},getTagNames:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push(a[c].nodeName);return b},isAffectedBy:function(a,b,c){for(var d,e=this.getTags(a,b),f=0;f<e.length;f++)if(d=e[f],d.nodeName===c.toUpperCase())return!0;return!1},isExactSelection:function(a,b,c){var d=rangy.createRange();if(d.selectNodeContents(b),a.intersectsRange(d)){var e=a.toString(),f=h(b).text();return c&&(e=i.trim(e),f=i.trim(f)),""!==e&&e===f}return!1},expandTo:function(a,b,c){return b.selectNodeContents(c),b},toggleTag:function(a,b,c){var d=this.getTagsByName(a,b,c.nodeName);return 1===d.length&&this.isExactSelection(b,d[0],"visible")?this.removeFormatting(a,b,c.nodeName):this.forceWrap(a,b,c)},isWrappable:function(a){return a.canSurroundContents()},forceWrap:function(b,c,d){return c=a(b,c,function(){this.nuke(b,c,d.nodeName)}),this.isWrappable(c)||(c=a(b,c,function(){this.nuke(b,c)})),this.wrap(c,d),c},wrap:function(a,b){if(b=i.isString(b)?h(b)[0]:b,this.isWrappable(a)){a.surroundContents(b)}else console.log("content.wrap(): can not surround range")},unwrap:function(a){var b=h(a),c=b.contents();c.length?c.unwrap():b.remove()},removeFormatting:function(b,c,d){return a(b,c,function(){this.nuke(b,c,d)})},nuke:function(a,b,c){for(var d=this.getTags(a,b),e=0;e<d.length;e++){var f=d[e];"BR"===f.nodeName||c&&f.nodeName!==c.toUpperCase()||this.unwrap(f)}},insertCharacter:function(a,c,d){var e=b.createTextNode(c),f=a.cloneRange();f.collapse(d),f.insertNode(e),d?a.setStartBefore(e):a.setEndAfter(e),a.normalizeBoundaries()},surround:function(a,b,c,d){return d||(d=c),this.insertCharacter(b,d,!1),this.insertCharacter(b,c,!0),b},deleteCharacter:function(b,c,d){return this.containsString(c,d)&&(c.splitBoundaries(),c=a(b,c,function(){for(var a=i.regexp(d),b=c.getNodes([C.textNode],function(b){return b.nodeValue.search(a)>=0}),e=0;e<b.length;e++){var f=b[e];f.nodeValue=f.nodeValue.replace(a,"")}}),c.normalizeBoundaries()),c},containsString:function(a,b){var c=a.toString();return c.indexOf(b)>=0},nukeTag:function(a,b,c){for(var d=this.getTags(a,b),e=0;e<d.length;e++){var f=d[e];f.nodeName===c&&this.unwrap(f)}}}}(),r=function(){var b=function(a,b){this.setHost(a),this.range=b,this.isCursor=!0};return b.prototype=function(){return{isAtEnd:function(){return D.isEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtTextEnd:function(){return D.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtBeginning:function(){return D.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)},insertBefore:function(a){if(!D.isDocumentFragmentWithoutChildren(a)){var b=a;if(a.nodeType===C.documentFragmentNode){var c=a.childNodes.length-1;b=a.childNodes[c]}this.range.insertNode(a),this.range.setStartAfter(b),this.range.setEndAfter(b)}},insertAfter:function(a){D.isDocumentFragmentWithoutChildren(a)||this.range.insertNode(a)},setSelection:function(){this.setVisibleSelection()},setVisibleSelection:function(){this.win.document.activeElement!==this.host&&h(this.host).focus(),rangy.getSelection(this.win).setSingleRange(this.range)},before:function(){var a=null,b=this.range.cloneRange();return b.setStartBefore(this.host),a=q.cloneRangeContents(b)},beforeHtml:function(){return q.getInnerHtmlOfFragment(this.before())},after:function(){var a=null,b=this.range.cloneRange();return b.setEndAfter(this.host),a=q.cloneRangeContents(b)},afterHtml:function(){return q.getInnerHtmlOfFragment(this.after())},getCoordinates:function(a){a=a||"absolute";var b=this.range.nativeRange.getBoundingClientRect();if("fixed"===a)return b;var c=this.win,e=c.pageXOffset!==d?c.pageXOffset:(c.document.documentElement||c.document.body.parentNode||c.document.body).scrollLeft,f=c.pageYOffset!==d?c.pageYOffset:(c.document.documentElement||c.document.body.parentNode||c.document.body).scrollTop;return{top:b.top+f,bottom:b.bottom+f,left:b.left+e,right:b.right+e,height:b.height,width:b.width}},moveBefore:function(a){return this.updateHost(a),this.range.setStartBefore(a),this.range.setEndBefore(a),this.isSelection?new b(this.host,this.range):void 0},moveAfter:function(a){return this.updateHost(a),this.range.setStartAfter(a),this.range.setEndAfter(a),this.isSelection?new b(this.host,this.range):void 0},moveAtBeginning:function(a){return a||(a=this.host),this.updateHost(a),this.range.selectNodeContents(a),this.range.collapse(!0),this.isSelection?new b(this.host,this.range):void 0},moveAtEnd:function(a){return a||(a=this.host),this.updateHost(a),this.range.selectNodeContents(a),this.range.collapse(!1),this.isSelection?new b(this.host,this.range):void 0},moveAtTextEnd:function(a){return this.moveAtEnd(D.latestChild(a))},setHost:function(b){b.jquery&&(b=b[0]),this.host=b,this.win=b===d||null===b?a:b.ownerDocument.defaultView},updateHost:function(a){var b=D.getHost(a);b||f("Can not set cursor outside of an editable block"),this.setHost(b)},retainVisibleSelection:function(a){this.save(),a(),this.restore(),this.setVisibleSelection()},save:function(){this.savedRangeInfo=F.save(this.range),this.savedRangeInfo.host=this.host},restore:function(){this.savedRangeInfo?(this.host=this.savedRangeInfo.host,this.range=F.restore(this.host,this.savedRangeInfo),this.savedRangeInfo=d):f("Could not restore selection")},equals:function(a){return a&&a.host&&a.host.isEqualNode(this.host)&&a.range&&a.range.equals(this.range)?!0:!1},triggerChange:function(){h(this.host).trigger("formatEditable")}}}(),b}(),s=function(a){{var b=a.win.document;a.dispatcher.selectionWatcher}return{focus:function(a){if(D.isVoid(a)){var c=b.createElement("br");c.setAttribute("data-editable","remove"),a.appendChild(c)}},blur:function(a){q.cleanInternals(a)},selection:function(a,b){e(b?"Default selection behavior":"Default selection empty behavior")},cursor:function(a,b){e(b?"Default cursor behavior":"Default cursor empty behavior")},newline:function(a,c){var d=c.isAtEnd(),f=b.createElement("br");if(c.insertBefore(f),d){e("at the end");var g=b.createTextNode("");c.insertAfter(g)}else e("not at the end");c.setVisibleSelection()},insert:function(a,b){var c=a.parentNode,d=a.cloneNode(!1);switch(d.id&&d.removeAttribute("id"),b){case"before":c.insertBefore(d,a),a.focus();break;case"after":c.insertBefore(d,a.nextSibling),d.focus()}},split:function(a,b,c){var d=a.cloneNode();d.appendChild(b);var e=a.parentNode;for(e.insertBefore(d,a);a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c),q.tidyHtml(d),q.tidyHtml(a),a.focus()},merge:function(b,c,d){var e,f;switch(c){case"before":e=o.previous(b),f=b;break;case"after":e=b,f=o.next(b)}e&&f&&(d=e.childNodes.length>0?a.appendTo(e,f.innerHTML):a.prependTo(e,f.innerHTML),f.parentNode.removeChild(f),d.save(),q.tidyHtml(e),d.restore(),d.setVisibleSelection())},empty:function(){e("Default empty behavior")},"switch":function(a,b,c){var d,e;switch(b){case"before":e=o.previous(a),e&&(c.moveAtTextEnd(e),c.setVisibleSelection());break;case"after":d=o.next(a),d&&(c.moveAtBeginning(d),c.setVisibleSelection())}},move:function(){e("Default move behavior")},clipboard:function(a,c,d){"paste"===c&&p.paste(a,c,d,b)}}},t=function(a){var b=s(a);return{focus:function(a){b.focus(a)},blur:function(a){b.blur(a)},flow:function(a,c){b.flow(a,c)},selection:function(a,c){b.selection(a,c)},cursor:function(a,c){b.cursor(a,c)},newline:function(a,c){b.newline(a,c)},split:function(a,c,d,e){b.split(a,c,d,e)},insert:function(a,c,d){b.insert(a,c,d)},merge:function(a,c,d){b.merge(a,c,d)},empty:function(a){b.empty(a)},"switch":function(a,c,d){b.switch(a,c,d)},move:function(a,c,d){b.move(a,c,d)},clipboard:function(a,c,d){b.clipboard(a,c,d)}}},u=function(a){var b=a.win;x(this,a),this.supportsInputEvent=!1,this.$document=h(b.document),this.config=a.config,this.editable=a,this.editableSelector=a.editableSelector,this.keyboard=new A,this.selectionWatcher=new G(this,b),this.setup()},v=!1;u.prototype.setup=function(){this.setupElementEvents(),this.setupKeyboardEvents(),y.selectionchange?this.setupSelectionChangeEvents():this.setupSelectionChangeFallback()},u.prototype.unload=function(){this.off(),this.$document.off(".editable")},u.prototype.setupElementEvents=function(){var a=this;this.$document.on("focus.editable",a.editableSelector,function(){this.getAttribute(j.pastingAttribute)||a.notify("focus",this)}).on("blur.editable",a.editableSelector,function(){this.getAttribute(j.pastingAttribute)||a.notify("blur",this)}).on("copy.editable",a.editableSelector,function(){e("Copy"),a.notify("clipboard",this,"copy",a.selectionWatcher.getFreshSelection())}).on("cut.editable",a.editableSelector,function(){e("Cut"),a.notify("clipboard",this,"cut",a.selectionWatcher.getFreshSelection()),a.triggerChangeEvent(this)}).on("paste.editable",a.editableSelector,function(){e("Paste"),a.notify("clipboard",this,"paste",a.selectionWatcher.getFreshSelection()),a.triggerChangeEvent(this)}).on("input.editable",a.editableSelector,function(){e("Input"),v?a.notify("change",this):v=!0}).on("formatEditable.editable",a.editableSelector,function(){a.notify("change",this)})},u.prototype.triggerChangeEvent=function(a){v||this.notify("change",a)},u.prototype.dispatchSwitchEvent=function(a,b,c){var d;if(!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)&&(d=this.selectionWatcher.getSelection(),d&&!d.isSelection)){var e=this;setTimeout(function(){var f=e.selectionWatcher.forceCursor();f.equals(d)&&(a.preventDefault(),a.stopPropagation(),e.notify("switch",b,c,f))},1)}},u.prototype.setupKeyboardEvents=function(){var a=this;this.$document.on("keydown.editable",this.editableSelector,function(b){var c=!v;a.keyboard.dispatchKeyEvent(b,this,c)}),this.keyboard.on("left",function(b){a.dispatchSwitchEvent(b,this,"before")}).on("up",function(b){a.dispatchSwitchEvent(b,this,"before")}).on("right",function(b){a.dispatchSwitchEvent(b,this,"after")}).on("down",function(b){a.dispatchSwitchEvent(b,this,"after")}).on("tab",function(){}).on("shiftTab",function(){}).on("esc",function(){}).on("backspace",function(b){var c=a.selectionWatcher.getFreshRange();if(c.isCursor){var d=c.getCursor();d.isAtBeginning()?(b.preventDefault(),b.stopPropagation(),a.notify("merge",this,"before",d)):a.triggerChangeEvent(this)}else a.triggerChangeEvent(this)}).on("delete",function(b){var c=a.selectionWatcher.getFreshRange();if(c.isCursor){var d=c.getCursor();d.isAtTextEnd()?(b.preventDefault(),b.stopPropagation(),a.notify("merge",this,"after",d)):a.triggerChangeEvent(this)}else a.triggerChangeEvent(this)}).on("enter",function(b){b.preventDefault(),b.stopPropagation();var c=a.selectionWatcher.getFreshRange(),d=c.forceCursor();d.isAtTextEnd()?a.notify("insert",this,"after",d):d.isAtBeginning()?a.notify("insert",this,"before",d):a.notify("split",this,d.before(),d.after(),d)}).on("shiftEnter",function(b){b.preventDefault(),b.stopPropagation();var c=a.selectionWatcher.forceCursor();a.notify("newline",this,c)}).on("character",function(){a.notify("change",this)})},u.prototype.setupSelectionChangeEvents=function(){var a=!1,b=!1,c=this.$document,d=this.selectionWatcher,e=this;c.on("selectionchange.editable",function(){b?a=!0:d.selectionChanged()}),c.on("mousedown.editable",this.editableSelector,function(){e.config.mouseMoveSelectionChanges===!1&&(b=!0,setTimeout(h.proxy(d,"selectionChanged"),0)),c.on("mouseup.editableSelection",function(){c.off(".editableSelection"),b=!1,a&&(a=!1,d.selectionChanged())})})},u.prototype.setupSelectionChangeFallback=function(){var a=this.$document,b=this.selectionWatcher;a.on("mouseup.editableSelection",function(){setTimeout(h.proxy(b,"selectionChanged"),0)
}),a.on("keyup.editable",this.editableSelector,function(){b.selectionChanged()})};var w=function(a){var b={},c=function(a,c){b[a]===d&&(b[a]=[]),b[a].push(c)},e=function(a,c){var e=b[a];if(e!==d)for(var f=0,g=e.length;g>f;f++)if(e[f]===c){e.splice(f,1);break}};return{on:function(a,b){if(2===arguments.length)c(a,b);else if(1===arguments.length){var d=a;for(var e in d)c(e,d[e])}return this},off:function(a,c){2===arguments.length?e(a,c):1===arguments.length?b[a]=[]:b={}},notify:function(c,e){var f;a?(e=c,c=a,f=Array.prototype.slice.call(arguments).splice(1)):f=Array.prototype.slice.call(arguments).splice(2);var g=b[e];if(g!==d)for(var h=g.length-1;h>=0&&g[h].apply(c,f)!==!1;h--);}}},x=function(a,b){var c=w(b);for(var d in c)a[d]=c[d]},y=function(){var a="undefined"!=typeof b.documentElement.contentEditable,c=function(){return!(bowser.gecko||bowser.opera)}();return{contenteditable:a,selectionchange:c}}(),z=function(){return{extractText:function(a){for(var b,c="",d=new B(a);b=d.getNextTextNode();)c+=b.data;return c},highlight:function(a,b,c){var d=this.find(a,b);this.highlightMatches(a,d,c)},find:function(a,b){for(var c,d=this.extractText(a),e=[],f=0;c=b.exec(d);)e.push(this.prepareMatch(c,f)),f+=1;return e},highlightMatches:function(a,b,c){if(b&&0!==b.length)for(var d,e,f,g,h,i=0,j=b[i],k=0,l=new B(a),m=[];d=l.getNextTextNode();){var n=d.data,o=k+n.length;if(o>j.startIndex&&k<j.endIndex){g=h=!1,k<=j.startIndex&&(g=!0),o>=j.endIndex&&(h=!0),f=g?j.startIndex-k:0,e=h?j.endIndex-k-f:d.data.length-f;var p={element:d,text:d.data.substring(f,f+e),offset:f,length:e,isLastPortion:h};if(m.push(p),h){var q=this.wrapWord(m,c);l.replaceCurrent(q),o=k+p.length+p.offset,m=[],i+=1,i<b.length&&(j=b[i])}}k=o}},getRange:function(a){var b=rangy.createRange();return b.selectNodeContents(a),b},wrapWord:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];c=this.wrapPortion(e,b)}return c},wrapPortion:function(a,b){var c=rangy.createRange();c.setStart(a.element,a.offset),c.setEnd(a.element,a.offset+a.length);var d=b.cloneNode(!0);if(c.surroundContents(d),d.nextSibling){var e=d.nextSibling;e.nodeType===C.textNode&&""===e.data&&e.parentNode.removeChild(e)}return d},prepareMatch:function(a,b){return a[2]?this.prepareMatchForSecondSubgroup(a,b):{startIndex:a.index,endIndex:a.index+a[0].length,matchIndex:b,search:a[0]}},prepareMatchForSecondSubgroup:function(a,b){var c=a.index;return c+=a[1].length,{startIndex:c,endIndex:c+a[2].length,matchIndex:b,search:a[0]}}}}(),A=function(){x(this)};A.prototype.dispatchKeyEvent=function(a,b,c){switch(a.keyCode){case this.key.left:this.notify(b,"left",a);break;case this.key.right:this.notify(b,"right",a);break;case this.key.up:this.notify(b,"up",a);break;case this.key.down:this.notify(b,"down",a);break;case this.key.tab:a.shiftKey?this.notify(b,"shiftTab",a):this.notify(b,"tab",a);break;case this.key.esc:this.notify(b,"esc",a);break;case this.key.backspace:this.notify(b,"backspace",a);break;case this.key["delete"]:this.notify(b,"delete",a);break;case this.key.enter:a.shiftKey?this.notify(b,"shiftEnter",a):this.notify(b,"enter",a);break;case this.key.ctrl:case this.key.shift:case this.key.alt:break;case 224:case 17:case 91:case 93:break;default:c&&this.notify(b,"character",a)}},A.prototype.key={left:37,up:38,right:39,down:40,tab:9,esc:27,backspace:8,"delete":46,enter:13,shift:16,ctrl:17,alt:18},A.key=A.prototype.key;var B=function(){var a=function(a){this.root=a,this.current=this.next=this.root};return a.prototype.getNextTextNode=function(){for(var a;a=this.getNext();)if(a.nodeType===C.textNode&&""!==a.data)return a},a.prototype.getNext=function(){var a,b;if(b=this.current=this.next,a=this.next=d,this.current)if(a=b.firstChild,a&&"remove"!==b.getAttribute("data-editable"))this.next=a;else for(;b!==this.root&&!(this.next=b.nextSibling);)b=b.parentNode;return this.current},a.prototype.replaceCurrent=function(a){this.current=a,this.next=d;for(var b=this.current;b!==this.root&&!(this.next=b.nextSibling);)b=b.parentNode},a}(),C={elementNode:1,attributeNode:2,textNode:3,cdataSectionNode:4,entityReferenceNode:5,entityNode:6,processingInstructionNode:7,commentNode:8,documentNode:9,documentTypeNode:10,documentFragmentNode:11,notationNode:12},D=function(){return{getHost:function(a){var b="."+j.editableClass,c=h(a).closest(b);return c.length?c[0]:d},getNodeIndex:function(a){for(var b=0;null!==(a=a.previousSibling);)b+=1;return b},isVoid:function(a){var b,c,d,e=a.childNodes;for(c=0,d=e.length;d>c;c++){if(b=e[c],b.nodeType===C.textNode&&!this.isVoidTextNode(b))return!1;if(b.nodeType===C.elementNode)return!1}return!0},isVoidTextNode:function(a){return a.nodeType===C.textNode&&!a.nodeValue},isWhitespaceOnly:function(a){return a.nodeType===C.textNode&&0===this.lastOffsetWithContent(a)},isLinebreak:function(a){return a.nodeType===C.elementNode&&"BR"===a.tagName},lastOffsetWithContent:function(a){if(a.nodeType===C.textNode)return i.trimRight(a.nodeValue).length;var b,c=a.childNodes;for(b=c.length-1;b>=0;b--)if(a=c[b],!this.isWhitespaceOnly(a)&&!this.isLinebreak(a))return b+1;return 0},isBeginningOfHost:function(a,b,c){if(b===a)return this.isStartOffset(b,c);if(this.isStartOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b);return this.isBeginningOfHost(a,d,e)}return!1},isEndOfHost:function(a,b,c){if(b===a)return this.isEndOffset(b,c);if(this.isEndOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b)+1;return this.isEndOfHost(a,d,e)}return!1},isStartOffset:function(a,b){return a.nodeType===C.textNode?0===b:0===a.childNodes.length?!0:a.childNodes[b]===a.firstChild},isEndOffset:function(a,b){return a.nodeType===C.textNode?b===a.length:0===a.childNodes.length?!0:b>0?a.childNodes[b-1]===a.lastChild:!1},isTextEndOfHost:function(a,b,c){if(b===a)return this.isTextEndOffset(b,c);if(this.isTextEndOffset(b,c)){var d=b.parentNode,e=this.getNodeIndex(b)+1;return this.isTextEndOfHost(a,d,e)}return!1},isTextEndOffset:function(a,b){if(a.nodeType===C.textNode){var c=i.trimRight(a.nodeValue);return b>=c.length}if(0===a.childNodes.length)return!0;var d=this.lastOffsetWithContent(a);return b>=d},isSameNode:function(a,b){var c,d,e;if(a.nodeType!==b.nodeType)return!1;if(a.nodeName!==b.nodeName)return!1;for(c=0,d=a.attributes.length;d>c;c++)if(e=a.attributes[c],b.getAttribute(e.name)!==e.value)return!1;return!0},latestChild:function(a){return a.lastChild?this.latestChild(a.lastChild):a},isDocumentFragmentWithoutChildren:function(a){return a&&a.nodeType===C.documentFragmentNode&&0===a.childNodes.length?!0:!1},isInlineElement:function(a,b){var c=b.currentStyle||a.getComputedStyle(b,""),d=c.display;switch(d){case"inline":case"inline-block":return!0;default:return!1}}}}(),E=function(a,b){this.host=a&&a.jquery?a[0]:a,this.range=b,this.isAnythingSelected=b!==d,this.isCursor=this.isAnythingSelected&&b.collapsed,this.isSelection=this.isAnythingSelected&&!this.isCursor};E.prototype.getCursor=function(){return this.isCursor?new r(this.host,this.range):void 0},E.prototype.getSelection=function(){return this.isSelection?new H(this.host,this.range):void 0},E.prototype.forceCursor=function(){if(this.isSelection){var a=this.getSelection();return a.deleteContent()}return this.getCursor()},E.prototype.isDifferentFrom=function(a){a=a||new E;var b=this.range,c=a.range;return b&&c?!b.equals(c):b||c?!0:!1};var F=function(){var a=0,b="",c=function(a,b){return a.querySelector("#"+b)};return{insertRangeBoundaryMarker:function(c,e){var g,h="editable-range-boundary-"+(a+=1),i=c.commonAncestorContainer;(null===i.ownerDocument||i.ownerDocument===d)&&f("Cannot save range: range is emtpy");var j=i.ownerDocument.defaultView.document,k=c.cloneRange();return k.collapse(e),g=j.createElement("span"),g.id=h,g.setAttribute("data-editable","remove"),g.style.lineHeight="0",g.style.display="none",g.appendChild(j.createTextNode(b)),k.insertNode(g),g},setRangeBoundary:function(a,b,d,e){var f=c(a,d);f?(b[e?"setStartBefore":"setEndBefore"](f),f.parentNode.removeChild(f)):console.log("Marker element has been removed. Cannot restore selection.")},save:function(a){var b,c,d;return a.collapsed?(d=this.insertRangeBoundaryMarker(a,!1),b={markerId:d.id,collapsed:!0}):(d=this.insertRangeBoundaryMarker(a,!1),c=this.insertRangeBoundaryMarker(a,!0),b={startMarkerId:c.id,endMarkerId:d.id,collapsed:!1}),a.collapsed?a.collapseBefore(d):(a.setEndBefore(d),a.setStartAfter(c)),b},restore:function(a,b){if(!b.restored){var d=rangy.createRange();if(b.collapsed){var e=c(a,b.markerId);if(e){e.style.display="inline";var f=e.previousSibling;f&&f.nodeType===C.textNode?(e.parentNode.removeChild(e),d.collapseToPoint(f,f.length)):(d.collapseBefore(e),e.parentNode.removeChild(e))}else console.log("Marker element has been removed. Cannot restore selection.")}else this.setRangeBoundary(a,d,b.startMarkerId,!0),this.setRangeBoundary(a,d,b.endMarkerId,!1);return d.normalizeBoundaries(),d}}}}(),G=function(b,c){this.dispatcher=b,this.win=c||a,this.rangySelection=d,this.currentSelection=d,this.currentRange=d};G.prototype.getRangeContainer=function(){if(this.rangySelection=rangy.getSelection(this.win),this.rangySelection.rangeCount){var a=this.rangySelection.getRangeAt(0),b=D.getHost(a.commonAncestorContainer);if(b)return new E(b,a)}return new E},G.prototype.getFreshRange=function(){return this.getRangeContainer()},G.prototype.getFreshSelection=function(){var a=this.getRangeContainer();return a.isCursor?a.getCursor(this.win):a.getSelection(this.win)},G.prototype.getSelection=function(){return this.currentSelection},G.prototype.forceCursor=function(){var a=this.getRangeContainer();return a.forceCursor()},G.prototype.selectionChanged=function(){var a=this.getRangeContainer();if(a.isDifferentFrom(this.currentRange)){var b=this.currentSelection;this.currentRange=a,b&&(b.isCursor&&!this.currentRange.isCursor?this.dispatcher.notify("cursor",b.host):b.isSelection&&!this.currentRange.isSelection&&this.dispatcher.notify("selection",b.host)),this.currentRange.isCursor?(this.currentSelection=new r(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("cursor",this.currentSelection.host,this.currentSelection)):this.currentRange.isSelection?(this.currentSelection=new H(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("selection",this.currentSelection.host,this.currentSelection)):this.currentSelection=d}};var H=function(){var a=function(a,b){this.setHost(a),this.range=b,this.isSelection=!0},b=function(){};return b.prototype=r.prototype,a.prototype=h.extend(new b,{text:function(){return this.range.toString()},html:function(){return this.range.toHtml()},isAllSelected:function(){return D.isBeginningOfHost(this.host,this.range.startContainer,this.range.startOffset)&&D.isTextEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},getRects:function(){var a=this.range.nativeRange.getClientRects();return a},link:function(a,b){var c=h("<a>");a&&c.attr("href",a);for(var d in b)c.attr(d,b[d]);this.forceWrap(c[0])},unlink:function(){this.removeFormatting("a")},toggleLink:function(a,b){var c=this.getTagsByName("a");if(c.length>=1){var d=c[0];this.isExactSelection(d,"visible")?this.unlink():this.expandTo(d)}else this.link(a,b)},toggle:function(a){this.range=q.toggleTag(this.host,this.range,a),this.setSelection()},makeBold:function(){var a=h(j.boldTag);this.forceWrap(a[0])},toggleBold:function(){var a=h(j.boldTag);this.toggle(a[0])},giveEmphasis:function(){var a=h(j.italicTag);this.forceWrap(a[0])},toggleEmphasis:function(){var a=h(j.italicTag);this.toggle(a[0])},surround:function(a,b){this.range=q.surround(this.host,this.range,a,b),this.setSelection()},removeSurround:function(a,b){this.range=q.deleteCharacter(this.host,this.range,a),this.range=q.deleteCharacter(this.host,this.range,b),this.setSelection()},toggleSurround:function(a,b){this.containsString(a)&&this.containsString(b)?this.removeSurround(a,b):this.surround(a,b)},removeFormatting:function(a){this.range=q.removeFormatting(this.host,this.range,a),this.setSelection()},deleteContent:function(){return this.range.deleteContents(),new r(this.host,this.range)},expandTo:function(a){this.range=q.expandTo(this.host,this.range,a),this.setSelection()},collapseAtBeginning:function(){return this.range.collapse(!0),this.setSelection(),new r(this.host,this.range)},collapseAtEnd:function(){return this.range.collapse(!1),this.setSelection(),new r(this.host,this.range)},forceWrap:function(a){this.range=q.forceWrap(this.host,this.range,a),this.setSelection()},getTags:function(a){return q.getTags(this.host,this.range,a)},getTagsByName:function(a){return q.getTagsByName(this.host,this.range,a)},isExactSelection:function(a,b){return q.isExactSelection(this.range,a,b)},containsString:function(a){return q.containsString(this.range,a)},deleteCharacter:function(a){this.range=q.deleteCharacter(this.host,this.range,a),this.setSelection()}}),a}(),I=function(){var a="\\u0041-\\u005A\\u0061-\\u007A\\u0030-\\u0039\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u00FF\\u0100-\\u017F\\u0180-\\u024F",b=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},c=function(a,b){var c={checkOnChange:!0,checkOnFocus:!1,spellcheckService:d,markerNode:h('<span class="spellcheck"></span>')[0],throttle:1e3};this.config=h.extend(c,b),this.prepareMarkerNode(),this.editable=a,this.setup()};return c.prototype.setup=function(){this.config.checkOnFocus&&(this.editable.on("focus",h.proxy(this,"onFocus")),this.editable.on("blur",h.proxy(this,"onBlur"))),this.config.checkOnChange&&this.editable.on("change",h.proxy(this,"onChange"))},c.prototype.onFocus=function(a){this.focusedEditable!==a&&(this.focusedEditable=a,this.editableHasChanged(a))},c.prototype.onBlur=function(a){this.focusedEditable===a&&(this.focusedEditable=d)},c.prototype.onChange=function(a){this.editableHasChanged(a)},c.prototype.prepareMarkerNode=function(){var a=this.config.markerNode;a.jquery&&(this.config.markerNode=a=a[0]),a.setAttribute("data-editable","ui-unwrap"),a.setAttribute("data-spellcheck","spellcheck")},c.prototype.createMarkerNode=function(){return this.config.markerNode.cloneNode()},c.prototype.removeHighlights=function(a){h(a).find("[data-spellcheck=spellcheck]").each(function(a,b){q.unwrap(b)})},c.prototype.createRegex=function(c){var d=h.map(c,function(a){return b(a)}),e="";return e+="([^"+a+"]|^)",e+="("+d.join("|")+")",e+="(?=[^"+a+"]|$)",new RegExp(e,"g")},c.prototype.highlight=function(a,b){if(this.removeHighlights(a),b&&b.length>0){var c=this.createRegex(b),d=this.createMarkerNode();z.highlight(a,c,d)}},c.prototype.editableHasChanged=function(a){this.timeoutId&&this.currentEditableHost===a&&clearTimeout(this.timeoutId);var b=this;this.timeoutId=setTimeout(function(){b.checkSpelling(a),b.currentEditableHost=d,b.timeoutId=d},this.config.throttle),this.currentEditableHost=a},c.prototype.checkSpelling=function(a){var b=this,c=z.extractText(a);this.config.spellcheckService(c,function(c){var d=b.editable.getSelection(a);d?d.retainVisibleSelection(function(){b.highlight(a,c)}):b.highlight(a,c)})},c}();a.Editable=g,g.parser=D,g.content=q}(window,document,window.jQuery);